!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){"use strict";function Buffer(buffer){buffer?(this.array=buffer.array,this.pos=buffer.pos):(this.array=new ArrayBuffer(this.defaultLength),this.length=this.defaultLength,this.setupViews())}module.exports=Buffer,Buffer.prototype={pos:0,itemSize:4,defaultLength:8192,arrayType:"ARRAY_BUFFER",get index(){return this.pos/this.itemSize},setupViews:function(){this.ubytes=new Uint8Array(this.array),this.bytes=new Int8Array(this.array),this.ushorts=new Uint16Array(this.array),this.shorts=new Int16Array(this.array)},bind:function(gl){var type=gl[this.arrayType];this.buffer?gl.bindBuffer(type,this.buffer):(this.buffer=gl.createBuffer(),gl.bindBuffer(type,this.buffer),gl.bufferData(type,new DataView(this.array,0,this.pos),gl.STATIC_DRAW),this.array=null)},destroy:function(gl){this.buffer&&gl.deleteBuffer(this.buffer)},resize:function(){if(this.length<this.pos+this.itemSize){for(;this.length<this.pos+this.itemSize;)this.length=2*Math.round(1.5*this.length/2);this.array=new ArrayBuffer(this.length);var ubytes=new Uint8Array(this.array);ubytes.set(this.ubytes),this.setupViews()}}}},{}],2:[function(require,module){"use strict";var LineVertexBuffer=require("./linevertexbuffer.js"),LineElementBuffer=require("./lineelementbuffer.js"),FillVertexBuffer=require("./fillvertexbuffer.js"),FillElementBuffer=require("./fillelementsbuffer.js"),GlyphVertexBuffer=require("./glyphvertexbuffer.js"),IconVertexBuffer=require("./iconvertexbuffer.js");module.exports=function(bufferset){return bufferset=bufferset||{},{glyphVertex:new GlyphVertexBuffer(bufferset.glyphVertex),iconVertex:new IconVertexBuffer(bufferset.iconVertex),fillVertex:new FillVertexBuffer(bufferset.fillVertex),fillElement:new FillElementBuffer(bufferset.fillElement),lineVertex:new LineVertexBuffer(bufferset.lineVertex),lineElement:new LineElementBuffer(bufferset.lineElement)}}},{"./fillelementsbuffer.js":3,"./fillvertexbuffer.js":4,"./glyphvertexbuffer.js":5,"./iconvertexbuffer.js":6,"./lineelementbuffer.js":7,"./linevertexbuffer.js":8}],3:[function(require,module){"use strict";function FillElementsBuffer(buffer){Buffer.call(this,buffer)}var Buffer=require("./buffer.js");module.exports=FillElementsBuffer,FillElementsBuffer.prototype=Object.create(Buffer.prototype),FillElementsBuffer.prototype.itemSize=6,FillElementsBuffer.prototype.arrayType="ELEMENT_ARRAY_BUFFER",FillElementsBuffer.prototype.add=function(a,b,c){var pos2=this.pos/2;this.resize(),this.ushorts[pos2+0]=a,this.ushorts[pos2+1]=b,this.ushorts[pos2+2]=c,this.pos+=this.itemSize}},{"./buffer.js":1}],4:[function(require,module){"use strict";function FillVertexBuffer(buffer){Buffer.call(this,buffer)}var Buffer=require("./buffer.js");module.exports=FillVertexBuffer,FillVertexBuffer.prototype=Object.create(Buffer.prototype),FillVertexBuffer.prototype.itemSize=4,FillVertexBuffer.prototype.add=function(x,y){var pos2=this.pos/2;this.resize(),this.shorts[pos2+0]=x,this.shorts[pos2+1]=y,this.pos+=this.itemSize},FillVertexBuffer.prototype.addDegenerate=function(){this.add(32767,0)}},{"./buffer.js":1}],5:[function(require,module){"use strict";function GlyphVertexBuffer(buffer){Buffer.call(this,buffer)}var Buffer=require("./buffer.js");module.exports=GlyphVertexBuffer,GlyphVertexBuffer.prototype=Object.create(Buffer.prototype),GlyphVertexBuffer.prototype.defaultLength=32768,GlyphVertexBuffer.prototype.itemSize=16,GlyphVertexBuffer.angleFactor=128/Math.PI,GlyphVertexBuffer.prototype.add=function(x,y,ox,oy,tx,ty,angle,minzoom,range,maxzoom,labelminzoom){var pos=this.pos,pos2=pos/2,angleFactor=GlyphVertexBuffer.angleFactor;this.resize(),this.shorts[pos2+0]=x,this.shorts[pos2+1]=y,this.shorts[pos2+2]=Math.round(64*ox),this.shorts[pos2+3]=Math.round(64*oy),this.ubytes[pos+8]=Math.floor(10*(labelminzoom||0)),this.ubytes[pos+9]=Math.floor(10*(minzoom||0)),this.ubytes[pos+10]=Math.floor(10*Math.min(maxzoom||25,25)),this.ubytes[pos+11]=Math.round(angle*angleFactor)%256,this.ubytes[pos+12]=Math.max(Math.round(range[0]*angleFactor),0)%256,this.ubytes[pos+13]=Math.min(Math.round(range[1]*angleFactor),255)%256,this.ubytes[pos+14]=Math.floor(tx/4),this.ubytes[pos+15]=Math.floor(ty/4),this.pos+=this.itemSize}},{"./buffer.js":1}],6:[function(require,module){"use strict";function GlyphVertexBuffer(buffer){Buffer.call(this,buffer)}var Buffer=require("./buffer.js");module.exports=GlyphVertexBuffer,GlyphVertexBuffer.prototype=Object.create(Buffer.prototype),GlyphVertexBuffer.prototype.defaultLength=40960,GlyphVertexBuffer.prototype.itemSize=20,GlyphVertexBuffer.angleFactor=128/Math.PI,GlyphVertexBuffer.prototype.add=function(x,y,ox,oy,tx,ty,angle,minzoom,range,maxzoom,labelminzoom){var pos=this.pos,pos2=pos/2,angleFactor=GlyphVertexBuffer.angleFactor;this.resize(),this.shorts[pos2+0]=x,this.shorts[pos2+1]=y,this.shorts[pos2+2]=Math.round(64*ox),this.shorts[pos2+3]=Math.round(64*oy),this.ubytes[pos+8]=Math.floor(10*(labelminzoom||0)),this.ubytes[pos+9]=Math.floor(10*(minzoom||0)),this.ubytes[pos+10]=Math.floor(10*Math.min(maxzoom||25,25)),this.ubytes[pos+11]=Math.round(angle*angleFactor)%256,this.ubytes[pos+12]=Math.max(Math.round(range[0]*angleFactor),0)%256,this.ubytes[pos+13]=Math.min(Math.round(range[1]*angleFactor),255)%256,this.shorts[pos2+8]=tx,this.shorts[pos2+9]=ty,this.pos+=this.itemSize}},{"./buffer.js":1}],7:[function(require,module){"use strict";function LineElementBuffer(buffer){Buffer.call(this,buffer)}var Buffer=require("./buffer.js");module.exports=LineElementBuffer,LineElementBuffer.prototype=Object.create(Buffer.prototype),LineElementBuffer.prototype.itemSize=6,LineElementBuffer.prototype.arrayType="ELEMENT_ARRAY_BUFFER",LineElementBuffer.prototype.add=function(a,b,c){var pos2=this.pos/2;this.resize(),this.ushorts[pos2+0]=a,this.ushorts[pos2+1]=b,this.ushorts[pos2+2]=c,this.pos+=this.itemSize}},{"./buffer.js":1}],8:[function(require,module){"use strict";function LineVertexBuffer(buffer){Buffer.call(this,buffer)}var Buffer=require("./buffer.js");module.exports=LineVertexBuffer,LineVertexBuffer.extrudeScale=63,LineVertexBuffer.prototype=Object.create(Buffer.prototype),LineVertexBuffer.prototype.itemSize=8,LineVertexBuffer.prototype.defaultLength=32768,LineVertexBuffer.prototype.add=function(point,extrude,tx,ty,linesofar){var pos=this.pos,pos2=pos/2,index=this.index,extrudeScale=LineVertexBuffer.extrudeScale;return this.resize(),this.shorts[pos2+0]=2*Math.floor(point.x)|tx,this.shorts[pos2+1]=2*Math.floor(point.y)|ty,this.shorts[pos2+2]=Math.round(linesofar||0),this.bytes[pos+6]=Math.round(extrudeScale*extrude.x),this.bytes[pos+7]=Math.round(extrudeScale*extrude.y),this.pos+=this.itemSize,index}},{"./buffer.js":1}],9:[function(require,module){"use strict";function createBucket(layer,buffers,collision,indices){if(RenderProperties[layer.type]){var info=new RenderProperties[layer.type](layer.render),BucketClass="line"===layer.type?LineBucket:"fill"===layer.type?FillBucket:"symbol"===layer.type?SymbolBucket:"raster"===layer.type?RasterBucket:null,bucket=new BucketClass(info,buffers,collision,indices);return bucket.type=layer.type,bucket.interactive=layer.interactive,bucket.minZoom=layer["min-zoom"],bucket.maxZoom=layer["max-zoom"],bucket}}module.exports=createBucket;var LineBucket=require("./linebucket.js"),FillBucket=require("./fillbucket.js"),SymbolBucket=require("./symbolbucket.js"),RasterBucket=require("./rasterbucket.js"),RenderProperties=require("../style/renderproperties.js")},{"../style/renderproperties.js":51,"./fillbucket.js":12,"./linebucket.js":13,"./rasterbucket.js":14,"./symbolbucket.js":15}],10:[function(require,module){"use strict";function ElementGroups(vertexBuffer,elementBuffer,groups){this.vertexBuffer=vertexBuffer,this.elementBuffer=elementBuffer,this.groups=groups?groups:[]}function ElementGroup(vertexStartIndex,elementStartIndex){this.vertexStartIndex=vertexStartIndex,this.elementStartIndex=elementStartIndex,this.elementLength=0,this.vertexLength=0}module.exports=ElementGroups,ElementGroups.prototype.makeRoomFor=function(numVertices){(!this.current||this.current.vertexLength+numVertices>65535)&&(this.current=new ElementGroup(this.vertexBuffer.index,this.elementBuffer&&this.elementBuffer.index),this.groups.push(this.current))}},{}],11:[function(require,module){"use strict";function FeatureTree(getGeometry,getType){this.getGeometry=getGeometry,this.getType=getType,this.rtree=rbush(9),this.toBeInserted=[]}function geometryContainsPoint(rings,type,p,radius){return"Point"===type?pointContainsPoint(rings,p,radius):"LineString"===type?lineContainsPoint(rings,p,radius):"Polygon"===type?polyContainsPoint(rings,p)?!0:lineContainsPoint(rings,p,radius):!1}function distToSegmentSquared(p,v,w){var l2=v.distSqr(w);if(0===l2)return p.distSqr(v);var t=((p.x-v.x)*(w.x-v.x)+(p.y-v.y)*(w.y-v.y))/l2;return p.distSqr(0>t?v:t>1?w:w.sub(v)._mult(t)._add(v))}function lineContainsPoint(rings,p,radius){for(var r=radius*radius,i=0;i<rings.length;i++)for(var ring=rings[i],j=1;j<ring.length;j++){var v=ring[j-1],w=ring[j];if(distToSegmentSquared(p,v,w)<r)return!0}return!1}function polyContainsPoint(rings,p){for(var ring,p1,p2,c=!1,k=0;k<rings.length;k++){ring=rings[k];for(var i=0,j=ring.length-1;i<ring.length;j=i++)p1=ring[i],p2=ring[j],p1.y>p.y!=p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x&&(c=!c)}return c}function pointContainsPoint(rings,p,radius){for(var r=radius*radius,i=0;i<rings.length;i++)for(var ring=rings[i],j=0;j<ring.length;j++)if(ring[j].distSqr(p)<=r)return!0;return!1}var rbush=require("rbush"),Point=require("point-geometry");module.exports=FeatureTree,FeatureTree.prototype.insert=function(bbox,bucket_name,feature){bbox.bucket=bucket_name,bbox.feature=feature,this.toBeInserted.push(bbox)},FeatureTree.prototype._load=function(){this.rtree.load(this.toBeInserted),this.toBeInserted=[]},FeatureTree.prototype.query=function(args,callback){this.toBeInserted.length&&this._load();var radius=args.params&&args.params.radius||0;radius*=4096/args.scale;var x=args.x,y=args.y,matching=this.rtree.search([x-radius,y-radius,x+radius,y+radius]);args.params.buckets?this.queryBuckets(matching,x,y,radius,args.params,callback):this.queryFeatures(matching,x,y,radius,args.params,callback)},FeatureTree.prototype.queryFeatures=function(matching,x,y,radius,params,callback){for(var result=[],i=0;i<matching.length;i++){var feature=matching[i].feature,type=this.getType(feature),geometry=this.getGeometry(feature);if(!(params.bucket&&matching[i].bucket!==params.bucket||params.type&&type!==params.type||!geometryContainsPoint(geometry,type,new Point(x,y),radius))){var props={_bucket:matching[i].bucket,_type:type};params.geometry&&(props._geometry=geometry);for(var key in feature)feature.hasOwnProperty(key)&&"_"!==key[0]&&(props[key]=feature[key]);result.push(props)}}callback(null,result)},FeatureTree.prototype.queryBuckets=function(matching,x,y,radius,params,callback){for(var buckets=[],i=0;i<matching.length;i++)if(!(buckets.indexOf(matching[i].bucket)>=0)){var feature=matching[i].feature,type=this.getType(feature),geometry=this.getGeometry(feature);geometryContainsPoint(geometry,type,new Point(x,y),radius)&&buckets.push(matching[i].bucket)}callback(null,buckets)}},{"point-geometry":97,rbush:99}],12:[function(require,module){"use strict";function FillBucket(info,buffers,placement,elementGroups){this.info=info,this.buffers=buffers,this.elementGroups=elementGroups||new ElementGroups(buffers.fillVertex,buffers.fillElement)}var ElementGroups=require("./elementgroups.js");module.exports=FillBucket,FillBucket.prototype.addFeatures=function(){for(var features=this.features,i=0;i<features.length;i++){var feature=features[i];this.addFeature(feature.loadGeometry())}},FillBucket.prototype.addFeature=function(lines){for(var i=0;i<lines.length;i++)this.addFill(lines[i])},FillBucket.prototype.addFill=function(vertices){if(!(vertices.length<3)){var len=vertices.length;this.elementGroups.makeRoomFor(len+1);var elementGroup=this.elementGroups.current,fillVertex=this.buffers.fillVertex,fillElement=this.buffers.fillElement;fillVertex.addDegenerate(),elementGroup.vertexLength++;for(var prevIndex,currentIndex,currentVertex,firstIndex=fillVertex.index-elementGroup.vertexStartIndex,i=0;i<vertices.length;i++)currentIndex=fillVertex.index-elementGroup.vertexStartIndex,currentVertex=vertices[i],fillVertex.add(currentVertex.x,currentVertex.y),elementGroup.vertexLength++,i>=2&&(currentVertex.x!==vertices[0].x||currentVertex.y!==vertices[0].y)&&(fillElement.add(firstIndex,prevIndex,currentIndex),elementGroup.elementLength++),prevIndex=currentIndex}},FillBucket.prototype.hasData=function(){return!!this.elementGroups.current}},{"./elementgroups.js":10}],13:[function(require,module){"use strict";function LineBucket(info,buffers,placement,elementGroups){this.info=info,this.buffers=buffers,this.elementGroups=elementGroups||new ElementGroups(buffers.lineVertex,buffers.lineElement)}var ElementGroups=require("./elementgroups.js");module.exports=LineBucket,LineBucket.prototype.addFeatures=function(){for(var features=this.features,i=0;i<features.length;i++){var feature=features[i];this.addFeature(feature.loadGeometry())}},LineBucket.prototype.addFeature=function(lines){for(var info=this.info,i=0;i<lines.length;i++)this.addLine(lines[i],info["line-join"],info["line-cap"],info["line-miter-limit"],info["line-round-limit"])},LineBucket.prototype.addLine=function(vertices,join,cap,miterLimit,roundLimit){function addCurrentVertex(normal,endBox,round){var extrude,tx=round?1:0;extrude=normal.mult(flip),endBox&&extrude._sub(normal.perp()._mult(endBox)),e3=lineVertex.add(currentVertex,extrude,tx,0,distance)-vertexStartIndex,e1>=0&&e2>=0&&(lineElement.add(e1,e2,e3),elementGroup.elementLength++),e1=e2,e2=e3,extrude=normal.mult(-flip),endBox&&extrude._sub(normal.perp()._mult(endBox)),e3=lineVertex.add(currentVertex,extrude,tx,1,distance)-vertexStartIndex,e1>=0&&e2>=0&&(lineElement.add(e1,e2,e3),elementGroup.elementLength++),e1=e2,e2=e3,elementGroup.vertexLength+=2}if(!(vertices.length<2)){var len=vertices.length,firstVertex=vertices[0],lastVertex=vertices[len-1],closed=firstVertex.equals(lastVertex),lineVertex=this.buffers.lineVertex,lineElement=this.buffers.lineElement;this.elementGroups.makeRoomFor(4*len);var elementGroup=this.elementGroups.current,vertexStartIndex=elementGroup.vertexStartIndex;if(2!=len||!closed){var currentVertex,prevVertex,nextVertex,prevNormal,nextNormal,e1,e2,e3,beginCap=cap,endCap=closed?"butt":cap,flip=1,distance=0;closed&&(currentVertex=vertices[len-2],nextNormal=firstVertex.sub(currentVertex)._unit()._perp());for(var i=0;len>i;i++)if(nextVertex=closed&&i===len-1?vertices[1]:vertices[i+1],!nextVertex||!vertices[i].equals(nextVertex)){nextNormal&&(prevNormal=nextNormal),currentVertex&&(prevVertex=currentVertex),currentVertex=vertices[i],prevVertex&&(distance+=currentVertex.dist(prevVertex)),nextNormal=nextVertex?nextVertex.sub(currentVertex)._unit()._perp():prevNormal,prevNormal=prevNormal||nextNormal;var joinNormal=prevNormal.add(nextNormal)._unit(),cosHalfAngle=joinNormal.x*nextNormal.x+joinNormal.y*nextNormal.y,miterLength=1/cosHalfAngle,startOfLine=void 0===e1||void 0===e2,middleVertex=prevVertex&&nextVertex,currentJoin=middleVertex?join:nextVertex?beginCap:endCap;if(middleVertex&&"round"===currentJoin&&roundLimit>miterLength&&(currentJoin="miter"),"miter"===currentJoin&&miterLength>miterLimit&&miterLength<Math.SQRT2&&(currentJoin="bevel"),"miter"===currentJoin){if(miterLength>100)flip=-flip,joinNormal=nextNormal;else if(miterLength>miterLimit){flip=-flip;var bevelLength=miterLength*prevNormal.add(nextNormal).mag()/prevNormal.sub(nextNormal).mag();joinNormal._perp()._mult(flip*bevelLength)}else joinNormal._mult(miterLength);addCurrentVertex(joinNormal,0,!1)}else startOfLine||addCurrentVertex(prevNormal,"square"===currentJoin?1:0,!1),startOfLine||"round"!==currentJoin||addCurrentVertex(prevNormal,1,!0),(startOfLine||"bevel"!==currentJoin)&&(e1=e2=-1,flip=1),startOfLine&&"round"===beginCap&&addCurrentVertex(nextNormal,-1,!0),nextVertex&&addCurrentVertex(nextNormal,"square"===currentJoin?-1:0,!1)}}}},LineBucket.prototype.hasData=function(){return!!this.elementGroups.current}},{"./elementgroups.js":10}],14:[function(require,module){"use strict";function RasterBucket(info){this.info=info}module.exports=RasterBucket},{}],15:[function(require,module){"use strict";function SymbolBucket(info,buffers,collision,elementGroups){this.info=info,this.buffers=buffers,this.collision=collision,"line"===info["symbol-placement"]&&(info.hasOwnProperty("text-rotation-alignment")||(info["text-rotation-alignment"]="map"),info.hasOwnProperty("icon-rotation-alignment")||(info["icon-rotation-alignment"]="map")),this.elementGroups=elementGroups?elementGroups:{text:new ElementGroups(buffers.glyphVertex),icon:new ElementGroups(buffers.iconVertex)}}function byScale(a,b){return a.scale-b.scale}var ElementGroups=require("./elementgroups.js"),Anchor=require("../symbol/anchor.js"),interpolate=require("../symbol/interpolate.js"),Point=require("point-geometry"),resolveTokens=require("../util/token.js"),Placement=require("../symbol/placement.js"),Shaping=require("../symbol/shaping.js"),resolveText=require("../symbol/resolvetext.js");module.exports=SymbolBucket;var fullRange=[2*Math.PI,0];SymbolBucket.prototype.addFeatures=function(){var info=this.info,features=this.features,textFeatures=this.textFeatures,horizontalAlign=.5;"right"===info["text-horizontal-align"]?horizontalAlign=1:"left"===info["text-horizontal-align"]&&(horizontalAlign=0);var verticalAlign=.5;"bottom"===info["text-vertical-align"]?verticalAlign=1:"top"===info["text-vertical-align"]&&(verticalAlign=0);var justify=.5;"right"===info["text-justify"]?justify=1:"left"===info["text-justify"]&&(justify=0);for(var oneEm=24,lineHeight=info["text-line-height"]*oneEm,maxWidth="line"!==info["symbol-placement"]&&info["text-max-width"]*oneEm,spacing=info["text-letter-spacing"]*oneEm,fontstack=info["text-font"],textOffset=[info["text-offset"][0]*oneEm,info["text-offset"][1]*oneEm],k=0;k<features.length;k++){var feature=features[k],text=textFeatures[k],lines=feature.loadGeometry(),shaping=!1;text&&(shaping=Shaping.shape(text,fontstack,this.stacks,maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,textOffset));var image=!1;this.sprite&&this.info["icon-image"]&&(image=this.sprite[resolveTokens(feature.properties,info["icon-image"])],image&&(image.w=image.width,image.h=image.height,image.sdf&&(this.elementGroups.sdfIcons=!0))),(shaping||image)&&this.addFeature(lines,this.stacks,shaping,image)}},SymbolBucket.prototype.addFeature=function(lines,faces,shaping,image){for(var info=this.info,collision=this.collision,minScale=.5,glyphSize=24,horizontalText="viewport"===info["text-rotation-alignment"],horizontalIcon="viewport"===info["icon-rotation-alignment"],fontScale=info["text-max-size"]/glyphSize,textBoxScale=collision.tilePixelRatio*fontScale,iconBoxScale=collision.tilePixelRatio*info["icon-max-size"],iconWithoutText=info["text-optional"]||!shaping,textWithoutIcon=info["icon-optional"]||!image,i=0;i<lines.length;i++){var anchors,line=lines[i];"line"===info["symbol-placement"]?(anchors=interpolate(line,info["symbol-min-distance"],minScale,collision.maxPlacementScale,collision.tilePixelRatio),anchors.sort(byScale)):anchors=[new Anchor(line[0].x,line[0].y,0,minScale)];for(var origin=new Point(0,-17),j=0,len=anchors.length;len>j;j++){var glyph,icon,anchor=anchors[j],glyphScale=null,iconScale=null;if((!shaping||(glyph=Placement.getGlyphs(anchor,origin,shaping,faces,textBoxScale,horizontalText,line,info),glyphScale=info["text-allow-overlap"]?glyph.minScale:collision.getPlacementScale(glyph.boxes,glyph.minScale),glyphScale||iconWithoutText))&&(!image||(icon=Placement.getIcon(anchor,image,iconBoxScale,line,info),iconScale=info["icon-allow-overlap"]?icon.minScale:collision.getPlacementScale(icon.boxes,icon.minScale),iconScale||textWithoutIcon))){iconWithoutText||textWithoutIcon?!textWithoutIcon&&glyphScale?glyphScale=Math.max(iconScale,glyphScale):!iconWithoutText&&iconScale&&(iconScale=Math.max(iconScale,glyphScale)):iconScale=glyphScale=Math.max(iconScale,glyphScale);var glyphRange=!glyphScale||info["text-allow-overlap"]?fullRange:collision.getPlacementRange(glyph.boxes,glyphScale,horizontalText),iconRange=!iconScale||info["icon-allow-overlap"]?fullRange:collision.getPlacementRange(icon.boxes,iconScale,horizontalIcon),maxRange=[Math.min(iconRange[0],glyphRange[0]),Math.max(iconRange[1],glyphRange[1])];iconWithoutText||textWithoutIcon?textWithoutIcon?iconWithoutText||(iconRange=maxRange):glyphRange=maxRange:iconRange=glyphRange=maxRange,glyphScale&&(info["text-ignore-placement"]||collision.insert(glyph.boxes,anchor,glyphScale,glyphRange,horizontalText),this.addSymbols(this.buffers.glyphVertex,this.elementGroups.text,glyph.shapes,glyphScale,glyphRange)),iconScale&&(info["icon-ignore-placement"]||collision.insert(icon.boxes,anchor,iconScale,iconRange,horizontalIcon),this.addSymbols(this.buffers.iconVertex,this.elementGroups.icon,icon.shapes,iconScale,iconRange))}}}},SymbolBucket.prototype.addSymbols=function(buffer,elementGroups,symbols,scale,placementRange){var zoom=this.collision.zoom;elementGroups.makeRoomFor(0);for(var elementGroup=elementGroups.current,placementZoom=Math.log(scale)/Math.LN2+zoom,k=0;k<symbols.length;k++){var symbol=symbols[k],tl=symbol.tl,tr=symbol.tr,bl=symbol.bl,br=symbol.br,tex=symbol.tex,angle=symbol.angle,anchor=symbol.anchor,minZoom=Math.max(zoom+Math.log(symbol.minScale)/Math.LN2,placementZoom),maxZoom=Math.min(zoom+Math.log(symbol.maxScale)/Math.LN2,25);minZoom>=maxZoom||(minZoom===placementZoom&&(minZoom=0),buffer.add(anchor.x,anchor.y,tl.x,tl.y,tex.x,tex.y,angle,minZoom,placementRange,maxZoom,placementZoom),buffer.add(anchor.x,anchor.y,tr.x,tr.y,tex.x+tex.w,tex.y,angle,minZoom,placementRange,maxZoom,placementZoom),buffer.add(anchor.x,anchor.y,bl.x,bl.y,tex.x,tex.y+tex.h,angle,minZoom,placementRange,maxZoom,placementZoom),buffer.add(anchor.x,anchor.y,tr.x,tr.y,tex.x+tex.w,tex.y,angle,minZoom,placementRange,maxZoom,placementZoom),buffer.add(anchor.x,anchor.y,bl.x,bl.y,tex.x,tex.y+tex.h,angle,minZoom,placementRange,maxZoom,placementZoom),buffer.add(anchor.x,anchor.y,br.x,br.y,tex.x+tex.w,tex.y+tex.h,angle,minZoom,placementRange,maxZoom,placementZoom),elementGroup.vertexLength+=6)}},SymbolBucket.prototype.getDependencies=function(tile,actor,callback){function done(err){(err||firstdone)&&callback(err),firstdone=!0,firsterr=err}var firsterr,firstdone=!1;this.getTextDependencies(tile,actor,done),this.getIconDependencies(tile,actor,done)},SymbolBucket.prototype.getIconDependencies=function(tile,actor,callback){var bucket=this;this.info["icon-image"]?SymbolBucket.sprite?(this.sprite=SymbolBucket.sprite,callback()):actor.send("get sprite json",{},function(err,data){SymbolBucket.sprite=bucket.sprite=data.sprite,callback(err)}):callback()},SymbolBucket.prototype.getTextDependencies=function(tile,actor,callback){var features=this.features,info=this.info;void 0===tile.stacks&&(tile.stacks={});var stacks=this.stacks=tile.stacks,fontstack=info["text-font"];void 0===stacks[fontstack]&&(stacks[fontstack]={glyphs:{},rects:{}});var stack=stacks[fontstack],data=resolveText(features,info,stack.glyphs);this.textFeatures=data.textFeatures,actor.send("get glyphs",{id:tile.id,fontstack:fontstack,codepoints:data.codepoints},function(err,newstack){if(err)return callback(err);var newglyphs=newstack.glyphs,newrects=newstack.rects,glyphs=stack.glyphs,rects=stack.rects;for(var codepoint in newglyphs)glyphs[codepoint]=newglyphs[codepoint],rects[codepoint]=newrects[codepoint];callback()})},SymbolBucket.prototype.hasData=function(){return!!this.elementGroups.text.current||!!this.elementGroups.icon.current}},{"../symbol/anchor.js":56,"../symbol/interpolate.js":61,"../symbol/placement.js":62,"../symbol/resolvetext.js":63,"../symbol/shaping.js":65,"../util/token.js":84,"./elementgroups.js":10,"point-geometry":97}],16:[function(require,module){"use strict";function LatLng(lat,lng){if(isNaN(lat)||isNaN(lng))throw new Error("Invalid LatLng object: ("+lat+", "+lng+")");this.lat=+lat,this.lng=+lng}module.exports=LatLng,LatLng.convert=function(a){return a instanceof LatLng?a:Array.isArray(a)?new LatLng(a[0],a[1]):a}},{}],17:[function(require,module){"use strict";function LatLngBounds(sw,ne){if(sw)for(var latlngs=ne?[sw,ne]:sw,i=0,len=latlngs.length;len>i;i++)this.extend(latlngs[i])}module.exports=LatLngBounds;var LatLng=require("./latlng.js");LatLngBounds.prototype={extend:function(obj){var sw2,ne2,sw=this._sw,ne=this._ne;if(obj instanceof LatLng)sw2=obj,ne2=obj;else{if(!(obj instanceof LatLngBounds))return obj?this.extend(LatLng.convert(obj)||LatLngBounds.convert(obj)):this;if(sw2=obj._sw,ne2=obj._ne,!sw2||!ne2)return this}return sw||ne?(sw.lat=Math.min(sw2.lat,sw.lat),sw.lng=Math.min(sw2.lng,sw.lng),ne.lat=Math.max(ne2.lat,ne.lat),ne.lng=Math.max(ne2.lng,ne.lng)):(this._sw=new LatLng(sw2.lat,sw2.lng),this._ne=new LatLng(ne2.lat,ne2.lng)),this},getCenter:function(){return new LatLng((this._sw.lat+this._ne.lat)/2,(this._sw.lng+this._ne.lng)/2)},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},getNorthWest:function(){return new LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._sw.lng},getSouth:function(){return this._sw.lat},getEast:function(){return this._ne.lng},getNorth:function(){return this._ne.lat}},LatLngBounds.convert=function(a){return!a||a instanceof LatLngBounds?a:new LatLngBounds(a)}},{"./latlng.js":16}],18:[function(require,module){"use strict";function Transform(minZoom,maxZoom){this.tileSize=512,this._minZoom=minZoom||0,this._maxZoom=maxZoom||22,this.latRange=[-85,85],this.width=0,this.height=0,this.zoom=0,this.center=new LatLng(0,0),this.angle=0}var LatLng=require("./latlng.js"),Point=require("point-geometry");module.exports=Transform,Transform.prototype={get minZoom(){return this._minZoom},set minZoom(zoom){this._minZoom=zoom,this.zoom=Math.max(this.zoom,zoom)},get maxZoom(){return this._maxZoom},set maxZoom(zoom){this._maxZoom=zoom,this.zoom=Math.min(this.zoom,zoom)},get worldSize(){return this.tileSize*this.scale},get centerPoint(){return this.size._div(2)},get size(){return new Point(this.width,this.height)},get bearing(){return-this.angle/Math.PI*180},set bearing(bearing){bearing=((bearing+180)%360+360)%360-180,this.angle=-bearing*Math.PI/180},get zoom(){return this._zoom},set zoom(zoom){zoom=Math.min(Math.max(zoom,this.minZoom),this.maxZoom),this._zoom=zoom,this.scale=this.zoomScale(zoom),this.tileZoom=Math.floor(zoom),this.zoomFraction=zoom-this.tileZoom,this._constrain()},zoomScale:function(zoom){return Math.pow(2,zoom)},scaleZoom:function(scale){return Math.log(scale)/Math.LN2},project:function(latlng,worldSize){return new Point(this.lngX(latlng.lng,worldSize),this.latY(latlng.lat,worldSize))},unproject:function(point,worldSize){return new LatLng(this.yLat(point.y,worldSize),this.xLng(point.x,worldSize))},get x(){return this.lngX(this.center.lng)},get y(){return this.latY(this.center.lat)},get point(){return new Point(this.x,this.y)},lngX:function(lon,worldSize){return(180+lon)*(worldSize||this.worldSize)/360},latY:function(lat,worldSize){var y=180/Math.PI*Math.log(Math.tan(Math.PI/4+lat*Math.PI/360));return(180-y)*(worldSize||this.worldSize)/360},xLng:function(x,worldSize){return 360*x/(worldSize||this.worldSize)-180},yLat:function(y,worldSize){var y2=180-360*y/(worldSize||this.worldSize);return 360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90},panBy:function(offset){var point=this.centerPoint._add(offset);this.center=this.pointLocation(point),this._constrain()},zoomAroundTo:function(zoom,p){var p1=this.size._sub(p),latlng=this.pointLocation(p1);this.zoom=zoom,this.panBy(p1.sub(this.locationPoint(latlng)))},rotate:function(bearing,offset){offset&&this.panBy(offset),this.bearing=bearing,offset&&this.panBy(offset.mult(-1))},locationPoint:function(latlng){var p=this.project(latlng);return this.centerPoint._sub(this.point._sub(p)._rotate(this.angle))},pointLocation:function(p){var p2=this.centerPoint._sub(p)._rotate(-this.angle);return this.unproject(this.point.sub(p2))},locationCoordinate:function(latlng){var k=this.zoomScale(this.tileZoom)/this.worldSize;return{column:this.lngX(latlng.lng)*k,row:this.latY(latlng.lat)*k,zoom:this.tileZoom}},pointCoordinate:function(tileCenter,p){var zoomFactor=this.zoomScale(this.zoomFraction),kt=this.zoomScale(this.tileZoom-tileCenter.zoom),p2=this.centerPoint._sub(p)._rotate(-this.angle)._div(this.tileSize*zoomFactor);return{column:tileCenter.column*kt-p2.x,row:tileCenter.row*kt-p2.y,zoom:this.tileZoom}},_constrain:function(){if(this.center){var minY,maxY,minX,maxX,sy,sx,x2,y2,size=this.size;this.latRange&&(minY=this.latY(this.latRange[1]),maxY=this.latY(this.latRange[0]),sy=maxY-minY<size.y?size.y/(maxY-minY):0),this.lngRange&&(minX=this.lngX(this.lngRange[0]),maxX=this.lngX(this.lngRange[1]),sx=maxX-minX<size.x?size.x/(maxX-minX):0);var s=Math.max(sx||0,sy||0);if(s)return this.center=this.unproject(new Point(sx?(maxX+minX)/2:this.x,sy?(maxY+minY)/2:this.y)),void(this.zoom+=this.scaleZoom(s));if(this.latRange){var y=this.y,h2=size.y/2;minY>y-h2&&(y2=minY+h2),y+h2>maxY&&(y2=maxY-h2)}if(this.lngRange){var x=this.x,w2=size.x/2;minX>x-w2&&(x2=minX+w2),x+w2>maxX&&(x2=maxX-w2)}(void 0!==x2||void 0!==y2)&&(this.center=this.unproject(new Point(void 0!==x2?x2:this.x,void 0!==y2?y2:this.y)))}}}},{"./latlng.js":16,"point-geometry":97}],19:[function(require,module){var simplex_font={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};
module.exports=function(text,left,baseline,scale){scale=scale||1;var i,len,j,len2,glyph,x,y,prev,strokes=[];for(i=0,len=text.length;len>i;i++)if(glyph=simplex_font[text[i]]){for(prev=null,j=0,len2=glyph[1].length;len2>j;j+=2)-1===glyph[1][j]&&-1===glyph[1][j+1]?prev=null:(x=left+glyph[1][j]*scale,y=baseline-glyph[1][j+1]*scale,prev&&strokes.push(prev.x,prev.y,x,y),prev={x:x,y:y});left+=glyph[0]*scale}return strokes}},{}],20:[function(require,module,exports){!function(e){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports="undefined"!=typeof window?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!n)var n="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;var i={};i.setMatrixArrayType=function(e){n=e},"undefined"!=typeof e&&(e.glMatrix=i);var s={};s.create=function(){var e=new n(2);return e[0]=0,e[1]=0,e},s.clone=function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},s.fromValues=function(e,t){var r=new n(2);return r[0]=e,r[1]=t,r},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},s.set=function(e,t,n){return e[0]=t,e[1]=n,e},s.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},s.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},s.sub=s.subtract,s.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},s.mul=s.multiply,s.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},s.div=s.divide,s.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},s.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},s.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},s.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},s.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},s.dist=s.distance,s.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},s.len=s.length,s.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},s.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},s.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},s.random=function(e,t){t=t||1;var n=2*r()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},s.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},s.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},s.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},s.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},s.forEach=function(){var e=s.create();return function(t,n,r,i,s,o){var u,a;for(n||(n=2),r||(r=0),a=i?Math.min(i*n+r,t.length):t.length,u=r;a>u;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),s.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},"undefined"!=typeof e&&(e.vec2=s);var o={};o.create=function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},o.clone=function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.fromValues=function(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},o.div=o.divide,o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},o.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},o.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},o.cross=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];return e[0]=i*a-s*u,e[1]=s*o-r*a,e[2]=r*u-i*o,e},o.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e},o.random=function(e,t){t=t||1;var n=2*r()*Math.PI,i=2*r()-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=i*t,e},o.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12],e[1]=n[1]*r+n[5]*i+n[9]*s+n[13],e[2]=n[2]*r+n[6]*i+n[10]*s+n[14],e},o.transformMat3=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e},o.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,a;for(n||(n=3),r||(r=0),a=i?Math.min(i*n+r,t.length):t.length,u=r;a>u;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),o.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},"undefined"!=typeof e&&(e.vec3=o);var u={};u.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},u.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.fromValues=function(e,t,r,i){var s=new n(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},u.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},u.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},u.sub=u.subtract,u.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},u.mul=u.multiply,u.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},u.div=u.divide,u.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},u.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},u.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},u.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},u.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)},u.dist=u.distance,u.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},u.len=u.length,u.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},u.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},u.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},u.random=function(e,t){return t=t||1,e[0]=r(),e[1]=r(),e[2]=r(),e[3]=r(),u.normalize(e,e),u.scale(e,e,t),e},u.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e},u.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},u.forEach=function(){var e=u.create();return function(t,n,r,i,s,o){var u,a;for(n||(n=4),r||(r=0),a=i?Math.min(i*n+r,t.length):t.length,u=r;a>u;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),u.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.vec4=u);var a={};a.create=function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},a.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},a.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},a.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},a.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*u+i*f,e[1]=r*a+i*l,e[2]=s*u+o*f,e[3]=s*a+o*l,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=r*-u+i*a,e[2]=s*a+o*u,e[3]=s*-u+o*a,e},a.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];return e[0]=r*u,e[1]=i*a,e[2]=s*u,e[3]=o*a,e},a.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.mat2=a);var f={};f.create=function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.clone=function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=n*s-r*i;return a?(a=1/a,e[0]=s*a,e[1]=-r*a,e[2]=-i*a,e[3]=n*a,e[4]=(i*u-s*o)*a,e[5]=(r*o-n*u)*a,e):null},f.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},f.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1],c=n[2],h=n[3],p=n[4],d=n[5];return e[0]=r*f+i*c,e[1]=r*l+i*h,e[2]=s*f+o*c,e[3]=s*l+o*h,e[4]=f*u+c*a+p,e[5]=l*u+h*a+d,e},f.mul=f.multiply,f.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*f,e[1]=-r*f+i*l,e[2]=s*l+o*f,e[3]=-s*f+l*o,e[4]=l*u+f*a,e[5]=l*a-f*u,e},f.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=t[0]*r,e[1]=t[1]*i,e[2]=t[2]*r,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*i,e},f.translate=function(e,t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+n[0],e[5]=t[5]+n[1],e},f.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},"undefined"!=typeof e&&(e.mat2d=f);var l={};l.create=function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},l.clone=function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},l.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*r+i*f)*d,e[2]=(u*r-i*o)*d,e[3]=h*d,e[4]=(l*n-i*a)*d,e[5]=(-u*n+i*s)*d,e[6]=p*d,e[7]=(-f*n+r*a)*d,e[8]=(o*n-r*s)*d,e):null},l.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return e[0]=o*l-u*f,e[1]=i*f-r*l,e[2]=r*u-i*o,e[3]=u*a-s*l,e[4]=n*l-i*a,e[5]=i*s-n*u,e[6]=s*f-o*a,e[7]=r*a-n*f,e[8]=n*o-r*s,e},l.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},l.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return e[0]=h*r+p*o+d*f,e[1]=h*i+p*u+d*l,e[2]=h*s+p*a+d*c,e[3]=v*r+m*o+g*f,e[4]=v*i+m*u+g*l,e[5]=v*s+m*a+g*c,e[6]=y*r+b*o+w*f,e[7]=y*i+b*u+w*l,e[8]=y*s+b*a+w*c,e},l.mul=l.multiply,l.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=u,e[5]=a,e[6]=h*r+p*o+f,e[7]=h*i+p*u+l,e[8]=h*s+p*a+c,e},l.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*r+h*o,e[1]=p*i+h*u,e[2]=p*s+h*a,e[3]=p*o-h*r,e[4]=p*u-h*i,e[5]=p*a-h*s,e[6]=f,e[7]=l,e[8]=c,e},l.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},l.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[3]=l+g,e[6]=c-m,e[1]=l-g,e[4]=1-(f+d),e[7]=p+v,e[2]=c+m,e[5]=p-v,e[8]=1-(f+h),e},l.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(a*C-o*A-f*N)*O,e[2]=(o*L-u*C+f*T)*O,e[3]=(i*L-r*A-s*k)*O,e[4]=(n*A-i*C+s*N)*O,e[5]=(r*C-n*L-s*T)*O,e[6]=(v*x-m*S+g*E)*O,e[7]=(m*w-d*x-g*b)*O,e[8]=(d*S-v*w+g*y)*O,e):null},l.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},"undefined"!=typeof e&&(e.mat3=l);var c={};c.create=function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.clone=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},c.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(i*L-r*A-s*k)*O,e[2]=(v*x-m*S+g*E)*O,e[3]=(h*S-c*x-p*E)*O,e[4]=(a*C-o*A-f*N)*O,e[5]=(n*A-i*C+s*N)*O,e[6]=(m*w-d*x-g*b)*O,e[7]=(l*x-h*w+p*b)*O,e[8]=(o*L-u*C+f*T)*O,e[9]=(r*C-n*L-s*T)*O,e[10]=(d*S-v*w+g*y)*O,e[11]=(c*w-l*S-p*y)*O,e[12]=(u*N-o*k-a*T)*O,e[13]=(n*k-r*N+i*T)*O,e[14]=(v*b-d*E-m*y)*O,e[15]=(l*E-c*b+h*y)*O,e):null},c.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h),e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h)),e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a),e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a)),e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h)),e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h),e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a)),e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a),e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c),e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c)),e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u),e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u)),e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c)),e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c),e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u)),e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u),e},c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x},c.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=n[0],w=n[1],E=n[2],S=n[3];return e[0]=b*r+w*u+E*c+S*v,e[1]=b*i+w*a+E*h+S*m,e[2]=b*s+w*f+E*p+S*g,e[3]=b*o+w*l+E*d+S*y,b=n[4],w=n[5],E=n[6],S=n[7],e[4]=b*r+w*u+E*c+S*v,e[5]=b*i+w*a+E*h+S*m,e[6]=b*s+w*f+E*p+S*g,e[7]=b*o+w*l+E*d+S*y,b=n[8],w=n[9],E=n[10],S=n[11],e[8]=b*r+w*u+E*c+S*v,e[9]=b*i+w*a+E*h+S*m,e[10]=b*s+w*f+E*p+S*g,e[11]=b*o+w*l+E*d+S*y,b=n[12],w=n[13],E=n[14],S=n[15],e[12]=b*r+w*u+E*c+S*v,e[13]=b*i+w*a+E*h+S*m,e[14]=b*s+w*f+E*p+S*g,e[15]=b*o+w*l+E*d+S*y,e},c.mul=c.multiply,c.translate=function(e,t,n){var o,u,a,f,l,c,h,p,d,v,m,g,r=n[0],i=n[1],s=n[2];return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],e[0]=o,e[1]=u,e[2]=a,e[3]=f,e[4]=l,e[5]=c,e[6]=h,e[7]=p,e[8]=d,e[9]=v,e[10]=m,e[11]=g,e[12]=o*r+l*i+d*s+t[12],e[13]=u*r+c*i+v*s+t[13],e[14]=a*r+h*i+m*s+t[14],e[15]=f*r+p*i+g*s+t[15]),e},c.scale=function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.rotate=function(e,n,r,i){var f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u);return Math.abs(a)<t?null:(a=1/a,s*=a,o*=a,u*=a,f=Math.sin(r),l=Math.cos(r),c=1-l,h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11],T=s*s*c+l,N=o*s*c+u*f,C=u*s*c-o*f,k=s*o*c-u*f,L=o*o*c+l,A=u*o*c+s*f,O=s*u*c+o*f,M=o*u*c-s*f,_=u*u*c+l,e[0]=h*T+m*N+w*C,e[1]=p*T+g*N+E*C,e[2]=d*T+y*N+S*C,e[3]=v*T+b*N+x*C,e[4]=h*k+m*L+w*A,e[5]=p*k+g*L+E*A,e[6]=d*k+y*L+S*A,e[7]=v*k+b*L+x*A,e[8]=h*O+m*M+w*_,e[9]=p*O+g*M+E*_,e[10]=d*O+y*M+S*_,e[11]=v*O+b*M+x*_,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},c.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+f*r,e[5]=o*i+l*r,e[6]=u*i+c*r,e[7]=a*i+h*r,e[8]=f*i-s*r,e[9]=l*i-o*r,e[10]=c*i-u*r,e[11]=h*i-a*r,e},c.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-f*r,e[1]=o*i-l*r,e[2]=u*i-c*r,e[3]=a*i-h*r,e[8]=s*r+f*i,e[9]=o*r+l*i,e[10]=u*r+c*i,e[11]=a*r+h*i,e},c.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+f*r,e[1]=o*i+l*r,e[2]=u*i+c*r,e[3]=a*i+h*r,e[4]=f*i-s*r,e[5]=l*i-o*r,e[6]=c*i-u*r,e[7]=h*i-a*r,e},c.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return e[0]=1-(p+v),e[1]=c+y,e[2]=h-g,e[3]=0,e[4]=c-y,e[5]=1-(l+v),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},c.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[1]=l+g,e[2]=c-m,e[3]=0,e[4]=l-g,e[5]=1-(f+d),e[6]=p+v,e[7]=0,e[8]=c+m,e[9]=p-v,e[10]=1-(f+h),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.frustum=function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);return e[0]=2*s*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*a,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*a,e[10]=(o+s)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*f,e[15]=0,e},c.perspective=function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},c.ortho=function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*a,e[14]=(o+s)*f,e[15]=1,e},c.lookAt=function(e,n,r,i){var s,o,u,a,f,l,h,p,d,v,m=n[0],g=n[1],y=n[2],b=i[0],w=i[1],E=i[2],S=r[0],x=r[1],T=r[2];return Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t?c.identity(e):(h=m-S,p=g-x,d=y-T,v=1/Math.sqrt(h*h+p*p+d*d),h*=v,p*=v,d*=v,s=w*d-E*p,o=E*h-b*d,u=b*p-w*h,v=Math.sqrt(s*s+o*o+u*u),v?(v=1/v,s*=v,o*=v,u*=v):(s=0,o=0,u=0),a=p*u-d*o,f=d*s-h*u,l=h*o-p*s,v=Math.sqrt(a*a+f*f+l*l),v?(v=1/v,a*=v,f*=v,l*=v):(a=0,f=0,l=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=o,e[5]=f,e[6]=p,e[7]=0,e[8]=u,e[9]=l,e[10]=d,e[11]=0,e[12]=-(s*m+o*g+u*y),e[13]=-(a*m+f*g+l*y),e[14]=-(h*m+p*g+d*y),e[15]=1,e)},c.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},"undefined"!=typeof e&&(e.mat4=c);var h={};h.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.rotationTo=function(){var e=o.create(),t=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,i,s){var u=o.dot(i,s);return-.999999>u?(o.cross(e,t,i),o.length(e)<1e-6&&o.cross(e,n,i),o.normalize(e,e),h.setAxisAngle(r,e,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+u,h.normalize(r,r))}}(),h.setAxes=function(){var e=l.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=n[0],e[5]=n[1],e[8]=n[2],h.normalize(t,h.fromMat3(t,e))}}(),h.clone=u.clone,h.fromValues=u.fromValues,h.copy=u.copy,h.set=u.set,h.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},h.add=u.add,h.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},h.mul=h.multiply,h.scale=u.scale,h.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+o*u,e[1]=i*a+s*u,e[2]=s*a-i*u,e[3]=o*a-r*u,e},h.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*u,e[1]=i*a+o*u,e[2]=s*a+r*u,e[3]=o*a-i*u,e},h.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=i*a-r*u,e[2]=s*a+o*u,e[3]=o*a-s*u,e},h.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},h.dot=u.dot,h.lerp=u.lerp,h.slerp=function(e,t,n,r){var h,p,d,v,m,i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=n[3];return p=i*a+s*f+o*l+u*c,0>p&&(p=-p,a=-a,f=-f,l=-l,c=-c),1-p>1e-6?(h=Math.acos(p),d=Math.sin(h),v=Math.sin((1-r)*h)/d,m=Math.sin(r*h)/d):(v=1-r,m=r),e[0]=v*i+m*a,e[1]=v*s+m*f,e[2]=v*o+m*l,e[3]=v*u+m*c,e},h.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=s*u,e},h.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},h.length=u.length,h.len=h.length,h.squaredLength=u.squaredLength,h.sqrLen=h.squaredLength,h.normalize=u.normalize,h.fromMat3=function(){var e="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(t,n){var i,r=n[0]+n[4]+n[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(n[7]-n[5])*i,t[1]=(n[2]-n[6])*i,t[2]=(n[3]-n[1])*i;else{var s=0;n[4]>n[0]&&(s=1),n[8]>n[3*s+s]&&(s=2);var o=e[s],u=e[o];i=Math.sqrt(n[3*s+s]-n[3*o+o]-n[3*u+u]+1),t[s]=.5*i,i=.5/i,t[3]=(n[3*u+o]-n[3*o+u])*i,t[o]=(n[3*o+s]+n[3*s+o])*i,t[u]=(n[3*u+s]+n[3*s+u])*i}return t}}(),h.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.quat=h)}(t.exports)}(this)},{}],21:[function(require,module){"use strict";if("undefined"==typeof window)new(require("./source/worker.js"))(self);else{var mapboxgl=module.exports=window.mapboxgl={};mapboxgl.Map=require("./ui/map.js"),mapboxgl.Navigation=require("./ui/control/navigation.js"),mapboxgl.Attribution=require("./ui/control/attribution.js"),mapboxgl.Source=require("./source/source"),mapboxgl.GeoJSONSource=require("./source/geojsonsource"),mapboxgl.VideoSource=require("./source/videosource"),mapboxgl.Style=require("./style/style.js"),mapboxgl.LatLng=require("./geo/latlng.js"),mapboxgl.LatLngBounds=require("./geo/latlngbounds.js"),mapboxgl.Point=require("point-geometry"),mapboxgl.Evented=require("./util/evented.js"),mapboxgl.util=require("./util/util.js");var browser=require("./util/browser.js");mapboxgl.util.supported=browser.supported;var ajax=require("./util/ajax.js");mapboxgl.util.getJSON=ajax.getJSON,mapboxgl.util.getArrayBuffer=ajax.getArrayBuffer;var config=require("./util/config.js");mapboxgl.config=config,Object.defineProperty(mapboxgl,"accessToken",{get:function(){return config.ACCESS_TOKEN},set:function(token){config.ACCESS_TOKEN=token}})}},{"./geo/latlng.js":16,"./geo/latlngbounds.js":17,"./source/geojsonsource":35,"./source/source":39,"./source/videosource":44,"./source/worker.js":45,"./style/style.js":52,"./ui/control/attribution.js":66,"./ui/control/navigation.js":68,"./ui/map.js":73,"./util/ajax.js":75,"./util/browser.js":76,"./util/config.js":79,"./util/evented.js":81,"./util/util.js":86,"point-geometry":97}],22:[function(require,module){"use strict";function drawBackground(gl,painter,bucket,layerStyle,posMatrix,params,imageSprite){var shader,color=layerStyle["background-color"],image=layerStyle["background-image"],opacity=layerStyle["background-opacity"]||1;if(image){var imagePos=imageSprite.getPosition(image,!0);if(!imagePos)return;shader=painter.patternShader,gl.switchShader(shader,posMatrix),gl.uniform1i(shader.u_image,0),gl.uniform2fv(shader.u_pattern_tl,imagePos.tl),gl.uniform2fv(shader.u_pattern_br,imagePos.br),gl.uniform1f(shader.u_mix,painter.transform.zoomFraction),gl.uniform1f(shader.u_opacity,opacity);var transform=painter.transform,size=imagePos.size,center=transform.locationCoordinate(transform.center),scale=1/Math.pow(2,transform.zoomFraction),matrix=mat3.create();mat3.scale(matrix,matrix,[1/size[0],1/size[1],1]),mat3.translate(matrix,matrix,[center.column*transform.tileSize%size[0],center.row*transform.tileSize%size[1],0]),mat3.rotate(matrix,matrix,-transform.angle),mat3.scale(matrix,matrix,[scale*transform.width/2,-scale*transform.height/2,1]),gl.uniformMatrix3fv(shader.u_patternmatrix,!1,matrix),imageSprite.bind(gl,!0)}else shader=painter.fillShader,gl.switchShader(shader,params.padded||posMatrix),gl.uniform4fv(shader.u_color,color);gl.disable(gl.STENCIL_TEST),gl.bindBuffer(gl.ARRAY_BUFFER,painter.backgroundBuffer),gl.vertexAttribPointer(shader.a_pos,painter.backgroundBuffer.itemSize,gl.SHORT,!1,0,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,painter.backgroundBuffer.itemCount),gl.enable(gl.STENCIL_TEST),gl.stencilMask(0),gl.stencilFunc(gl.EQUAL,128,128)}var mat3=require("../lib/glmatrix.js").mat3;module.exports=drawBackground},{"../lib/glmatrix.js":20}],23:[function(require,module){"use strict";function drawComposited(gl,painter,buckets,layerStyle,params,style,layer){var texture=painter.namedRenderTextures[layer.id];return texture?(gl.disable(gl.STENCIL_TEST),gl.stencilMask(0),gl.switchShader(painter.compositeShader,painter.identityMatrix),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,texture),gl.uniform1i(painter.compositeShader.u_image,0),gl.uniform1f(painter.compositeShader.u_opacity,layerStyle["composite-opacity"]),gl.bindBuffer(gl.ARRAY_BUFFER,painter.backgroundBuffer),gl.vertexAttribPointer(painter.compositeShader.a_pos,2,gl.SHORT,!1,0,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),gl.enable(gl.STENCIL_TEST),void painter.freeRenderTexture(layer.id)):void 0}module.exports=drawComposited},{}],24:[function(require,module){"use strict";function drawDebug(gl,painter,tile,params){gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.switchShader(painter.debugShader,painter.tile.posMatrix,painter.tile.exMatrix),gl.bindBuffer(gl.ARRAY_BUFFER,painter.debugBuffer),gl.vertexAttribPointer(painter.debugShader.a_pos,painter.debugBuffer.itemSize,gl.SHORT,!1,0,0),gl.uniform4f(painter.debugShader.u_color,1,0,0,1),gl.lineWidth(4),gl.drawArrays(gl.LINE_STRIP,0,painter.debugBuffer.itemCount);var coord=params.z+"/"+params.x+"/"+params.y,vertices=textVertices(coord,50,200,5);gl.bindBuffer(gl.ARRAY_BUFFER,painter.debugTextBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Int16Array(vertices),gl.STREAM_DRAW),gl.vertexAttribPointer(painter.debugShader.a_pos,painter.debugTextBuffer.itemSize,gl.SHORT,!1,0,0),gl.lineWidth(8*browser.devicePixelRatio),gl.uniform4f(painter.debugShader.u_color,1,1,1,1),gl.drawArrays(gl.LINES,0,vertices.length/painter.debugTextBuffer.itemSize),gl.lineWidth(2*browser.devicePixelRatio),gl.uniform4f(painter.debugShader.u_color,0,0,0,1),gl.drawArrays(gl.LINES,0,vertices.length/painter.debugTextBuffer.itemSize),gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ONE)}var textVertices=require("../lib/debugtext.js"),browser=require("../util/browser.js");module.exports=drawDebug},{"../lib/debugtext.js":19,"../util/browser.js":76}],25:[function(require,module){"use strict";function drawFill(gl,painter,bucket,layerStyle,posMatrix,params,imageSprite){var vertex,elements,group,count,translatedPosMatrix=painter.translateMatrix(posMatrix,params.z,layerStyle["fill-translate"],layerStyle["fill-translate-anchor"]),color=layerStyle["fill-color"];
gl.stencilMask(63),gl.clear(gl.STENCIL_BUFFER_BIT),gl.stencilFunc(gl.NOTEQUAL,128,128),gl.stencilOpSeparate(gl.FRONT,gl.INCR_WRAP,gl.KEEP,gl.KEEP),gl.stencilOpSeparate(gl.BACK,gl.DECR_WRAP,gl.KEEP,gl.KEEP),gl.colorMask(!1,!1,!1,!1),gl.switchShader(painter.fillShader,translatedPosMatrix,painter.tile.exMatrix),vertex=bucket.buffers.fillVertex,vertex.bind(gl),elements=bucket.buffers.fillElement,elements.bind(gl);for(var i=0;i<bucket.elementGroups.groups.length;i++){group=bucket.elementGroups.groups[i];var offset=group.vertexStartIndex*vertex.itemSize;gl.vertexAttribPointer(painter.fillShader.a_pos,2,gl.SHORT,!1,4,offset+0),count=3*group.elementLength;var elementOffset=group.elementStartIndex*elements.itemSize;gl.drawElements(gl.TRIANGLES,count,gl.UNSIGNED_SHORT,elementOffset)}gl.colorMask(!0,!0,!0,!0),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP),gl.stencilMask(0);var strokeColor=layerStyle["fill-outline-color"];if(layerStyle["fill-antialias"]===!0&&params.antialiasing&&(!layerStyle["fill-image"]||strokeColor)){gl.switchShader(painter.outlineShader,translatedPosMatrix,painter.tile.exMatrix),gl.lineWidth(2*browser.devicePixelRatio),strokeColor?gl.stencilFunc(gl.EQUAL,128,128):gl.stencilFunc(gl.EQUAL,128,191),gl.uniform2f(painter.outlineShader.u_world,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.uniform4fv(painter.outlineShader.u_color,strokeColor?strokeColor:color),vertex=bucket.buffers.fillVertex,elements=bucket.buffers.fillElement;for(var k=0;k<bucket.elementGroups.groups.length;k++){group=bucket.elementGroups.groups[k],gl.vertexAttribPointer(painter.outlineShader.a_pos,2,gl.SHORT,!1,0,0);var begin=group.vertexStartIndex;count=group.vertexLength,gl.drawArrays(gl.LINE_STRIP,begin,count)}}var shader,image=layerStyle["fill-image"],opacity=layerStyle["fill-opacity"]||1;if(image){var imagePos=imageSprite.getPosition(image,!0);if(!imagePos)return;shader=painter.patternShader,gl.switchShader(shader,posMatrix),gl.uniform1i(shader.u_image,0),gl.uniform2fv(shader.u_pattern_tl,imagePos.tl),gl.uniform2fv(shader.u_pattern_br,imagePos.br),gl.uniform1f(shader.u_mix,painter.transform.zoomFraction),gl.uniform1f(shader.u_opacity,opacity);var factor=8/Math.pow(2,painter.transform.tileZoom-params.z),matrix=mat3.create();mat3.scale(matrix,matrix,[1/(imagePos.size[0]*factor),1/(imagePos.size[1]*factor),1,1]),gl.uniformMatrix3fv(shader.u_patternmatrix,!1,matrix),imageSprite.bind(gl,!0)}else shader=painter.fillShader,gl.switchShader(shader,params.padded||posMatrix),gl.uniform4fv(shader.u_color,color);gl.stencilFunc(gl.NOTEQUAL,0,63),gl.bindBuffer(gl.ARRAY_BUFFER,painter.tileExtentBuffer),gl.vertexAttribPointer(shader.a_pos,painter.tileExtentBuffer.itemSize,gl.SHORT,!1,0,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,painter.tileExtentBuffer.itemCount),gl.stencilMask(0),gl.stencilFunc(gl.EQUAL,128,128)}var browser=require("../util/browser.js"),mat3=require("../lib/glmatrix.js").mat3;module.exports=drawFill},{"../lib/glmatrix.js":20,"../util/browser.js":76}],26:[function(require,module){"use strict";var browser=require("../util/browser.js");module.exports=function(gl,painter,bucket,layerStyle,posMatrix,params,imageSprite){if(posMatrix=painter.translateMatrix(posMatrix,params.z,layerStyle["line-translate"],layerStyle["line-translate-anchor"]),!(layerStyle["line-width"]<=0)){var shader,gamma=1,antialiasing=gamma/browser.devicePixelRatio,lineOffset=layerStyle["line-offset"]/2,inset=Math.max(-1,lineOffset-layerStyle["line-width"]/2-antialiasing/2)+1,outset=lineOffset+layerStyle["line-width"]/2+antialiasing/2,imagePos=layerStyle["line-image"]&&imageSprite.getPosition(layerStyle["line-image"]);if(imagePos){var factor=8/Math.pow(2,painter.transform.tileZoom-params.z);imageSprite.bind(gl,!0),shader=painter.linepatternShader,gl.switchShader(shader,posMatrix,painter.tile.exMatrix),gl.uniform2fv(shader.u_pattern_size,[imagePos.size[0]*factor,imagePos.size[1]]),gl.uniform2fv(shader.u_pattern_tl,imagePos.tl),gl.uniform2fv(shader.u_pattern_br,imagePos.br),gl.uniform1f(shader.u_fade,painter.transform.zoomFraction)}else shader=painter.lineShader,gl.switchShader(shader,posMatrix,painter.tile.exMatrix),gl.uniform2fv(shader.u_dasharray,layerStyle["line-dasharray"]),gl.uniform4fv(shader.u_color,layerStyle["line-color"]);var tilePixelRatio=painter.transform.scale/(1<<params.z)/8;gl.uniform2fv(shader.u_linewidth,[outset,inset]),gl.uniform1f(shader.u_ratio,tilePixelRatio),gl.uniform1f(shader.u_blur,layerStyle["line-blur"]+antialiasing);var vertex=bucket.buffers.lineVertex;vertex.bind(gl);var element=bucket.buffers.lineElement;element.bind(gl);for(var groups=bucket.elementGroups.groups,i=0;i<groups.length;i++){var group=groups[i],offset=group.vertexStartIndex*vertex.itemSize;gl.vertexAttribPointer(shader.a_pos,4,gl.SHORT,!1,8,offset+0),gl.vertexAttribPointer(shader.a_extrude,2,gl.BYTE,!1,8,offset+6),gl.vertexAttribPointer(shader.a_linesofar,2,gl.SHORT,!1,8,offset+4);var count=3*group.elementLength,elementOffset=group.elementStartIndex*element.itemSize;gl.drawElements(gl.TRIANGLES,count,gl.UNSIGNED_SHORT,elementOffset)}}}},{"../util/browser.js":76}],27:[function(require,module){"use strict";function drawRaster(gl,painter,bucket,layerStyle,params,style,layer,tile){if(layer&&layer.layers&&!bucket.prerendered){bucket.prerendered=new PrerenderedTexture(gl,bucket.info,painter),bucket.prerendered.bindFramebuffer(),gl.clearStencil(128),gl.stencilMask(255),gl.clear(gl.STENCIL_BUFFER_BIT|gl.COLOR_BUFFER_BIT),gl.stencilMask(0),gl.viewport(0,0,bucket.prerendered.size,bucket.prerendered.size);var buffer=4096*bucket.prerendered.buffer,matrix=mat4.create();mat4.ortho(matrix,-buffer,4096+buffer,-4096-buffer,buffer,0,1),mat4.translate(matrix,matrix,[0,-4096,0]),params.padded=mat4.create(),mat4.ortho(params.padded,0,4096,-4096,0,0,1),mat4.translate(params.padded,params.padded,[0,-4096,0]),painter.draw(tile,style,layer.layers,params,matrix),delete params.padded,bucket.info["raster-blur"]>0&&bucket.prerendered.blur(painter,bucket.info["raster-blur"]),bucket.prerendered.unbindFramebuffer(),gl.viewport(0,0,painter.width,painter.height)}var texture=bucket.tile?bucket.tile:bucket.prerendered;gl.disable(gl.STENCIL_TEST);var shader=painter.rasterShader;gl.switchShader(shader,painter.tile.posMatrix,painter.tile.exMatrix),gl.uniform1f(shader.u_brightness_low,layerStyle["raster-brightness"][0]),gl.uniform1f(shader.u_brightness_high,layerStyle["raster-brightness"][1]),gl.uniform1f(shader.u_saturation_factor,saturationFactor(layerStyle["raster-saturation"])),gl.uniform1f(shader.u_contrast_factor,contrastFactor(layerStyle["raster-contrast"])),gl.uniform3fv(shader.u_spin_weights,spinWeights(layerStyle["raster-hue-rotate"]));var parentTile,opacities;layer&&layer.layers?(parentTile=null,opacities=[layerStyle["raster-opacity"],0]):(parentTile=findParent(texture),opacities=getOpacities(texture,parentTile));var parentScaleBy,parentTL;if(gl.activeTexture(gl.TEXTURE0),texture.bind(gl),parentTile){gl.activeTexture(gl.TEXTURE1),parentTile.bind(gl);var tilePos=TileCoord.fromID(texture.id),parentPos=parentTile&&TileCoord.fromID(parentTile.id);parentScaleBy=Math.pow(2,parentPos.z-tilePos.z),parentTL=[tilePos.x*parentScaleBy%1,tilePos.y*parentScaleBy%1]}else opacities[1]=0;var bufferScale=bucket.prerendered?4096*(1+2*bucket.prerendered.buffer)/4096:1;gl.uniform2fv(shader.u_tl_parent,parentTL||[0,0]),gl.uniform1f(shader.u_scale_parent,parentScaleBy||1),gl.uniform1f(shader.u_buffer_scale,bufferScale),gl.uniform1f(shader.u_opacity0,opacities[0]),gl.uniform1f(shader.u_opacity1,opacities[1]),gl.uniform1i(shader.u_image0,0),gl.uniform1i(shader.u_image1,1),gl.bindBuffer(gl.ARRAY_BUFFER,texture.boundsBuffer||painter.tileExtentBuffer),gl.vertexAttribPointer(shader.a_pos,2,gl.SHORT,!1,8,0),gl.vertexAttribPointer(shader.a_texture_pos,2,gl.SHORT,!1,8,4),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),gl.enable(gl.STENCIL_TEST)}function findParent(tile){var source=tile.source;if(source){var parentTiles={};return source._findLoadedParent(tile.id,source.options.minZoom,parentTiles),source.tiles[Object.keys(parentTiles)[0]]}}function clamp(n,min,max){return Math.max(min,Math.min(max,n))}function spinWeights(angle){var s=Math.sin(angle),c=Math.cos(angle);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}function contrastFactor(contrast){return contrast>0?1/(1-contrast):1+contrast}function saturationFactor(saturation){return saturation>0?1-1/(1.001-saturation):-saturation}function getOpacities(tile,parentTile){if(!tile.source)return[1,0];var now=(new Date).getTime(),fadeDuration=tile.source.map.style.rasterFadeDuration,sinceTile=(now-tile.timeAdded)/fadeDuration,sinceParent=parentTile?(now-parentTile.timeAdded)/fadeDuration:-1,tilePos=TileCoord.fromID(tile.id),parentPos=parentTile&&TileCoord.fromID(parentTile.id),idealZ=tile.source._coveringZoomLevel(tile.source._getZoom()),parentFurther=parentTile?Math.abs(parentPos.z-idealZ)>Math.abs(tilePos.z-idealZ):!1,opacity=[];return!parentTile||parentFurther?(opacity[0]=clamp(sinceTile,0,1),opacity[1]=1-opacity[0]):(opacity[0]=clamp(1-sinceParent,0,1),opacity[1]=1-opacity[0]),opacity}var TileCoord=require("../source/tilecoord.js"),PrerenderedTexture=require("./prerendered.js"),mat4=require("../lib/glmatrix.js").mat4;module.exports=drawRaster},{"../lib/glmatrix.js":20,"../source/tilecoord.js":41,"./prerendered.js":33}],28:[function(require,module){"use strict";function drawSymbols(gl,painter,bucket,layerStyle,posMatrix,params,imageSprite){bucket.elementGroups.text.groups.length&&drawSymbol(gl,painter,bucket,layerStyle,posMatrix,params,imageSprite,"text"),bucket.elementGroups.icon.groups.length&&drawSymbol(gl,painter,bucket,layerStyle,posMatrix,params,imageSprite,"icon")}function drawSymbol(gl,painter,bucket,layerStyle,posMatrix,params,imageSprite,prefix){posMatrix=painter.translateMatrix(posMatrix,params.z,layerStyle[prefix+"-translate"],layerStyle[prefix+"-translate-anchor"]);var info=bucket.info,exMatrix=mat4.clone(painter.projectionMatrix),angleOffset="map"===info[prefix+"-rotation-alignment"]?painter.transform.angle:0;angleOffset&&mat4.rotateZ(exMatrix,exMatrix,angleOffset);var fontSize=layerStyle[prefix+"-size"]||info[prefix+"-max-size"],fontScale=fontSize/defaultSizes[prefix];mat4.scale(exMatrix,exMatrix,[fontScale,fontScale,1]);var shader,buffer,texsize,text="text"===prefix,sdf=text||bucket.elementGroups.sdfIcons;if(text||imageSprite.loaded()){gl.activeTexture(gl.TEXTURE0),shader=sdf?painter.sdfShader:painter.iconShader,text?(painter.glyphAtlas.updateTexture(gl),buffer=bucket.buffers.glyphVertex,texsize=[painter.glyphAtlas.width/4,painter.glyphAtlas.height/4]):(imageSprite.bind(gl,void 0!==angleOffset||params.rotating||params.zooming||1!=fontScale||sdf),buffer=bucket.buffers.iconVertex,texsize=[imageSprite.img.width,imageSprite.img.height]),gl.switchShader(shader,posMatrix,exMatrix),gl.uniform1i(shader.u_texture,0),gl.uniform2fv(shader.u_texsize,texsize),buffer.bind(gl);var ubyte=gl.UNSIGNED_BYTE,stride=text?16:20;gl.vertexAttribPointer(shader.a_pos,2,gl.SHORT,!1,stride,0),gl.vertexAttribPointer(shader.a_offset,2,gl.SHORT,!1,stride,4),gl.vertexAttribPointer(shader.a_labelminzoom,1,ubyte,!1,stride,8),gl.vertexAttribPointer(shader.a_minzoom,1,ubyte,!1,stride,9),gl.vertexAttribPointer(shader.a_maxzoom,1,ubyte,!1,stride,10),gl.vertexAttribPointer(shader.a_angle,1,ubyte,!1,stride,11),gl.vertexAttribPointer(shader.a_rangeend,1,ubyte,!1,stride,12),gl.vertexAttribPointer(shader.a_rangestart,1,ubyte,!1,stride,13),text?gl.vertexAttribPointer(shader.a_tex,2,ubyte,!1,stride,14):gl.vertexAttribPointer(shader.a_tex,2,gl.SHORT,!1,stride,16);var angle=Math.round(painter.transform.angle/Math.PI*128),zoomAdjust=Math.log(fontSize/info[prefix+"-max-size"])/Math.LN2||0,flip="viewport"!==info[prefix+"-rotation-alignment"]&&info[prefix+"-keep-upright"];gl.uniform1f(shader.u_flip,flip?1:0),gl.uniform1f(shader.u_angle,(angle+256)%256),gl.uniform1f(shader.u_zoom,10*(painter.transform.zoom-zoomAdjust));var f=painter.frameHistory.getFadeProperties(300);gl.uniform1f(shader.u_fadedist,10*f.fadedist),gl.uniform1f(shader.u_minfadezoom,Math.floor(10*f.minfadezoom)),gl.uniform1f(shader.u_maxfadezoom,Math.floor(10*f.maxfadezoom)),gl.uniform1f(shader.u_fadezoom,10*(painter.transform.zoom+f.bump)),sdf||gl.uniform1f(shader.u_opacity,layerStyle["icon-opacity"]);var sdfFontSize=text?24:1,sdfPx=8,blurOffset=1.19,haloOffset=6;sdf&&(gl.uniform1f(shader.u_gamma,.105*sdfFontSize/fontSize/browser.devicePixelRatio),gl.uniform4fv(shader.u_color,layerStyle[prefix+"-color"]),gl.uniform1f(shader.u_buffer,.75));var begin=bucket.elementGroups[prefix].groups[0].vertexStartIndex,len=bucket.elementGroups[prefix].groups[0].vertexLength;gl.drawArrays(gl.TRIANGLES,begin,len),sdf&&layerStyle[prefix+"-halo-color"]&&(gl.uniform1f(shader.u_gamma,layerStyle[prefix+"-halo-blur"]*blurOffset/(fontSize/sdfFontSize)/sdfPx+.105*sdfFontSize/fontSize/browser.devicePixelRatio),gl.uniform4fv(shader.u_color,layerStyle[prefix+"-halo-color"]),gl.uniform1f(shader.u_buffer,(haloOffset-layerStyle[prefix+"-halo-width"]/(fontSize/sdfFontSize))/sdfPx),gl.drawArrays(gl.TRIANGLES,begin,len))}}var browser=require("../util/browser.js"),mat4=require("../lib/glmatrix.js").mat4;module.exports=drawSymbols;var defaultSizes={icon:1,text:24}},{"../lib/glmatrix.js":20,"../util/browser.js":76}],29:[function(require,module){"use strict";function drawVertices(gl,painter,bucket){gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.switchShader(painter.dotShader,painter.tile.posMatrix,painter.tile.exMatrix),gl.uniform1f(painter.dotShader.u_size,4*browser.devicePixelRatio),gl.uniform1f(painter.dotShader.u_blur,.25),gl.uniform4fv(painter.dotShader.u_color,[.25,0,0,.25]);var vertex,groups,group,begin,count;if(bucket.info.fill){vertex=bucket.buffers.fillVertex,vertex.bind(gl),groups=bucket.elementGroups.groups;for(var i=0;i<groups.length;i++)group=groups[i],begin=group.vertexStartIndex,count=group.vertexLength,gl.vertexAttribPointer(painter.dotShader.a_pos,2,gl.SHORT,!1,0,0),gl.drawArrays(gl.POINTS,begin,count)}var newPosMatrix=mat4.clone(painter.tile.posMatrix);if(mat4.scale(newPosMatrix,newPosMatrix,[.5,.5,1]),gl.switchShader(painter.dotShader,newPosMatrix,painter.tile.exMatrix),bucket.info.line){vertex=bucket.buffers.lineVertex,vertex.bind(gl),groups=bucket.elementGroups.groups;for(var k=0;k<groups.length;k++)group=groups[k],begin=group.vertexStartIndex,count=group.vertexLength,gl.vertexAttribPointer(painter.dotShader.a_pos,2,gl.SHORT,!1,0,0),gl.drawArrays(gl.POINTS,begin,count)}gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ONE)}var browser=require("../util/browser.js"),mat4=require("../lib/glmatrix.js").mat4;module.exports=drawVertices},{"../lib/glmatrix.js":20,"../util/browser.js":76}],30:[function(require,module){"use strict";function FrameHistory(){}module.exports=FrameHistory,FrameHistory.prototype.getFadeProperties=function(duration){void 0===duration&&(duration=300);for(var currentTime=(new Date).getTime();frameHistory.length>3&&frameHistory[1].time+duration<currentTime;)frameHistory.shift();frameHistory[1].time+duration<currentTime&&(frameHistory[0].z=frameHistory[1].z);var frameLen=frameHistory.length,startingZ=frameHistory[0].z,lastFrame=frameHistory[frameLen-1],endingZ=lastFrame.z,lowZ=Math.min(startingZ,endingZ),highZ=Math.max(startingZ,endingZ),zoomDiff=lastFrame.z-frameHistory[1].z,timeDiff=lastFrame.time-frameHistory[1].time,fadedist=zoomDiff/(timeDiff/duration);isNaN(fadedist);var bump=(currentTime-lastFrame.time)/duration*fadedist;return{fadedist:fadedist,minfadezoom:lowZ,maxfadezoom:highZ,bump:bump}};var frameHistory=[];FrameHistory.prototype.record=function(zoom){var currentTime=(new Date).getTime();frameHistory.length||frameHistory.push({time:0,z:zoom},{time:0,z:zoom}),(2===frameHistory.length||frameHistory[frameHistory.length-1].z!==zoom)&&frameHistory.push({time:currentTime,z:zoom})}},{}],31:[function(require,module,exports){"use strict";var shaders=require("./shaders.js");exports.extend=function(context){return context.getShader=function(name,type){var kind=type==this.FRAGMENT_SHADER?"fragment":"vertex";if(!shaders[name]||!shaders[name][kind])throw new Error("Could not find shader "+name);var shader=this.createShader(type);if(this.shaderSource(shader,shaders[name][kind]),this.compileShader(shader),!this.getShaderParameter(shader,this.COMPILE_STATUS))throw new Error(this.getShaderInfoLog(shader));return shader},context.initializeShader=function(name,attributes,uniforms){var shader={program:this.createProgram(),fragment:this.getShader(name,this.FRAGMENT_SHADER),vertex:this.getShader(name,this.VERTEX_SHADER),attributes:[]};if(this.attachShader(shader.program,shader.vertex),this.attachShader(shader.program,shader.fragment),this.linkProgram(shader.program),this.getProgramParameter(shader.program,this.LINK_STATUS)){for(var i=0;i<attributes.length;i++)shader[attributes[i]]=this.getAttribLocation(shader.program,attributes[i]),shader.attributes.push(shader[attributes[i]]);for(var k=0;k<uniforms.length;k++)shader[uniforms[k]]=this.getUniformLocation(shader.program,uniforms[k])}else alert("Could not initialize shader "+name);return shader},context.switchShader=function(shader,posMatrix,exMatrix){if(this.currentShader!==shader){this.useProgram(shader.program);for(var enabled=this.currentShader?this.currentShader.attributes:[],required=shader.attributes,i=0;i<enabled.length;i++)required.indexOf(enabled[i])<0&&this.disableVertexAttribArray(enabled[i]);for(var j=0;j<required.length;j++)enabled.indexOf(required[j])<0&&this.enableVertexAttribArray(required[j]);this.currentShader=shader}shader.posMatrix!==posMatrix&&(this.uniformMatrix4fv(shader.u_posmatrix,!1,posMatrix),shader.posMatrix=posMatrix),exMatrix&&shader.exMatrix!==exMatrix&&shader.u_exmatrix&&(this.uniformMatrix4fv(shader.u_exmatrix,!1,exMatrix),shader.exMatrix=exMatrix)},context}},{"./shaders.js":34}],32:[function(require,module){"use strict";function GLPainter(gl,transform){this.gl=glutil.extend(gl),this.transform=transform,this.framebufferObject=null,this.renderTextures=[],this.namedRenderTextures={},this.reusableTextures={},this.preFbos={},this.tileExtent=4096,this.frameHistory=new FrameHistory,this.setup()}var glutil=require("./glutil.js"),browser=require("../util/browser.js"),GlyphAtlas=require("../symbol/glyphatlas.js"),glmatrix=require("../lib/glmatrix.js"),FrameHistory=require("./framehistory.js"),mat4=glmatrix.mat4,drawSymbol=require("./drawsymbol.js"),drawLine=require("./drawline.js"),drawFill=require("./drawfill.js"),drawRaster=require("./drawraster.js"),drawDebug=require("./drawdebug.js"),drawBackground=require("./drawbackground.js"),drawComposited=require("./drawcomposited.js"),drawVertices=require("./drawvertices.js");module.exports=GLPainter,GLPainter.prototype.resize=function(width,height){var gl=this.gl;this.projectionMatrix=mat4.create(),mat4.ortho(this.projectionMatrix,0,width,height,0,0,-1),this.width=width*browser.devicePixelRatio,this.height=height*browser.devicePixelRatio,gl.viewport(0,0,this.width,this.height);for(var i=this.renderTextures.length-1;i>=0;i--)gl.deleteTexture(this.renderTextures.pop());this.stencilBuffer&&(gl.deleteRenderbuffer(this.stencilBuffer),delete this.stencilBuffer)},GLPainter.prototype.setup=function(){var gl=this.gl;gl.verbose=!0,gl.enable(gl.BLEND),gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ONE),gl.enable(gl.STENCIL_TEST),this.glyphAtlas=new GlyphAtlas(1024,1024),this.glyphAtlas.bind(gl),this.debugShader=gl.initializeShader("debug",["a_pos"],["u_posmatrix","u_pointsize","u_color"]),this.compositeShader=gl.initializeShader("composite",["a_pos"],["u_posmatrix","u_opacity"]),this.gaussianShader=gl.initializeShader("gaussian",["a_pos"],["u_posmatrix","u_opacity","u_image","u_offset"]),this.rasterShader=gl.initializeShader("raster",["a_pos","a_texture_pos"],["u_posmatrix","u_brightness_low","u_brightness_high","u_saturation_factor","u_spin_weights","u_contrast_factor","u_opacity0","u_opacity1","u_image0","u_image1","u_tl_parent","u_scale_parent","u_buffer_scale"]),this.lineShader=gl.initializeShader("line",["a_pos","a_extrude","a_linesofar"],["u_posmatrix","u_exmatrix","u_linewidth","u_color","u_debug","u_ratio","u_dasharray","u_blur"]),this.linepatternShader=gl.initializeShader("linepattern",["a_pos","a_extrude","a_linesofar"],["u_posmatrix","u_exmatrix","u_linewidth","u_ratio","u_pattern_size","u_pattern_tl","u_pattern_br","u_point","u_blur","u_fade"]),this.dotShader=gl.initializeShader("dot",["a_pos"],["u_posmatrix","u_size","u_color","u_blur"]),this.sdfShader=gl.initializeShader("sdf",["a_pos","a_tex","a_offset","a_angle","a_minzoom","a_maxzoom","a_rangeend","a_rangestart","a_labelminzoom"],["u_posmatrix","u_exmatrix","u_texture","u_texsize","u_color","u_gamma","u_buffer","u_angle","u_zoom","u_flip","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom"]),this.iconShader=gl.initializeShader("icon",["a_pos","a_tex","a_offset","a_angle","a_minzoom","a_maxzoom","a_rangeend","a_rangestart","a_labelminzoom"],["u_posmatrix","u_exmatrix","u_texture","u_texsize","u_angle","u_zoom","u_flip","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom","u_opacity"]),this.outlineShader=gl.initializeShader("outline",["a_pos"],["u_posmatrix","u_color","u_world"]),this.patternShader=gl.initializeShader("pattern",["a_pos"],["u_posmatrix","u_pattern_tl","u_pattern_br","u_mix","u_patternmatrix","u_opacity","u_image"]),this.fillShader=gl.initializeShader("fill",["a_pos"],["u_posmatrix","u_color"]),this.identityMatrix=mat4.create(),this.backgroundBuffer=gl.createBuffer(),this.backgroundBuffer.itemSize=2,this.backgroundBuffer.itemCount=4,gl.bindBuffer(gl.ARRAY_BUFFER,this.backgroundBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Int16Array([-1,-1,1,-1,-1,1,1,1]),gl.STATIC_DRAW),this.tileExtentBuffer=gl.createBuffer(),this.tileExtentBuffer.itemSize=4,this.tileExtentBuffer.itemCount=4,gl.bindBuffer(gl.ARRAY_BUFFER,this.tileExtentBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Int16Array([0,0,0,0,this.tileExtent,0,32767,0,0,this.tileExtent,0,32767,this.tileExtent,this.tileExtent,32767,32767]),gl.STATIC_DRAW),this.debugBuffer=gl.createBuffer(),this.debugBuffer.itemSize=2,this.debugBuffer.itemCount=5,gl.bindBuffer(gl.ARRAY_BUFFER,this.debugBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Int16Array([0,0,4095,0,4095,4095,0,4095,0,0]),gl.STATIC_DRAW),this.debugTextBuffer=gl.createBuffer(),this.debugTextBuffer.itemSize=2},GLPainter.prototype.clearColor=function(){var gl=this.gl;gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT)},GLPainter.prototype.clearStencil=function(){var gl=this.gl;gl.clearStencil(0),gl.stencilMask(255),gl.clear(gl.STENCIL_BUFFER_BIT)},GLPainter.prototype.drawClippingMask=function(){var gl=this.gl;gl.switchShader(this.fillShader,this.tile.posMatrix,this.tile.exMatrix),gl.colorMask(!1,!1,!1,!1),gl.clearStencil(0),gl.stencilMask(191),gl.clear(gl.STENCIL_BUFFER_BIT),gl.stencilFunc(gl.EQUAL,192,64),gl.stencilMask(192),gl.stencilOp(gl.REPLACE,gl.KEEP,gl.KEEP),gl.bindBuffer(gl.ARRAY_BUFFER,this.tileExtentBuffer),gl.vertexAttribPointer(this.fillShader.a_pos,this.tileExtentBuffer.itemSize,gl.SHORT,!1,8,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,this.tileExtentBuffer.itemCount),gl.stencilFunc(gl.EQUAL,128,128),gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE),gl.stencilMask(0),gl.colorMask(!0,!0,!0,!0)},GLPainter.prototype.bindRenderTexture=function(name){var gl=this.gl;if(name){if(this.framebufferObject||(this.framebufferObject=gl.createFramebuffer()),gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebufferObject),!this.stencilBuffer){var stencil=this.stencilBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.STENCIL_INDEX8,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.STENCIL_ATTACHMENT,gl.RENDERBUFFER,this.stencilBuffer)}var texture=this.renderTextures.pop();texture||(texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.drawingBufferWidth,gl.drawingBufferHeight,0,gl.RGBA,gl.UNSIGNED_BYTE,null)),this.namedRenderTextures[name]=texture,gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0)}else gl.bindFramebuffer(gl.FRAMEBUFFER,null);this.clearColor()},GLPainter.prototype.freeRenderTexture=function(name){this.renderTextures.push(this.namedRenderTextures[name]),delete this.namedRenderTextures[name]},GLPainter.prototype.draw=function(tile,style,layers,params,matrix){this.tile=tile,tile&&!matrix&&this.drawClippingMask(),!Array.isArray(layers),this.frameHistory.record(this.transform.zoom);for(var i=0,len=layers.length;len>i;i++)this.applyStyle(layers[i],style,tile&&tile.buckets,params,tile,matrix);params.debug&&drawDebug(this.gl,this,tile,params)},GLPainter.prototype.applyStyle=function(layer,style,buckets,params,tile,matrix){var gl=this.gl,layerStyle=style.computed[layer.id];if(layerStyle&&!layerStyle.hidden)if(layer.layers)"composite"===layer.type?drawComposited(gl,this,buckets,layerStyle,params,style,layer):"raster"===layer.type&&drawRaster(gl,this,buckets[layer.bucket],layerStyle,params,style,layer,tile);else if(params.background)drawBackground(gl,this,void 0,layerStyle,this.identityMatrix,params,style.sprite);else{var bucket=buckets[layer.bucket];if(!bucket||bucket.hasData&&!bucket.hasData())return;var type=bucket.type;if(bucket.minZoom&&this.transform.zoom<bucket.minZoom)return;if(bucket.maxZoom&&this.transform.zoom>=bucket.maxZoom)return;var draw="symbol"===type?drawSymbol:"fill"===type?drawFill:"line"===type?drawLine:"raster"===type?drawRaster:null;if(draw){var useMatrix=matrix||this.tile.posMatrix;draw(gl,this,bucket,layerStyle,useMatrix,params,style.sprite)}params.vertices&&!layer.layers&&drawVertices(gl,this,bucket)}},GLPainter.prototype.drawStencilBuffer=function(){var gl=this.gl;gl.switchShader(this.fillShader,this.identityMatrix),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.stencilMask(0),gl.stencilFunc(gl.EQUAL,128,128),gl.bindBuffer(gl.ARRAY_BUFFER,this.backgroundBuffer),gl.vertexAttribPointer(this.fillShader.a_pos,this.backgroundBuffer.itemSize,gl.SHORT,!1,0,0),gl.uniform4fv(this.fillShader.u_color,[0,0,0,.5]),gl.drawArrays(gl.TRIANGLE_STRIP,0,this.backgroundBuffer.itemCount),gl.blendFunc(gl.ONE_MINUS_DST_ALPHA,gl.ONE)},GLPainter.prototype.translateMatrix=function(matrix,z,translate,anchor){if(!translate[0]&&!translate[1])return matrix;if("viewport"===anchor){var sin_a=Math.sin(-this.transform.angle),cos_a=Math.cos(-this.transform.angle);translate=[translate[0]*cos_a-translate[1]*sin_a,translate[0]*sin_a+translate[1]*cos_a]}var tilePixelRatio=this.transform.scale/(1<<z)/8,translation=[translate[0]/tilePixelRatio,translate[1]/tilePixelRatio,0],translatedMatrix=new Float32Array(16);return mat4.translate(translatedMatrix,matrix,translation),translatedMatrix},GLPainter.prototype.saveTexture=function(texture){var textures=this.reusableTextures[texture.size];textures?textures.push(texture):this.reusableTextures[texture.size]=[texture]},GLPainter.prototype.getTexture=function(size){var textures=this.reusableTextures[size];return textures&&textures.length>0?textures.pop():null}},{"../lib/glmatrix.js":20,"../symbol/glyphatlas.js":59,"../util/browser.js":76,"./drawbackground.js":22,"./drawcomposited.js":23,"./drawdebug.js":24,"./drawfill.js":25,"./drawline.js":26,"./drawraster.js":27,"./drawsymbol.js":28,"./drawvertices.js":29,"./framehistory.js":30,"./glutil.js":31}],33:[function(require,module){"use strict";function PrerenderedTexture(gl,bucket,painter){this.gl=gl,this.buffer=bucket["raster-buffer"]||1/32,this.size=(bucket["raster-size"]||512)*(1+2*this.buffer),this.painter=painter,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.size]}var glmatrix=require("../lib/glmatrix.js"),mat4=glmatrix.mat4;module.exports=PrerenderedTexture,PrerenderedTexture.prototype.bindFramebuffer=function(){var gl=this.gl;if(this.texture=this.painter.getTexture(this.size),this.texture?gl.bindTexture(gl.TEXTURE_2D,this.texture):(this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.size,this.size,0,gl.RGBA,gl.UNSIGNED_BYTE,null),this.texture.size=this.size),this.fbos)this.fbo=this.fbos.pop(),gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0);else{this.fbo=gl.createFramebuffer();var stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil),gl.renderbufferStorage(gl.RENDERBUFFER,gl.STENCIL_INDEX8,this.size,this.size),gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)}},PrerenderedTexture.prototype.unbindFramebuffer=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,null),this.fbos?this.fbos.push(this.fbo):this.painter.preFbos[this.size]=[this.fbo]},PrerenderedTexture.prototype.bind=function(){if(!this.texture)throw"pre-rendered texture does not exist";var gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,this.texture)},PrerenderedTexture.prototype.blur=function(painter,passes){var gl=this.gl,originalTexture=this.texture,secondaryTexture=this.painter.getTexture(this.size);secondaryTexture?gl.bindTexture(gl.TEXTURE_2D,secondaryTexture):(secondaryTexture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,secondaryTexture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.size,this.size,0,gl.RGBA,gl.UNSIGNED_BYTE,null),secondaryTexture.size=this.size),gl.bindTexture(gl.TEXTURE_2D,null);var matrix=mat4.create();mat4.ortho(matrix,0,4096,-4096,0,0,1),mat4.translate(matrix,matrix,[0,-4096,0]),gl.switchShader(painter.gaussianShader,matrix),gl.activeTexture(gl.TEXTURE0),gl.uniform1i(painter.gaussianShader.u_image,0),gl.uniform1f(painter.gaussianShader.u_opacity,1);for(var i=0;passes>i;i++)gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,secondaryTexture,0),gl.clear(gl.COLOR_BUFFER_BIT),gl.uniform2fv(painter.gaussianShader.u_offset,[1/this.size,0]),gl.bindTexture(gl.TEXTURE_2D,originalTexture),gl.bindBuffer(gl.ARRAY_BUFFER,painter.tileExtentBuffer),gl.vertexAttribPointer(painter.gaussianShader.a_pos,2,gl.SHORT,!1,8,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,originalTexture,0),gl.clear(gl.COLOR_BUFFER_BIT),gl.uniform2fv(painter.gaussianShader.u_offset,[0,1/this.size]),gl.bindTexture(gl.TEXTURE_2D,secondaryTexture),gl.bindBuffer(gl.ARRAY_BUFFER,painter.tileExtentBuffer),gl.vertexAttribPointer(painter.gaussianShader.a_pos,2,gl.SHORT,!1,8,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,4);this.painter.saveTexture(secondaryTexture)}},{"../lib/glmatrix.js":20}],34:[function(require,module){"use strict";module.exports={composite:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_posmatrix;\nvarying highp vec2 a;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  vec4 tmpvar_2;\n  tmpvar_2 = (u_posmatrix * tmpvar_1);\n  gl_Position = tmpvar_2;\n  a = ((tmpvar_2.xy / 2.0) + 0.5);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_image;\nuniform float u_opacity;\nvarying vec2 a;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (texture2D (u_image, a) * u_opacity);\n  gl_FragColor = tmpvar_1;\n}\n\n"},debug:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform float u_pointsize;\nuniform mat4 u_posmatrix;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.w = 1.0;\n  tmpvar_1.xy = a_pos;\n  tmpvar_1.z = float((a_pos.x >= 32767.0));\n  gl_Position = (u_posmatrix * tmpvar_1);\n  gl_PointSize = u_pointsize;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvoid main ()\n{\n  gl_FragColor = u_color;\n}\n\n"},dot:{vertex:"precision mediump float;\nuniform mat4 u_posmatrix;\nuniform float u_size;\nattribute vec2 a_pos;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_posmatrix * tmpvar_1);\n  gl_PointSize = u_size;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nuniform float u_blur;\nvoid main ()\n{\n  mediump vec2 x_1;\n  x_1 = (gl_PointCoord - 0.5);\n  mediump float tmpvar_2;\n  tmpvar_2 = clamp (((\n    sqrt(dot (x_1, x_1))\n   - 0.5) / (\n    (0.5 - u_blur)\n   - 0.5)), 0.0, 1.0);\n  gl_FragColor = (u_color * (tmpvar_2 * (tmpvar_2 * \n    (3.0 - (2.0 * tmpvar_2))\n  )));\n}\n\n"},fill:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_posmatrix;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_posmatrix * tmpvar_1);\n  gl_PointSize = 2.0;\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvoid main ()\n{\n  gl_FragColor = u_color;\n}\n\n"},gaussian:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_posmatrix;\nuniform vec2 u_offset;\nvarying highp vec2 b[3];\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  vec4 tmpvar_2;\n  tmpvar_2 = (u_posmatrix * tmpvar_1);\n  gl_Position = tmpvar_2;\n  highp vec2 tmpvar_3;\n  tmpvar_3 = ((tmpvar_2.xy / 2.0) + 0.5);\n  b[0] = tmpvar_3;\n  vec2 cse_4;\n  cse_4 = (u_offset * 1.18243);\n  b[1] = (tmpvar_3 + cse_4);\n  b[2] = (tmpvar_3 - cse_4);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 b[3];\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (((texture2D (u_image, b[0]) * 0.40262) + (texture2D (u_image, b[1]) * 0.29869)) + (texture2D (u_image, b[2]) * 0.29869));\n  gl_FragColor = tmpvar_1;\n}\n\n"},line:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute float a_linesofar;\nuniform mat4 u_posmatrix;\nuniform mat4 u_exmatrix;\nuniform float u_ratio;\nuniform vec2 u_linewidth;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  vec2 c_1;\n  vec2 tmpvar_2;\n  tmpvar_2 = (vec2(mod (a_pos, 2.0)));\n  c_1.x = tmpvar_2.x;\n  c_1.y = sign((tmpvar_2.y - 0.5));\n  a = c_1;\n  vec4 tmpvar_3;\n  tmpvar_3.zw = vec2(0.0, 1.0);\n  tmpvar_3.xy = floor((a_pos / 2.0));\n  vec4 tmpvar_4;\n  tmpvar_4.zw = vec2(0.0, 0.0);\n  tmpvar_4.xy = (u_linewidth.x * (a_extrude / 63.0));\n  gl_Position = ((u_posmatrix * tmpvar_3) + (u_exmatrix * tmpvar_4));\n  b = (a_linesofar * u_ratio);\n}\n\n",fragment:"precision mediump float;\nuniform float u_debug;\nuniform float u_blur;\nuniform vec2 u_linewidth;\nuniform vec2 u_dasharray;\nuniform vec4 u_color;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float tmpvar_1;\n  tmpvar_1 = (sqrt(dot (a, a)) * u_linewidth.x);\n  float tmpvar_2;\n  tmpvar_2 = (float(mod (b, (u_dasharray.x + u_dasharray.y))));\n  gl_FragColor = (u_color * (clamp (\n    (min ((tmpvar_1 - (u_linewidth.y - u_blur)), (u_linewidth.x - tmpvar_1)) / u_blur)\n  , 0.0, 1.0) * max (\n    float((-(u_dasharray.y) >= 0.0))\n  , \n    clamp (min (tmpvar_2, (u_dasharray.x - tmpvar_2)), 0.0, 1.0)\n  )));\n  if ((u_debug > 0.0)) {\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n  };\n}\n\n"},linepattern:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute float a_linesofar;\nuniform mat4 u_posmatrix;\nuniform mat4 u_exmatrix;\nuniform float u_point;\nuniform vec2 u_linewidth;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  vec2 c_1;\n  vec2 tmpvar_2;\n  tmpvar_2 = (vec2(mod (a_pos, 2.0)));\n  c_1.x = tmpvar_2.x;\n  c_1.y = sign((tmpvar_2.y - 0.5));\n  a = c_1;\n  vec4 tmpvar_3;\n  tmpvar_3.zw = vec2(0.0, 1.0);\n  tmpvar_3.xy = floor((a_pos / 2.0));\n  vec4 tmpvar_4;\n  tmpvar_4.w = 0.0;\n  tmpvar_4.xy = ((u_linewidth.x * (a_extrude / 63.0)) * (1.0 - u_point));\n  tmpvar_4.z = (float((a_pos.x >= 32767.0)) + (u_point * float(\n    (c_1.y >= 1.0)\n  )));\n  gl_Position = ((u_posmatrix * tmpvar_3) + (u_exmatrix * tmpvar_4));\n  b = a_linesofar;\n  gl_PointSize = ((2.0 * u_linewidth.x) - 1.0);\n}\n\n",fragment:"precision mediump float;\nuniform float u_point;\nuniform float u_blur;\nuniform float u_fade;\nuniform vec2 u_linewidth;\nuniform vec2 u_pattern_size;\nuniform vec2 u_pattern_tl;\nuniform vec2 u_pattern_br;\nuniform sampler2D u_image;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  lowp vec4 j_1;\n  mediump vec2 x_2;\n  x_2 = ((gl_PointCoord * 2.0) - 1.0);\n  mediump float tmpvar_3;\n  tmpvar_3 = (((\n    sqrt(dot (a, a))\n   * \n    (1.0 - u_point)\n  ) + (u_point * \n    sqrt(dot (x_2, x_2))\n  )) * u_linewidth.x);\n  float tmpvar_4;\n  tmpvar_4 = (float(mod ((b / u_pattern_size.x), 1.0)));\n  float tmpvar_5;\n  tmpvar_5 = (0.5 + ((a.y * u_linewidth.x) / u_pattern_size.y));\n  vec2 tmpvar_6;\n  tmpvar_6.x = tmpvar_4;\n  tmpvar_6.y = tmpvar_5;\n  vec2 tmpvar_7;\n  tmpvar_7.x = (float(mod ((tmpvar_4 * 2.0), 1.0)));\n  tmpvar_7.y = tmpvar_5;\n  lowp vec4 tmpvar_8;\n  tmpvar_8 = ((texture2D (u_image, mix (u_pattern_tl, u_pattern_br, tmpvar_6)) * (1.0 - u_fade)) + (u_fade * texture2D (u_image, mix (u_pattern_tl, u_pattern_br, tmpvar_7))));\n  j_1.w = tmpvar_8.w;\n  j_1.xyz = (tmpvar_8.xyz * tmpvar_8.w);\n  gl_FragColor = (j_1 * clamp ((\n    min ((tmpvar_3 - (u_linewidth.y - u_blur)), (u_linewidth.x - tmpvar_3))\n   / u_blur), 0.0, 1.0));\n}\n\n"},outline:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nuniform mat4 u_posmatrix;\nuniform vec2 u_world;\nvarying highp vec2 a;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.w = 1.0;\n  tmpvar_1.xy = a_pos;\n  tmpvar_1.z = float((a_pos.x >= 32767.0));\n  vec4 tmpvar_2;\n  tmpvar_2 = (u_posmatrix * tmpvar_1);\n  gl_Position = tmpvar_2;\n  a = (((tmpvar_2.xy + 1.0) / 2.0) * u_world);\n}\n\n",fragment:"precision mediump float;\nuniform vec4 u_color;\nvarying vec2 a;\nvoid main ()\n{\n  highp vec2 x_1;\n  x_1 = (a - gl_FragCoord.xy);\n  highp float tmpvar_2;\n  tmpvar_2 = clamp (((\n    sqrt(dot (x_1, x_1))\n   - 1.0) / -1.0), 0.0, 1.0);\n  highp vec4 tmpvar_3;\n  tmpvar_3 = (u_color * (tmpvar_2 * (tmpvar_2 * \n    (3.0 - (2.0 * tmpvar_2))\n  )));\n  gl_FragColor = tmpvar_3;\n}\n\n"},pattern:{vertex:"precision mediump float;\nuniform mat4 u_posmatrix;\nuniform mat3 u_patternmatrix;\nattribute vec2 a_pos;\nvarying vec2 a;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_posmatrix * tmpvar_1);\n  vec3 tmpvar_2;\n  tmpvar_2.z = 1.0;\n  tmpvar_2.xy = a_pos;\n  a = (u_patternmatrix * tmpvar_2).xy;\n}\n\n",fragment:"precision mediump float;\nuniform float u_opacity;\nuniform float u_mix;\nuniform vec2 u_pattern_tl;\nuniform vec2 u_pattern_br;\nuniform sampler2D u_image;\nvarying vec2 a;\nvoid main ()\n{\n  vec2 tmpvar_1;\n  tmpvar_1 = (vec2(mod (a, 1.0)));\n  lowp vec4 tmpvar_2;\n  tmpvar_2 = (mix (texture2D (u_image, mix (u_pattern_tl, u_pattern_br, tmpvar_1)), texture2D (u_image, mix (u_pattern_tl, u_pattern_br, \n    (vec2(mod ((tmpvar_1 * 2.0), 1.0)))\n  )), u_mix) * u_opacity);\n  gl_FragColor = tmpvar_2;\n}\n\n"},raster:{vertex:"precision mediump float;\nuniform mat4 u_posmatrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\nvarying vec2 a;\nvarying vec2 b;\nvoid main ()\n{\n  vec4 tmpvar_1;\n  tmpvar_1.zw = vec2(0.0, 1.0);\n  tmpvar_1.xy = a_pos;\n  gl_Position = (u_posmatrix * tmpvar_1);\n  vec2 tmpvar_2;\n  tmpvar_2 = (((\n    (a_texture_pos / 32767.0)\n   - 0.5) / u_buffer_scale) + 0.5);\n  a = tmpvar_2;\n  b = ((tmpvar_2 * u_scale_parent) + u_tl_parent);\n}\n\n",fragment:"precision mediump float;\nuniform float u_opacity0;\nuniform float u_opacity1;\nuniform float u_brightness_low;\nuniform float u_brightness_high;\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 a;\nvarying vec2 b;\nuniform vec3 u_spin_weights;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = ((texture2D (u_image0, a) * u_opacity0) + (texture2D (u_image1, b) * u_opacity1));\n  lowp vec3 tmpvar_2;\n  tmpvar_2.x = dot (tmpvar_1.xyz, u_spin_weights);\n  tmpvar_2.y = dot (tmpvar_1.xyz, u_spin_weights.zxy);\n  tmpvar_2.z = dot (tmpvar_1.xyz, u_spin_weights.yzx);\n  lowp vec4 tmpvar_3;\n  tmpvar_3.xyz = mix (vec3(u_brightness_low), vec3(u_brightness_high), ((\n    ((tmpvar_2 + ((\n      (((tmpvar_1.x + tmpvar_1.y) + tmpvar_1.z) / 3.0)\n     - tmpvar_2) * u_saturation_factor)) - 0.5)\n   * u_contrast_factor) + 0.5));\n  tmpvar_3.w = tmpvar_1.w;\n  gl_FragColor = tmpvar_3;\n}\n\n"},icon:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_tex;\nattribute float a_angle;\nattribute float a_minzoom;\nattribute float a_maxzoom;\nattribute float a_rangeend;\nattribute float a_rangestart;\nattribute float a_labelminzoom;\nuniform mat4 u_posmatrix;\nuniform mat4 u_exmatrix;\nuniform float u_angle;\nuniform float u_zoom;\nuniform float u_flip;\nuniform float u_fadedist;\nuniform float u_minfadezoom;\nuniform float u_maxfadezoom;\nuniform float u_fadezoom;\nuniform float u_opacity;\nuniform vec2 u_texsize;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float d_1;\n  d_1 = 0.0;\n  float tmpvar_2;\n  tmpvar_2 = (float(mod ((a_angle + u_angle), 256.0)));\n  if ((((u_flip > 0.0) && (tmpvar_2 >= 64.0)) && (tmpvar_2 < 192.0))) {\n    d_1 = 1.0;\n  };\n  float tmpvar_3;\n  tmpvar_3 = (((2.0 - \n    float((u_zoom >= a_minzoom))\n  ) - (1.0 - \n    float((u_zoom >= a_maxzoom))\n  )) + d_1);\n  float tmpvar_4;\n  tmpvar_4 = clamp (((u_fadezoom - a_labelminzoom) / u_fadedist), 0.0, 1.0);\n  if ((u_fadedist >= 0.0)) {\n    b = tmpvar_4;\n  } else {\n    b = (1.0 - tmpvar_4);\n  };\n  if ((u_maxfadezoom < a_labelminzoom)) {\n    b = 0.0;\n  };\n  if ((u_minfadezoom >= a_labelminzoom)) {\n    b = 1.0;\n  };\n  vec4 tmpvar_5;\n  tmpvar_5.zw = vec2(0.0, 1.0);\n  tmpvar_5.xy = a_pos;\n  vec4 tmpvar_6;\n  tmpvar_6.w = 0.0;\n  tmpvar_6.xy = (a_offset / 64.0);\n  tmpvar_6.z = ((tmpvar_3 + float(\n    (0.0 >= b)\n  )) + (float(\n    (u_angle >= a_rangeend)\n  ) * (1.0 - \n    float((u_angle >= a_rangestart))\n  )));\n  gl_Position = ((u_posmatrix * tmpvar_5) + (u_exmatrix * tmpvar_6));\n  a = (a_tex / u_texsize);\n  b = (b * u_opacity);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  lowp vec4 tmpvar_1;\n  tmpvar_1 = (texture2D (u_texture, a) * b);\n  gl_FragColor = tmpvar_1;\n}\n\n"},sdf:{vertex:"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_tex;\nattribute float a_angle;\nattribute float a_minzoom;\nattribute float a_maxzoom;\nattribute float a_rangeend;\nattribute float a_rangestart;\nattribute float a_labelminzoom;\nuniform mat4 u_posmatrix;\nuniform mat4 u_exmatrix;\nuniform float u_angle;\nuniform float u_zoom;\nuniform float u_flip;\nuniform float u_fadedist;\nuniform float u_minfadezoom;\nuniform float u_maxfadezoom;\nuniform float u_fadezoom;\nuniform vec2 u_texsize;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float d_1;\n  d_1 = 0.0;\n  float tmpvar_2;\n  tmpvar_2 = (float(mod ((a_angle + u_angle), 256.0)));\n  if ((((u_flip > 0.0) && (tmpvar_2 >= 64.0)) && (tmpvar_2 < 192.0))) {\n    d_1 = 1.0;\n  };\n  float tmpvar_3;\n  tmpvar_3 = (((2.0 - \n    float((u_zoom >= a_minzoom))\n  ) - (1.0 - \n    float((u_zoom >= a_maxzoom))\n  )) + d_1);\n  float tmpvar_4;\n  tmpvar_4 = clamp (((u_fadezoom - a_labelminzoom) / u_fadedist), 0.0, 1.0);\n  if ((u_fadedist >= 0.0)) {\n    b = tmpvar_4;\n  } else {\n    b = (1.0 - tmpvar_4);\n  };\n  if ((u_maxfadezoom < a_labelminzoom)) {\n    b = 0.0;\n  };\n  if ((u_minfadezoom >= a_labelminzoom)) {\n    b = 1.0;\n  };\n  vec4 tmpvar_5;\n  tmpvar_5.zw = vec2(0.0, 1.0);\n  tmpvar_5.xy = a_pos;\n  vec4 tmpvar_6;\n  tmpvar_6.w = 0.0;\n  tmpvar_6.xy = (a_offset / 64.0);\n  tmpvar_6.z = ((tmpvar_3 + float(\n    (0.0 >= b)\n  )) + (float(\n    (u_angle >= a_rangeend)\n  ) * (1.0 - \n    float((u_angle >= a_rangestart))\n  )));\n  gl_Position = ((u_posmatrix * tmpvar_5) + (u_exmatrix * tmpvar_6));\n  a = (a_tex / u_texsize);\n}\n\n",fragment:"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec4 u_color;\nuniform float u_buffer;\nuniform float u_gamma;\nvarying vec2 a;\nvarying float b;\nvoid main ()\n{\n  float edge0_1;\n  edge0_1 = (u_buffer - u_gamma);\n  lowp float tmpvar_2;\n  tmpvar_2 = clamp (((texture2D (u_texture, a).w - edge0_1) / (\n    (u_buffer + u_gamma)\n   - edge0_1)), 0.0, 1.0);\n  lowp vec4 tmpvar_3;\n  tmpvar_3 = (u_color * ((tmpvar_2 * \n    (tmpvar_2 * (3.0 - (2.0 * tmpvar_2)))\n  ) * b));\n  gl_FragColor = tmpvar_3;\n}\n\n"}}
},{}],35:[function(require,module){"use strict";var Source=require("./source.js"),GeoJSONTile=require("./geojsontile.js"),GeoJSONSource=module.exports=function(options){this.tiles={},this.alltiles={},this.enabled=!0,this.zooms=[1,5,9,13],this.minTileZoom=this.zooms[0],this.maxTileZoom=this.zooms[this.zooms.length-1],this.loadNewTiles=!0,this.tileJSON={minZoom:1,maxZoom:13},this.data=options.data};GeoJSONSource.prototype=Object.create(Source.prototype),GeoJSONSource.prototype.setData=function(data){return this.data=data,this.map&&this._updateData(),this},GeoJSONSource.prototype.onAdd=function(map){this.map=map,this.painter=map.painter,this.map.style&&this._updateData(),map.on("style.change",this._updateData.bind(this))},GeoJSONSource.prototype._updateData=function(){var source=this;return this.workerID=this.map.dispatcher.send("parse geojson",{data:this.data,zooms:this.zooms,tileSize:512,source:this.id},function(err,tiles){if(!err)for(var i=0;i<tiles.length;i++)source.alltiles[tiles[i].id]=new GeoJSONTile(tiles[i].id,source,tiles[i])}),this},GeoJSONSource.prototype._addTile=function(id){var tile=this.alltiles[id];return tile&&(tile._load(),this.tiles[id]=tile,this.fire("tile.add",{tile:tile})),tile||{}},GeoJSONSource.prototype._coveringZoomLevel=function(zoom){for(var i=this.zooms.length-1;i>=0;i--)if(this.zooms[i]<=zoom){var z=this.zooms[i];return z}return 0}},{"./geojsontile.js":36,"./source.js":39}],36:[function(require,module){"use strict";function GeoJSONTile(id,source,data){this.id=id,this.source=source,this.data=data,this.workerID=source.workerID}var Tile=require("./tile.js"),BufferSet=require("../data/buffer/bufferset.js"),createBucket=require("../data/createbucket.js");module.exports=GeoJSONTile,GeoJSONTile.prototype=Object.create(Tile.prototype),GeoJSONTile.prototype._load=function(){if(!this.loaded){this.loaded=!0;var data=this.data;this.buffers=new BufferSet(data.buffers),this.buckets={};for(var b in data.elementGroups)this.buckets[b]=createBucket(this.source.map.style.buckets[b],this.buffers,void 0,data.elementGroups[b])}},GeoJSONTile.prototype.abort=function(){},GeoJSONTile.prototype.remove=function(){}},{"../data/buffer/bufferset.js":2,"../data/createbucket.js":9,"./tile.js":40}],37:[function(require,module){"use strict";function Wrapper(features){this.features=features,this.length=features.length}function FeatureWrapper(feature){this.feature=feature,this._type=mapping[feature.type],this.properties=feature.properties}module.exports=Wrapper,Wrapper.prototype.feature=function(i){return new FeatureWrapper(this.features[i])};var mapping={Point:1,LineString:2,Polygon:3};FeatureWrapper.prototype.loadGeometry=function(){return this.feature.coords},FeatureWrapper.prototype.bbox=function(){if(this._type===mapping.Point)return[this.feature.coords[0],this.feature.coords[1],this.feature.coords[0],this.feature.coords[1]];for(var rings=this.feature.coords,x1=1/0,x2=-1/0,y1=1/0,y2=-1/0,i=0;i<rings.length;i++)for(var ring=rings[i],j=0;j<ring.length;j++){var coord=ring[j];x1=Math.min(x1,coord.x),x2=Math.max(x2,coord.x),y1=Math.min(y1,coord.y),y2=Math.max(y2,coord.y)}return[x1,y1,x2,y2]}},{}],38:[function(require,module){"use strict";function RasterTile(id,source,url,callback){this.id=id,this.loaded=!1,this.url=url,this.source=source,this.map=source.map,this._load(),this.callback=callback,this.uses=1,this.buckets={},this.info={raster:!0};var buckets=this.map.style.buckets;for(var b in buckets){var bucket=buckets[b],sourceid=bucket&&bucket.source;source.id===sourceid&&(this.buckets[b]={info:bucket.render,type:"raster",tile:this})}}var Tile=require("./tile.js"),ajax=require("../util/ajax.js");module.exports=RasterTile,RasterTile.prototype=Object.create(Tile.prototype),RasterTile.prototype._load=function(){var tile=this;ajax.getImage(this.url,function(err,img){err||(tile.img=img,tile.map&&tile.onTileLoad())})},RasterTile.prototype.onTileLoad=function(){this.bind(this.map.painter.gl),this.loaded=!0,this.callback()},RasterTile.prototype.abort=function(){this.aborted=!0,this.img&&(this.img.src=""),delete this.img},RasterTile.prototype.bind=function(gl){this.texture?gl.bindTexture(gl.TEXTURE_2D,this.texture):(this.texture=this.map.painter.getTexture(this.img.width),this.texture?(gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,this.img)):(this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this.img),this.texture.size=this.img.width),gl.generateMipmap(gl.TEXTURE_2D))},RasterTile.prototype.remove=function(){this.texture&&this.map.painter.saveTexture(this.texture),delete this.map},RasterTile.prototype.featuresAt=function(pos,params,callback){callback(null,[])}},{"../util/ajax.js":75,"./tile.js":40}],39:[function(require,module){"use strict";function Source(options){if(this.tiles={},this.enabled=!1,this.type=options.type,"vector"===this.type&&options.tileSize&&512!==options.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.Tile="vector"===this.type?VectorTile:RasterTile,this.options=util.inherit(this.options,options),this.cache=new Cache(this.options.cacheSize,function(tile){tile.remove()});var protocol=options.url.split(":")[0];Source.protocols[protocol](options.url,function(err,tileJSON){if(err)throw err;this.tileJSON=tileJSON,this.loadNewTiles=!0,this.enabled=!0,this.update(),this.map&&this.map.fire("source.add",{source:this})}.bind(this)),this._updateTiles=util.throttle(this._updateTiles,50,this)}var util=require("../util/util.js"),ajax=require("../util/ajax.js"),tileJSON=require("../util/url.js").tileJSON,Evented=require("../util/evented.js"),Cache=require("../util/mrucache.js"),TileCoord=require("./tilecoord"),VectorTile=require("./vectortile"),RasterTile=require("./rastertile.js"),Point=require("point-geometry");module.exports=Source,Source.protocols={mapbox:function(url,callback){ajax.getJSON(tileJSON(url.split("://")[1]),callback)}},Source.prototype=util.inherit(Evented,{options:{tileSize:512,cacheSize:20},onAdd:function(map){this.map=map,this.painter=map.painter},load:function(){for(var t in this.tiles)this.tiles[t]._load()},loaded:function(){for(var t in this.tiles)if(!this.tiles[t].loaded)return!1;return!0},update:function(){this.enabled&&this._updateTiles()},render:function(layers){if(this.enabled){var order=Object.keys(this.tiles);order.sort(this._z_order);for(var i=0;i<order.length;i++){var id=order[i],tile=this.tiles[id];tile.loaded&&!this.coveredTiles[id]&&this._renderTile(tile,id,layers)}}},featuresAt:function(point,params,callback){if(point=Point.convert(point),params.layer){var style=this.map.style,layer=style.getLayer(params.layer);params.bucket=style.buckets[layer.ref||layer.id]}var order=Object.keys(this.tiles);order.sort(this._z_order);for(var i=0;i<order.length;i++){var id=order[i],tile=this.tiles[id],pos=tile.positionAt(id,point);if(pos&&pos.x>=0&&pos.x<4096&&pos.y>=0&&pos.y<4096)return tile.featuresAt(pos,params,callback)}callback(null,[])},_getZoom:function(){var zOffset=Math.log(this.map.transform.tileSize/this.options.tileSize)/Math.LN2;return this.map.transform.zoom+zOffset},_coveringZoomLevel:function(zoom){for(var z=this.tileJSON.maxzoom;z>=this.tileJSON.minzoom;z--)if(zoom>=z)return"raster"===this.type&&z<this.tileJSON.maxzoom&&(z+=Math.round(zoom-z)),z;return 0},_childZoomLevel:function(zoom){return zoom=Math.max(this.tileJSON.minzoom,zoom+1),zoom<=this.tileJSON.maxzoom?zoom:null},_getCoveringTiles:function(zoom){function fromCenter(a,b){var ad=Math.abs(a.x-tileCenter.column)+Math.abs(a.y-tileCenter.row),bd=Math.abs(b.x-tileCenter.column)+Math.abs(b.y-tileCenter.row);return ad-bd}function scanLine(x0,x1,y){var x,wx;if(y>=0&&tiles>=y)for(x=x0;x1>x;x++)wx=(x+tiles)%tiles,t[TileCoord.toID(z,wx,y,Math.floor(x/tiles))]={x:wx,y:y}}void 0===zoom&&(zoom=this._getZoom());var z=this._coveringZoomLevel(zoom),tiles=1<<z,tr=this.map.transform,tileCenter=TileCoord.zoomTo(tr.locationCoordinate(tr.center),z),points=[TileCoord.zoomTo(tr.pointCoordinate(tileCenter,{x:0,y:0}),z),TileCoord.zoomTo(tr.pointCoordinate(tileCenter,{x:tr.width,y:0}),z),TileCoord.zoomTo(tr.pointCoordinate(tileCenter,{x:tr.width,y:tr.height}),z),TileCoord.zoomTo(tr.pointCoordinate(tileCenter,{x:0,y:tr.height}),z)],t={};return this._scanTriangle(points[0],points[1],points[2],0,tiles,scanLine),this._scanTriangle(points[2],points[3],points[0],0,tiles,scanLine),Object.keys(t).sort(fromCenter)},_renderTile:function(tile,id,layers){var pos=TileCoord.fromID(id),z=pos.z,x=pos.x,y=pos.y,w=pos.w;x+=w*(1<<z),tile.calculateMatrices(z,x,y,this.map.transform,this.painter),this.painter.draw(tile,this.map.style,layers,{z:z,x:x,y:y,debug:this.map.debug,antialiasing:this.map.antialiasing,vertices:this.map.vertices,rotating:this.map.rotating,zooming:this.map.zooming})},_findLoadedChildren:function(id,maxCoveringZoom,retain){for(var complete=!0,z=TileCoord.fromID(id).z,ids=TileCoord.children(id),i=0;i<ids.length;i++)this.tiles[ids[i]]&&this.tiles[ids[i]].loaded?retain[ids[i]]=!0:(complete=!1,maxCoveringZoom>z&&this._findLoadedChildren(ids[i],maxCoveringZoom,retain));return complete},_findLoadedParent:function(id,minCoveringZoom,retain){for(var z=TileCoord.fromID(id).z;z>=minCoveringZoom;z--)if(id=TileCoord.parent(id),this.tiles[id]&&this.tiles[id].loaded)return retain[id]=!0,!0;return!1},_updateTiles:function(){if(this.map&&this.map.loadNewTiles&&this.loadNewTiles&&this.map.style.sources[this.id]){for(var i,id,complete,tile,zoom=Math.floor(this._getZoom()),required=this._getCoveringTiles().sort(this._centerOut.bind(this)),minCoveringZoom=Math.max(this.tileJSON.minzoom,zoom-10),maxCoveringZoom=this.tileJSON.minzoom;zoom+1>maxCoveringZoom;){var level=this._childZoomLevel(maxCoveringZoom);if(null===level)break;maxCoveringZoom=level}var retain={};this.coveredTiles={};var fullyComplete=!0;for(i=0;i<required.length;i++)id=+required[i],retain[id]=!0,tile=this._addTile(id),tile.loaded||(complete=this._findLoadedChildren(id,maxCoveringZoom,retain),complete||(complete=this._findLoadedParent(id,minCoveringZoom,retain)),complete||(fullyComplete=!1));var now=(new Date).getTime(),fadeDuration="raster"===this.type?this.map.style.rasterFadeDuration:0;for(id in retain)tile=this.tiles[id],tile&&tile.timeAdded>now-fadeDuration&&(complete=this._findLoadedChildren(id,maxCoveringZoom,retain),complete?this.coveredTiles[id]=!0:this._findLoadedParent(id,minCoveringZoom,retain));for(id in this.coveredTiles)retain[id]=!0;var remove=util.keysDifference(this.tiles,retain);for(i=0;i<remove.length;i++)id=+remove[i],this._removeTile(id)}},_loadTile:function(id){function tileComplete(err){err||(layer.fire("tile.load",{tile:tile}),map.update())}var tile,layer=this,map=this.map,pos=TileCoord.fromID(id);if(0===pos.w){var url=TileCoord.url(id,this.tileJSON.tiles);tile=this.tiles[id]=new this.Tile(id,this,url,tileComplete)}else{var wrapped=TileCoord.toID(pos.z,pos.x,pos.y,0);tile=this.tiles[id]=this.tiles[wrapped]||this._addTile(wrapped),tile.uses++}return tile},_addTile:function(id){var tile=this.tiles[id];return tile||(tile=this.cache.get(id),tile&&(tile.uses=1,this.tiles[id]=tile)),tile||(tile=this._loadTile(id),this.fire("tile.add",{tile:tile})),tile&&tile.loaded&&!tile.timeAdded&&(tile.timeAdded=(new Date).getTime(),"raster"===this.type&&this.map.animationLoop.set(this.map.style.rasterFadeDuration)),tile},_removeTile:function(id){var tile=this.tiles[id];tile&&(tile.uses--,delete this.tiles[id],tile.uses<=0&&(delete tile.timeAdded,tile.loaded?this.cache.add(id,tile):(tile.abort(),tile.remove()),this.fire("tile.remove",{tile:tile})))},_scanTriangle:function(a,b,c,ymin,ymax,scanLine){var t,ab=this._edge(a,b),bc=this._edge(b,c),ca=this._edge(c,a);ab.dy>bc.dy&&(t=ab,ab=bc,bc=t),ab.dy>ca.dy&&(t=ab,ab=ca,ca=t),bc.dy>ca.dy&&(t=bc,bc=ca,ca=t),ab.dy&&this._scanSpans(ca,ab,ymin,ymax,scanLine),bc.dy&&this._scanSpans(ca,bc,ymin,ymax,scanLine)},_edge:function(a,b){if(a.row>b.row){var t=a;a=b,b=t}return{x0:a.column,y0:a.row,x1:b.column,y1:b.row,dx:b.column-a.column,dy:b.row-a.row}},_scanSpans:function(e0,e1,ymin,ymax,scanLine){var y0=Math.max(ymin,Math.floor(e1.y0)),y1=Math.min(ymax,Math.ceil(e1.y1));if(e0.x0==e1.x0&&e0.y0==e1.y0?e0.x0+e1.dy/e0.dy*e0.dx<e1.x1:e0.x1-e1.dy/e0.dy*e0.dx<e1.x0){var t=e0;e0=e1,e1=t}for(var m0=e0.dx/e0.dy,m1=e1.dx/e1.dy,d0=e0.dx>0,d1=e1.dx<0,y=y0;y1>y;y++){var x0=m0*Math.max(0,Math.min(e0.dy,y+d0-e0.y0))+e0.x0,x1=m1*Math.max(0,Math.min(e1.dy,y+d1-e1.y0))+e1.x0;scanLine(Math.floor(x1),Math.ceil(x0),y)}},_z_order:function(a,b){return b%32-a%32},_centerOut:function(a,b){var tr=this.map.transform,aPos=TileCoord.fromID(a),bPos=TileCoord.fromID(b),c=TileCoord.zoomTo(tr.locationCoordinate(tr.center),aPos.z),center=new Point(c.column-.5,c.row-.5);return center.dist(aPos)-center.dist(bPos)}});var sources={vector:Source,raster:Source,geojson:require("./geojsonsource"),video:require("./videosource")};Source.create=function(source){return new sources[source.type](source)}},{"../util/ajax.js":75,"../util/evented.js":81,"../util/mrucache.js":83,"../util/url.js":85,"../util/util.js":86,"./geojsonsource":35,"./rastertile.js":38,"./tilecoord":41,"./vectortile":43,"./videosource":44,"point-geometry":97}],40:[function(require,module){"use strict";function Tile(){}var glmatrix=require("../lib/glmatrix.js"),mat2=glmatrix.mat2,mat4=glmatrix.mat4,vec2=glmatrix.vec2;module.exports=Tile,Tile.prototype={tileExtent:4096,calculateMatrices:function(z,x,y,transform,painter){var tileScale=Math.pow(2,z),scale=transform.worldSize/tileScale;this.scale=scale,this.posMatrix=mat4.create(),mat4.translate(this.posMatrix,this.posMatrix,[transform.centerPoint.x,transform.centerPoint.y,0]),mat4.rotateZ(this.posMatrix,this.posMatrix,transform.angle),mat4.translate(this.posMatrix,this.posMatrix,[-transform.centerPoint.x,-transform.centerPoint.y,0]);var pixelX=transform.width/2-transform.x,pixelY=transform.height/2-transform.y;mat4.translate(this.posMatrix,this.posMatrix,[pixelX+x*scale,pixelY+y*scale,1]),this.invPosMatrix=mat4.create(),mat4.invert(this.invPosMatrix,this.posMatrix),mat4.scale(this.posMatrix,this.posMatrix,[scale/this.tileExtent,scale/this.tileExtent,1]),mat4.multiply(this.posMatrix,painter.projectionMatrix,this.posMatrix),this.exMatrix=mat4.clone(painter.projectionMatrix),mat4.rotateZ(this.exMatrix,this.exMatrix,transform.angle),this.rotationMatrix=mat2.create(),mat2.rotate(this.rotationMatrix,this.rotationMatrix,transform.angle)},positionAt:function(id,point){if(!this.invPosMatrix)return null;var pos=vec2.transformMat4([],[point.x,point.y],this.invPosMatrix);return vec2.scale(pos,pos,4096/this.scale),{x:pos[0],y:pos[1],scale:this.scale}},featuresAt:function(pos,params,callback){this.source.map.dispatcher.send("query features",{id:this.id,x:pos.x,y:pos.y,scale:pos.scale,source:this.source.id,params:params},callback,this.workerID)}}},{"../lib/glmatrix.js":20}],41:[function(require,module,exports){"use strict";var TileCoord=exports;TileCoord.toID=function(z,x,y,w){w=w||0,w*=2,0>w&&(w=-1*w-1);var dim=1<<z;return 32*(dim*dim*w+dim*y+x)+z},TileCoord.asString=function(id){var pos=TileCoord.fromID(id);return pos.z+"/"+pos.x+"/"+pos.y},TileCoord.fromID=function(id){var z=id%32,dim=1<<z,xy=(id-z)/32,x=xy%dim,y=(xy-x)/dim%dim,w=Math.floor(xy/(dim*dim));return w%2!==0&&(w=-1*w-1),w/=2,{z:z,x:x,y:y,w:w}},TileCoord.zoom=function(id){return id%32},TileCoord.url=function(id,urls){var pos=TileCoord.fromID(id);return urls[Math.floor((pos.x+pos.y)%urls.length)].replace("{h}",(pos.x%16).toString(16)+(pos.y%16).toString(16)).replace("{z}",pos.z.toFixed(0)).replace("{x}",pos.x.toFixed(0)).replace("{y}",pos.y.toFixed(0))},TileCoord.parent=function(id){var pos=TileCoord.fromID(id);return 0===pos.z?id:TileCoord.toID(pos.z-1,Math.floor(pos.x/2),Math.floor(pos.y/2))},TileCoord.parentWithZoom=function(id,zoom){for(var pos=TileCoord.fromID(id);pos.z>zoom;)pos.z--,pos.x=Math.floor(pos.x/2),pos.y=Math.floor(pos.y/2);return TileCoord.toID(pos.z,pos.x,pos.y)},TileCoord.children=function(id){var pos=TileCoord.fromID(id);return pos.z+=1,pos.x*=2,pos.y*=2,[TileCoord.toID(pos.z,pos.x,pos.y,pos.w),TileCoord.toID(pos.z,pos.x+1,pos.y,pos.w),TileCoord.toID(pos.z,pos.x,pos.y+1,pos.w),TileCoord.toID(pos.z,pos.x+1,pos.y+1,pos.w)]},TileCoord.zoomTo=function(c,z){return c.column=c.column*Math.pow(2,z-c.zoom),c.row=c.row*Math.pow(2,z-c.zoom),c.zoom=z,c}},{}],42:[function(require,module){"use strict";function tileGeoJSON(geojson,zoom){var tiles={},tileExtent=4096,transform=new Transform;if(transform.zoom=zoom,geojson=rewind(geojson),"FeatureCollection"===geojson.type)for(var i=0;i<geojson.features.length;i++)tileFeature(geojson.features[i],transform,tiles,tileExtent);else{if("Feature"!==geojson.type)throw"Unrecognized geojson type";tileFeature(geojson,transform,tiles,tileExtent)}return tiles}function tileFeature(feature,transform,tiles,tileExtent){var tiled,coords=feature.geometry.coordinates,type=feature.geometry.type;if("Point"===type)tiled=tileLineString([coords],transform,tileExtent);else if("LineString"===type||"MultiPoint"===type)tiled=tileLineString(coords,transform,tileExtent);else{if("Polygon"!==type&&"MultiLineString"!==type)throw"MultiPolygon"===type?"todo":"unrecognized geometry type";tiled={};for(var i=0;i<coords.length;i++){var tiled_=tileLineString(coords[i],transform,tileExtent,"Polygon"===type);for(var tileID in tiled_)tiled[tileID]||(tiled[tileID]=[]),tiled[tileID]=(tiled[tileID]||[]).concat(tiled_[tileID])}}for(var id in tiled)tiles[id]=tiles[id]||[],tiles[id].push({properties:feature.properties,coords:tiled[id],type:feature.geometry.type})}function tileLineString(coords,transform,tileExtent,rejoin){for(var prevCoord,padding=.01,paddedExtent=tileExtent*(1+2*padding),coord=transform.locationCoordinate(new LatLng(coords[0][1],coords[0][0])),tiles={},i=0;i<coords.length;i++){prevCoord=coord,coord=transform.locationCoordinate(new LatLng(coords[i][1],coords[i][0]));for(var dx=coord.column-prevCoord.column||Number.MIN_VALUE,dy=coord.row-prevCoord.row||Number.MIN_VALUE,dirX=dx/Math.abs(dx),dirY=dy/Math.abs(dy),startTileX=Math.floor(prevCoord.column-dirX*padding),endTileX=Math.floor(coord.column+dirX*padding),startTileY=Math.floor(prevCoord.row-dirY*padding),endTileY=Math.floor(coord.row+dirY*padding),x=startTileX;0>=(x-endTileX)*dirX;x+=dirX)for(var leftX=(x-padding-prevCoord.column)/dx,rightX=(x+1+padding-prevCoord.column)/dx,y=startTileY;0>=(y-endTileY)*dirY;y+=dirY){var point,topY=(y-padding-prevCoord.row)/dy,bottomY=(y+1+padding-prevCoord.row)/dy,enter=Math.max(Math.min(leftX,rightX),Math.min(topY,bottomY)),exit=Math.min(Math.max(leftX,rightX),Math.max(topY,bottomY)),tileID=TileCoord.toID(transform.tileZoom,x,y),tile=tiles[tileID];enter>=0&&1>enter&&(point=new Point((prevCoord.column+enter*dx-x)*tileExtent,(prevCoord.row+enter*dy-y)*tileExtent),point.continues=!0,tile||(tiles[tileID]=tile=[]),tile.push([point])),exit>=0&&1>exit?(point=new Point((prevCoord.column+exit*dx-x)*tileExtent,(prevCoord.row+exit*dy-y)*tileExtent),point.continues=!0,tile[tile.length-1].push(point)):(point=new Point((coord.column-x)*tileExtent,(coord.row-y)*tileExtent),tile?tile[tile.length-1].push(point):tiles[tileID]=tile=[[point]])}}if(rejoin)for(var id in tiles){var segments=tiles[id];if(!segments[0][0].continues&&segments.length>1){var last=segments.pop();Array.prototype.unshift.apply(segments[0],last.slice(0,last.length-1))}for(var start=edgeDist(segments[0][0],tileExtent,padding),k=0;k<segments.length;k++)for(var thisExit=edgeDist(segments[k][segments[k].length-1],paddedExtent),nextEntry=edgeDist(segments[(k+1)%segments.length][0],paddedExtent),startToExit=(thisExit-start+4)%4,startToNextEntry=(nextEntry-start+4)%4,direction=thisExit===nextEntry||startToNextEntry>startToExit?1:-1,roundFn=direction>0?Math.ceil:Math.floor,c=roundFn(thisExit)%4;c!=roundFn(nextEntry)%4;c=(c+direction+4)%4){var corner=corners[c];segments[k].push(new Point((corner.x+(corner.x-.5>0?1:-1)*padding)*tileExtent,(corner.y+(corner.y-.5>0?1:-1)*padding)*tileExtent))}tiles[id]=[Array.prototype.concat.apply([],segments)]}return tiles}function edgeDist(point,extent){var d,x=point.x/extent,y=point.y/extent;return d=Math.abs(y-.5)>=Math.abs(x-.5)?2*Math.round(y)+(.5>y?x:1-x):2*Math.round(1-x)+(x>.5?y:1-y)+1,d%4}var rewind=require("geojson-rewind"),TileCoord=require("./tilecoord.js"),Transform=require("../geo/transform.js"),Point=require("point-geometry"),LatLng=require("../geo/latlng.js");module.exports=tileGeoJSON;var corners=[new Point(0,0),new Point(1,0),new Point(1,1),new Point(0,1)]},{"../geo/latlng.js":16,"../geo/transform.js":18,"./tilecoord.js":41,"geojson-rewind":91,"point-geometry":97}],43:[function(require,module){"use strict";function VectorTile(id,source,url,callback){this.id=id,this.loaded=!1,this.url=url,this.zoom=TileCoord.fromID(id).z,this.map=source.map,this.options=source.options,this.id=util.uniqueId(),this.callback=callback,this.source=source,this.depth=this.zoom>=source.tileJSON.maxzoom?this.map.options.maxZoom-this.zoom:1,this.uses=1,this._load()}var Tile=require("./tile.js"),TileCoord=require("./tilecoord.js"),BufferSet=require("../data/buffer/bufferset.js"),util=require("../util/util.js"),createBucket=require("../data/createbucket.js");module.exports=VectorTile,VectorTile.prototype=util.inherit(Tile,{_load:function(){var tile=this;this.workerID=this.map.dispatcher.send("load tile",{url:this.url,id:this.id,zoom:this.zoom,maxZoom:this.source.tileJSON.maxzoom,tileSize:this.options.tileSize,source:this.source.id,depth:this.depth},function(err,data){!err&&data&&tile.onTileLoad(data),tile.callback(err)})},onTileLoad:function(data){if(this.map){this.buffers=new BufferSet(data.buffers),this.buckets={};for(var b in data.elementGroups)this.buckets[b]=createBucket(this.map.style.buckets[b],this.buffers,void 0,data.elementGroups[b]);this.loaded=!0}},remove:function(){for(var bucket in this.buckets)this.buckets[bucket].prerendered&&this.map.painter.saveTexture(this.buckets[bucket].prerendered.texture);this.map.dispatcher.send("remove tile",{id:this.id,source:this.source.id},null,this.workerID),this.map.painter.glyphAtlas.removeGlyphs(this.id);var gl=this.map.painter.gl,buffers=this.buffers;if(buffers)for(var b in buffers)buffers[b].destroy(gl);delete this.map},abort:function(){this.map.dispatcher.send("abort tile",{id:this.id,source:this.source.id},null,this.workerID)}})},{"../data/buffer/bufferset.js":2,"../data/createbucket.js":9,"../util/util.js":86,"./tile.js":40,"./tilecoord.js":41}],44:[function(require,module){"use strict";function VideoSource(options){this.video=document.createElement("video"),this.video.crossOrigin="Anonymous",this.video.loop=!0;for(var urls="string"==typeof options.url?[options.url]:options.url,i=0;i<urls.length;i++){var s=document.createElement("source");s.src=urls[i],this.video.appendChild(s)}this.coordinates=options.coordinates,this.enabled=!0;var loopID,source=this;this.video.addEventListener("playing",function(){loopID=source.map.style.animationLoop.set(1/0),source.map._rerender()}),this.video.addEventListener("pause",function(){source.map.style.animationLoop.cancel(loopID)})}var Tile=require("./tile.js"),TileCoord=require("./tilecoord.js"),LatLng=require("../geo/latlng.js"),Point=require("point-geometry");module.exports=VideoSource,VideoSource.prototype.onAdd=function(map){this.map=map,this.video.play(),this.createTile()},VideoSource.prototype.createTile=function(){for(var map=this.map,coords=this.coordinates.map(function(latlng){var loc=LatLng.convert(latlng);return TileCoord.zoomTo(map.transform.locationCoordinate(loc),0)}),minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,i=0;i<coords.length;i++)minX=Math.min(minX,coords[i].column),minY=Math.min(minY,coords[i].row),maxX=Math.max(maxX,coords[i].column),maxY=Math.max(maxY,coords[i].row);var dx=maxX-minX,dy=maxY-minY,dMax=Math.max(dx,dy),center=TileCoord.zoomTo({column:(minX+maxX)/2,row:(minY+maxY)/2,zoom:0},Math.floor(-Math.log(dMax)/Math.LN2)),tileExtent=4096,tileCoords=coords.map(function(coord){var zoomedCoord=TileCoord.zoomTo(coord,center.zoom);return new Point(Math.round((zoomedCoord.column-center.column)*tileExtent),Math.round((zoomedCoord.row-center.row)*tileExtent))}),gl=map.painter.gl,maxInt16=32767,array=new Int16Array([tileCoords[0].x,tileCoords[0].y,0,0,tileCoords[1].x,tileCoords[1].y,maxInt16,0,tileCoords[3].x,tileCoords[3].y,0,maxInt16,tileCoords[2].x,tileCoords[2].y,maxInt16,maxInt16]);this.boundsBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.boundsBuffer),gl.bufferData(gl.ARRAY_BUFFER,array,gl.STATIC_DRAW),this.tile=new Tile,this.center=center},VideoSource.prototype.load=function(){},VideoSource.prototype.update=function(){},VideoSource.prototype.render=function(layers){if(this.enabled&&!(this.video.readyState<2)){var layer=layers[0],bucket={type:"raster",tile:this,boundsBuffer:this.boundsBuffer,bind:this.bind.bind(this)},buckets={};buckets[layer.bucket]=bucket;var c=this.center;this.tile.calculateMatrices(c.zoom,c.column,c.row,this.map.transform,this.map.painter),this.map.painter.tile=this.tile,this.map.painter.applyStyle(layer,this.map.style,buckets,{})}},VideoSource.prototype.bind=function(gl){this.texture?(gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,gl.RGBA,gl.UNSIGNED_BYTE,this.video)):(this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this.video))},VideoSource.prototype.featuresAt=function(point,params,callback){return callback(null,[])}},{"../geo/latlng.js":16,"./tile.js":40,"./tilecoord.js":41,"point-geometry":97}],45:[function(require,module){"use strict";function Worker(self){this.self=self,this.actor=new Actor(self,this)}var Actor=require("../util/actor.js"),bucketFilter=require("../style/bucketfilter.js"),WorkerTile=require("./workertile.js"),tileGeoJSON=require("./tilegeojson.js"),Wrapper=require("./geojsonwrapper.js"),util=require("../util/util.js"),queue=require("queue-async");module.exports=Worker,util.extend(Worker.prototype,{alert:function(){this.self.postMessage({type:"alert message",data:[].slice.call(arguments)})},"set buckets":function(data){for(var buckets=WorkerTile.buckets=data,i=0;i<buckets.length;i++){var bucket=buckets[i];bucket.compare=bucketFilter(bucket.filter)}},"set glyphs":function(data){WorkerTile.prototype.glyphs=data},"load tile":function(params,callback){new WorkerTile(params.url,void 0,params.id,params.zoom,params.maxZoom,params.tileSize,params.source,params.depth,this.actor,callback)},"abort tile":function(params){WorkerTile.cancel(params.id,params.source)},"remove tile":function(params){var id=params.id,source=params.source;WorkerTile.loaded[source]&&WorkerTile.loaded[source][id]&&delete WorkerTile.loaded[source][id]},"parse geojson":function(params,callback){function worker(id,tile,zoom,callback){new WorkerTile(void 0,new Wrapper(tile),id,zoom,maxZoom,params.tileSize,params.source,4,actor,function(err,data){return err?callback(err):(data.id=id,void callback(null,data))})}for(var data=params.data,zooms=params.zooms,len=zooms.length,maxZoom=zooms[len-1],actor=this.actor,q=queue(),i=0;len>i;i++){var zoom=zooms[i],tiles=tileGeoJSON(data,zoom);for(var id in tiles)q.defer(worker,id,tiles[id],zoom)}q.awaitAll(callback)},"query features":function(params,callback){var tile=WorkerTile.loaded[params.source]&&WorkerTile.loaded[params.source][params.id];tile?tile.featureTree.query(params,callback):callback(null,[])}})},{"../style/bucketfilter.js":48,"../util/actor.js":74,"../util/util.js":86,"./geojsonwrapper.js":37,"./tilegeojson.js":42,"./workertile.js":46,"queue-async":98}],46:[function(require,module){"use strict";function WorkerTile(url,data,id,zoom,maxZoom,tileSize,source,depth,actor,callback){function loaded(data){WorkerTile.loaded[source]=WorkerTile.loaded[source]||{},WorkerTile.loaded[source][id]=tile,tile.data=data,tile.parse(data,actor,callback)}var tile=this;this.id=id,this.zoom=zoom,this.maxZoom=maxZoom,this.tileSize=tileSize,this.source=source,this.depth=depth,this.buffers=new BufferSet,url?(void 0===WorkerTile.loading[source]&&(WorkerTile.loading[source]={}),WorkerTile.loading[source][id]=getArrayBuffer(url,function(err,data){delete WorkerTile.loading[source][id],err?callback(err):loaded(new vt.VectorTile(new Protobuf(new Uint8Array(data))))})):loaded(data)}function sortTileIntoBuckets(tile,data,bucketInfo){for(var layerName,sourceLayers={},buckets={},i=0;i<bucketInfo.length;i++){var info=bucketInfo[i],bucketName=info.id,minZoom=info["min-zoom"],maxZoom=info["max-zoom"];if(info.source===tile.source&&!(minZoom&&tile.zoom<minZoom&&minZoom<tile.maxZoom||maxZoom&&tile.zoom>=maxZoom)){var bucket=createBucket(info,tile.buffers,tile.collision);bucket&&(bucket.features=[],bucket.name=bucketName,buckets[bucketName]=bucket,data.layers?(layerName=info["source-layer"],sourceLayers[layerName]||(sourceLayers[layerName]={}),sourceLayers[layerName][bucketName]=info):sourceLayers[bucketName]=info)}}if(data.layers)for(layerName in sourceLayers){var layer=data.layers[layerName];layer&&sortLayerIntoBuckets(layer,sourceLayers[layerName],buckets)}else sortLayerIntoBuckets(data,sourceLayers,buckets);return buckets}function sortLayerIntoBuckets(layer,mapping,buckets){for(var i=0;i<layer.length;i++){var feature=layer.feature(i);for(var key in mapping)mapping[key].compare(feature)&&buckets[key].features.push(feature)}}function getGeometry(feature){return feature.loadGeometry()}function getType(feature){return vt.VectorTileFeature.types[feature.type]}var FeatureTree=require("../data/featuretree.js"),Protobuf=require("pbf"),vt=require("vector-tile"),Collision=require("../symbol/collision.js"),getArrayBuffer=require("../util/ajax.js").getArrayBuffer,BufferSet=require("../data/buffer/bufferset.js"),createBucket=require("../data/createbucket.js");module.exports=WorkerTile,WorkerTile.cancel=function(id,sourceID){var source=WorkerTile.loading[sourceID];source&&source[id]&&(source[id].abort(),delete source[id])},WorkerTile.loading={},WorkerTile.loaded={},WorkerTile.buckets=[],WorkerTile.prototype.parse=function(data,actor,callback){function dependenciesDone(bucket){return function(err){bucket.dependenciesLoaded=!0,parseBucket(tile,bucket,err)}}function parseBucket(tile,bucket,skip){if(!(bucket.getDependencies&&!bucket.dependenciesLoaded||bucket.collision&&!bucket.previousPlaced)){if(!skip){var now=Date.now();"raster"!==bucket.type&&bucket.addFeatures();var time=Date.now()-now;if(bucket.interactive)for(var i=0;i<bucket.features.length;i++){var feature=bucket.features[i];tile.featureTree.insert(feature.bbox(),bucket.name,feature)}"undefined"!=typeof self&&(self.bucketStats=self.bucketStats||{_total:0},self.bucketStats._total+=time,self.bucketStats[bucket.name]=(self.bucketStats[bucket.name]||0)+time)}return remaining--,remaining?void(bucket.next&&(bucket.next.previousPlaced=!0,parseBucket(tile,bucket.next))):tile.done()}}var tile=this,bucketInfo=WorkerTile.buckets;this.callback=callback;var tileExtent=4096;this.collision=new Collision(this.zoom,tileExtent,this.tileSize,this.depth),this.featureTree=new FeatureTree(getGeometry,getType);for(var key,bucket,prevPlacementBucket,buckets=this.buckets=sortTileIntoBuckets(this,data,bucketInfo),remaining=WorkerTile.buckets.length,orderedBuckets=WorkerTile.buckets,i=0;i<orderedBuckets.length;i++)if(bucket=buckets[orderedBuckets[i].id]){var filter=bucket.info.filter;filter&&filter.source!==this.source||(bucket.collision&&(prevPlacementBucket?prevPlacementBucket.next=bucket:bucket.previousPlaced=!0,prevPlacementBucket=bucket),bucket.getDependencies&&bucket.getDependencies(this,actor,dependenciesDone(bucket)))
}else remaining--;for(key in buckets)bucket=buckets[key],bucket.getDependencies||bucket.collision||parseBucket(tile,bucket)},WorkerTile.prototype.done=function(){var buffers=[];for(var type in this.buffers)buffers.push(this.buffers[type].array);var buckets=this.buckets,elementGroups={};for(var b in buckets)elementGroups[b]=buckets[b].elementGroups;this.callback(null,{elementGroups:elementGroups,buffers:this.buffers},buffers),this.buffers=null,this.collision=null,this.buckets=null}},{"../data/buffer/bufferset.js":2,"../data/createbucket.js":9,"../data/featuretree.js":11,"../symbol/collision.js":58,"../util/ajax.js":75,pbf:95,"vector-tile":101}],47:[function(require,module){"use strict";function AnimationLoop(){this.n=0,this.times=[]}module.exports=AnimationLoop,AnimationLoop.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},AnimationLoop.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},AnimationLoop.prototype.cancel=function(n){this.times=this.times.filter(function(t){return t.id!=n})}},{}],48:[function(require,module){"use strict";function infix(operator){return function(left,right){return left+" "+operator+" "+right}}function or(items){return"("+items.join(" || ")+")"}function and(items){return"("+items.join(" && ")+")"}function not(item){return"!"+item}function nor(items){return not(or(items))}var VectorTileFeature=require("vector-tile").VectorTileFeature,infixOperators={"==":infix("==="),">":infix(">"),$gt:infix(">"),"<":infix("<"),$lt:infix("<"),"<=":infix("<="),$lte:infix("<="),">=":infix(">="),$gte:infix(">="),"!=":infix("!=="),$ne:infix("!=="),$exists:function(value){return value+" !== undefined"}},arrayOperators={"||":or,$or:or,"&&":and,$and:and,"!":nor,$nor:nor},objOperators={"!":not,$not:not};module.exports=function(filter){function valueFilter(key,value,operator){return operator("p["+JSON.stringify(key)+"]",JSON.stringify(value))}function simpleFieldFilter(key,value,operator){var operatorFn=infixOperators[operator||"=="];if(!operatorFn)throw new Error("Unknown operator: "+operator);return Array.isArray(value)?or(value.map(function(v){return valueFilter(key,v,operatorFn)})):valueFilter(key,value,operatorFn)}function fieldFilter(key,value){if(Array.isArray(value)){if(key in arrayOperators)return arrayOperators[key](value.map(fieldsFilter))}else if("object"==typeof value){if(key in objOperators)return objOperators[key](fieldsFilter(value));var filters=[];for(var op in value)filters.push(simpleFieldFilter(key,value[op],op));return and(filters)}return simpleFieldFilter(key,value)}function typeFilter(type){return"f.type === "+VectorTileFeature.types.indexOf(type)}function fieldsFilter(obj){var filters=[];for(var key in obj)filters.push("$type"===key?typeFilter(obj[key]):fieldFilter(key,obj[key]));return filters.length?and(filters):"true"}var filterStr="var p = f.properties || {}; return "+fieldsFilter(filter||{})+";";return new Function("f",filterStr)}},{"vector-tile":101}],49:[function(require,module){"use strict";var reference=require("mapbox-gl-style-spec/reference/v4");module.exports={},reference["class"].forEach(function(className){var Calculated=function(){},style=reference[className];for(var prop in style)void 0!==style[prop]["default"]&&(Calculated.prototype[prop]=style[prop]["default"]);module.exports[className.replace("class_","")]=Calculated})},{"mapbox-gl-style-spec/reference/v4":94}],50:[function(require,module){"use strict";function ImageSprite(base){var sprite=this;this.base=base,this.retina=browser.devicePixelRatio>1,base=sprite.base+(sprite.retina?"@2x":""),ajax.getJSON(base+".json",function(err,data){err||(sprite.data=data,sprite.img&&sprite.fire("loaded"))}),ajax.getImage(base+".png",function(err,img){if(!err){for(var data=img.getData(),newdata=img.data=new Uint8Array(data.length),i=0;i<data.length;i+=4){var alpha=data[i+3]/255;newdata[i+0]=data[i+0]*alpha,newdata[i+1]=data[i+1]*alpha,newdata[i+2]=data[i+2]*alpha,newdata[i+3]=data[i+3]}sprite.img=img,sprite.data&&sprite.fire("loaded")}})}var Evented=require("../util/evented.js"),ajax=require("../util/ajax.js"),browser=require("../util/browser.js");module.exports=ImageSprite,ImageSprite.prototype=Object.create(Evented),ImageSprite.prototype.toJSON=function(){return this.base},ImageSprite.prototype.loaded=function(){return!(!this.data||!this.img)},ImageSprite.prototype.resize=function(gl){var sprite=this;if(browser.devicePixelRatio>1!==sprite.retina){var newSprite=new ImageSprite(sprite.base);newSprite.on("loaded",function(){sprite.img=newSprite.img,sprite.data=newSprite.data,sprite.retina=newSprite.retina,sprite.texture&&(gl.deleteTexture(sprite.texture),delete sprite.texture)})}},ImageSprite.prototype.bind=function(gl,linear){var sprite=this;if(sprite.loaded()){if(sprite.texture)gl.bindTexture(gl.TEXTURE_2D,sprite.texture);else{sprite.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,sprite.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);var img=sprite.img;gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,img.width,img.height,0,gl.RGBA,gl.UNSIGNED_BYTE,img.data)}var filter=linear?gl.LINEAR:gl.NEAREST;filter!==sprite.filter&&(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filter))}},ImageSprite.prototype.getPosition=function(name,repeating){repeating=repeating===!0?1:0;var pos=this.data&&this.data[name];if(pos&&this.img){var width=this.img.width,height=this.img.height;return{size:[pos.width/pos.pixelRatio,pos.height/pos.pixelRatio],tl:[(pos.x+repeating)/width,(pos.y+repeating)/height],br:[(pos.x+pos.width-2*repeating)/width,(pos.y+pos.height-2*repeating)/height]}}}},{"../util/ajax.js":75,"../util/browser.js":76,"../util/evented.js":81}],51:[function(require,module){"use strict";var reference=require("mapbox-gl-style-spec/reference/v4");module.exports={},reference.render.forEach(function(className){var Properties=function(props){for(var p in props)this[p]=props[p]},properties=reference[className];for(var prop in properties)void 0!==properties[prop]["default"]&&(Properties.prototype[prop]=properties[prop]["default"]);module.exports[className.replace("render_","")]=Properties})},{"mapbox-gl-style-spec/reference/v4":94}],52:[function(require,module){"use strict";function Style(stylesheet,animationLoop){4!==stylesheet.version,!Array.isArray(stylesheet.layers),this.classes={},this.stylesheet=stylesheet,this.animationLoop=animationLoop,this.buckets={},this.orderedBuckets=[],this.transitions={},this.computed={},this.sources={},this.cascade({transition:!1}),stylesheet.sprite&&this.setSprite(stylesheet.sprite)}function premultiplyLayer(layer,type){var colorProp=type+"-color",haloProp=type+"-halo-color",outlineProp=type+"-outline-color",color=layer[colorProp],haloColor=layer[haloProp],outlineColor=layer[outlineProp],opacity=layer[type+"-opacity"],colorOpacity=color&&opacity*color[3],haloOpacity=haloColor&&opacity*haloColor[3],outlineOpacity=outlineColor&&opacity*outlineColor[3];void 0!==colorOpacity&&1>colorOpacity&&(layer[colorProp]=util.premultiply([color[0],color[1],color[2],colorOpacity])),void 0!==haloOpacity&&1>haloOpacity&&(layer[haloProp]=util.premultiply([haloColor[0],haloColor[1],haloColor[2],haloOpacity])),void 0!==outlineOpacity&&1>outlineOpacity&&(layer[outlineProp]=util.premultiply([outlineColor[0],outlineColor[1],outlineColor[2],outlineOpacity]))}var Evented=require("../util/evented.js"),StyleTransition=require("./styletransition.js"),StyleDeclaration=require("./styledeclaration.js"),StyleConstant=require("./styleconstant.js"),CalculatedStyle=require("./calculatedstyle.js"),ImageSprite=require("./imagesprite.js"),util=require("../util/util.js");module.exports=Style,Style.prototype=Object.create(Evented),Style.prototype.recalculate=function(z){var transitions=this.transitions,layerValues={};this.sources={},this.rasterFadeDuration=300;for(var name in transitions){var layer=transitions[name],bucket=this.buckets[layer.ref||name],layerType=this.layermap[name].type;if(CalculatedStyle[layerType]){var appliedLayer=layerValues[name]=new CalculatedStyle[layerType];for(var rule in layer){var transition=layer[rule];appliedLayer[rule]=transition.at(z)}if("symbol"===layerType?(appliedLayer.hidden=!(0!==appliedLayer["text-opacity"]&&bucket.render["text-field"]||0!==appliedLayer["icon-opacity"]&&bucket.render["icon-image"]),appliedLayer.hidden||(premultiplyLayer(appliedLayer,"text"),premultiplyLayer(appliedLayer,"icon"))):(appliedLayer.hidden=0===appliedLayer[layerType+"-opacity"],appliedLayer.hidden||premultiplyLayer(appliedLayer,layerType)),!appliedLayer.hidden){var source=bucket&&bucket.source;source&&(this.sources[source]=!0)}appliedLayer["raster-fade"]&&(this.rasterFadeDuration=Math.max(this.rasterFadeDuration,appliedLayer["raster-fade"]))}}this.computed=layerValues,this.z=z,this.fire("zoom")},Style.prototype._simpleLayer=function(layer){var simple={};simple.id=layer.id;var bucket=this.buckets[layer.ref||layer.id];if(bucket&&(simple.bucket=bucket.id),layer.type&&(simple.type=layer.type),layer.layers){simple.layers=[];for(var i=0;i<layer.layers.length;i++)simple.layers.push(this._simpleLayer(layer.layers[i]))}return simple},Style.prototype._groupLayers=function(layers){for(var group,g=0,groups=[],i=layers.length-1;i>=0;i--){var layer=layers[i],bucket=this.buckets[layer.ref||layer.id],source=bucket&&bucket.source;group&&source!==group.source&&g++,groups[g]||(group=[],group.source=source,layer.layers&&(group.composited=!0),groups[g]=group),layer.layers&&"composite"==layer.type&&(group.dependencies=group.dependencies||{},group.dependencies[layer.id]=this._groupLayers(layer.layers)),group.push(this._simpleLayer(layer))}return groups},Style.prototype.cascade=function(options){function getbuckets(buckets,ordered,layers){for(var a=0;a<layers.length;a++){var layer=layers[a];if(layer.layers&&(buckets=getbuckets(buckets,ordered,layer.layers)),layer.source&&layer.type){var bucket={id:layer.id};for(var prop in layer)/^style/.test(prop)||(bucket[prop]=layer[prop]);bucket.render=StyleConstant.resolve(bucket.render,constants),buckets[layer.id]=bucket,ordered.push(bucket)}}return buckets}function resolveLayer(layermap,layer){if(!layer.ref||!layermap[layer.ref])return layer;var parent=resolveLayer(layermap,layermap[layer.ref]);return layer.render=parent.render,layer.type=parent.type,layer.filter=parent.filter,layer.source=parent.source,layer["source-layer"]=parent["source-layer"],layer["min-zoom"]=parent["min-zoom"],layer["max-zoom"]=parent["max-zoom"],layer}function flattenLayers(layers){for(var flat=[],i=0;i<layers.length;i++)flat.push(layers[i]),layers[i].layers&&flat.push.apply(flat,flattenLayers(layers[i].layers));return flat}options=options||{transition:!0};var a,b,id,prop,layer,className,styleName,style,styleTrans,constants=this.stylesheet.constants;this.orderedBuckets=[],this.buckets=getbuckets({},this.orderedBuckets,this.stylesheet.layers);var styleNames=["style"];for(className in this.classes)styleNames.push("style."+className);var flattened=flattenLayers(this.stylesheet.layers),layermap=this.layermap={};for(a=0;a<flattened.length;a++){layer=flattened[a];var newLayer={};for(var k in layer)"layers"!==k&&(newLayer[k]=layer[k]);layermap[layer.id]=newLayer,flattened[a]=newLayer}for(a=0;a<flattened.length;a++)flattened[a]=resolveLayer(layermap,flattened[a]);var transitions={},globalTrans=this.stylesheet.transition;for(a in flattened){for(layer=flattened[a],id=layer.id,style={},styleTrans={},b=0;b<styleNames.length;b++)if(styleName=styleNames[b],layer[styleName])for(prop in layer[styleName])-1===prop.indexOf("transition-")?style[prop]=layer[styleName][prop]:styleTrans[prop.replace("transition-","")]=layer[styleName][prop];style=StyleConstant.resolve(style,constants);var renderType=layer.type;transitions[id]={};for(prop in style){var newDeclaration=new StyleDeclaration(renderType,prop,style[prop]),oldTransition=this.transitions[id]&&this.transitions[id][prop],newStyleTrans={};if(newStyleTrans.duration=styleTrans[prop]&&styleTrans[prop].duration?styleTrans[prop].duration:globalTrans&&globalTrans.duration?globalTrans.duration:300,newStyleTrans.delay=styleTrans[prop]&&styleTrans[prop].delay?styleTrans[prop].delay:globalTrans&&globalTrans.delay?globalTrans.delay:0,options.transition||(newStyleTrans.duration=0,newStyleTrans.delay=0),oldTransition&&oldTransition.declaration.json===newDeclaration.json)transitions[id][prop]=oldTransition;else{var newTransition=new StyleTransition(newDeclaration,oldTransition,newStyleTrans);transitions[id][prop]=newTransition,newTransition.instant()||(newTransition.loopID=this.animationLoop.set(newTransition.endTime-(new Date).getTime())),oldTransition&&this.animationLoop.cancel(oldTransition.loopID)}}}this.transitions=transitions,this.layerGroups=this._groupLayers(this.stylesheet.layers),this.fire("change")},Style.prototype.setSprite=function(sprite){this.sprite=new ImageSprite(sprite),this.sprite.on("loaded",this.fire.bind(this,"change"))},Style.prototype.addClass=function(n,options){this.classes[n]||(this.classes[n]=!0,this.cascade(options))},Style.prototype.removeClass=function(n,options){this.classes[n]&&(delete this.classes[n],this.cascade(options))},Style.prototype.hasClass=function(n){return!!this.classes[n]},Style.prototype.setClassList=function(l,options){this.classes={};for(var i=0;i<l.length;i++)this.classes[l[i]]=!0;this.cascade(options)},Style.prototype.getClassList=function(){return Object.keys(this.classes)},Style.prototype.getLayer=function(id){return this.layermap[id]}},{"../util/evented.js":81,"../util/util.js":86,"./calculatedstyle.js":49,"./imagesprite.js":50,"./styleconstant.js":53,"./styledeclaration.js":54,"./styletransition.js":55}],53:[function(require,module){"use strict";var util=require("../util/util.js");module.exports.resolve=function(properties,constants){function resolve(value){return"string"==typeof value&&"@"===value[0]?constants[value]:value}if(!constants)return properties;var i,result={};for(var key in properties){var value=resolve(properties[key]);if(Array.isArray(value))for(value=value.slice(),i=0;i<value.length;i++)value[i]in constants&&(value[i]=resolve(value[i]));if(value.stops)for(value=util.extend({},value),value.stops=value.stops.slice(),i=0;i<value.stops.length;i++)value.stops[i][1]in constants&&(value.stops[i]=[value.stops[i][0],resolve(value.stops[i][1])]);result[key]=value}return result}},{"../util/util.js":86}],54:[function(require,module){"use strict";function StyleDeclaration(renderType,prop,value){var className="class_"+renderType,propReference=reference[className]&&reference[className][prop];propReference&&(this.value=this.parseValue(value,propReference.type,propReference.values),this.prop=prop,this.type=propReference.type,this.json=JSON.stringify(value))}function parseNumber(num){num.stops&&(num=stopsFn(num));var value=+num;return isNaN(value)?num:value}function parseNumberArray(array){var widths=array.map(parseNumber);return function(z){for(var result=[],i=0;i<widths.length;i++)result.push("function"==typeof widths[i]?widths[i](z):widths[i]);return result}}function parseColor(value){if(value.stops){for(var i=0;i<value.stops.length;i++)value.stops[i][2]=parseCSSColor(value.stops[i][1]);return stopsFn(value,!0)}if(colorCache[value])return colorCache[value];var color=prepareColor(parseCSSColor(value));return colorCache[value]=color,color}function stopsFn(params,color){var stops=params.stops,base=params.base||reference.function.base.default;return function(z){for(var low=null,high=null,i=0;i<stops.length;i++){var stop=stops[i];if(stop[0]<=z&&(low=stop),stop[0]>z){high=stop;break}}if(low&&high){var zoomDiff=high[0]-low[0],zoomProgress=z-low[0],t=0;return t=1==base?zoomProgress/zoomDiff:(Math.pow(base,zoomProgress)-1)/(Math.pow(base,zoomDiff)-1),color?prepareColor(interpColor(low[2],high[2],t)):util.interp(low[1],high[1],t)}return low?color?prepareColor(low[2]):low[1]:high?color?prepareColor(high[2]):high[1]:color?[0,0,0,1]:1}}function prepareColor(c){return[c[0]/255,c[1]/255,c[2]/255,c[3]/1]}function interpColor(from,to,t){return[util.interp(from[0],to[0],t),util.interp(from[1],to[1],t),util.interp(from[2],to[2],t),util.interp(from[3],to[3],t)]}var util=require("../util/util.js"),reference=require("mapbox-gl-style-spec/reference/v4"),parseCSSColor=require("csscolorparser").parseCSSColor;module.exports=StyleDeclaration,StyleDeclaration.prototype.calculate=function(z){return"function"==typeof this.value?this.value(z):this.value},StyleDeclaration.prototype.parseValue=function(value,type,values){return"color"===type?parseColor(value):"number"===type?parseNumber(value):"boolean"===type?Boolean(value):"image"===type?String(value):"string"===type?String(value):"array"===type?parseNumberArray(value):"enum"===type&&Array.isArray(values)&&values.indexOf(value)>=0?value:void 0};var colorCache={}},{"../util/util.js":86,csscolorparser:90,"mapbox-gl-style-spec/reference/v4":94}],55:[function(require,module){"use strict";function StyleTransition(declaration,oldTransition,value){this.declaration=declaration,this.startTime=this.endTime=(new Date).getTime();var type=declaration.type;"number"===type?this.interp=util.interp:"color"===type?this.interp=interpColor:"array"===type&&(this.interp=interpNumberArray),this.oldTransition=oldTransition,this.duration=value.duration||0,this.delay=value.delay||0,this.instant()||(this.endTime=this.startTime+this.duration+this.delay,this.ease=util.easeCubicInOut),oldTransition&&oldTransition.endTime<=this.startTime&&delete oldTransition.oldTransition}function interpNumberArray(from,to,t){return from.map(function(d,i){return util.interp(d,to[i],t)})}function interpColor(from,to,t){return[util.interp(from[0],to[0],t),util.interp(from[1],to[1],t),util.interp(from[2],to[2],t),util.interp(from[3],to[3],t)]}var util=require("../util/util.js");module.exports=StyleTransition,StyleTransition.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},StyleTransition.prototype.at=function(z,t){var value=this.declaration.calculate(z);if(this.instant())return value;if(t=t||Date.now(),t<this.endTime){var oldValue=this.oldTransition.at(z,this.startTime),eased=this.ease((t-this.startTime-this.delay)/this.duration);value=this.interp(oldValue,value,eased)}return value}},{"../util/util.js":86}],56:[function(require,module){"use strict";function Anchor(x,y,angle,scale,segment){this.x=x,this.y=y,this.angle=angle,this.scale=scale,void 0!==segment&&(this.segment=segment)}var Point=require("point-geometry");module.exports=Anchor,Anchor.prototype=Object.create(Point.prototype),Anchor.prototype.clone=function(){return new Anchor(this.x,this.y,this.angle,this.scale,this.segment)}},{"point-geometry":97}],57:[function(require,module){"use strict";function BinPack(width,height){this.width=width,this.height=height,this.free=[{x:0,y:0,w:width,h:height}]}module.exports=BinPack,BinPack.prototype.release=function(rect){for(var i=0;i<this.free.length;i++){var free=this.free[i];if(free.y==rect.y&&free.h==rect.h&&free.x+free.w==rect.x)free.w+=rect.w;else if(free.x==rect.x&&free.w==rect.w&&free.y+free.h==rect.y)free.h+=rect.h;else if(rect.y==free.y&&rect.h==free.h&&rect.x+rect.w==free.x)free.x=rect.x,free.w+=rect.w;else{if(rect.x!=free.x||rect.w!=free.w||rect.y+rect.h!=free.y)continue;free.y=rect.y,free.h+=rect.h}return this.free.splice(i,1),void this.release(free)}this.free.push(rect)},BinPack.prototype.allocate=function(width,height){for(var rect={x:1/0,y:1/0,w:1/0,h:1/0},smallest=-1,i=0;i<this.free.length;i++){var ref=this.free[i];width<=ref.w&&height<=ref.h&&ref.y<=rect.y&&ref.x<=rect.x&&(rect=ref,smallest=i)}return 0>smallest?{x:-1,y:-1}:(this.free.splice(smallest,1),rect.w<rect.h?(rect.w>width&&this.free.push({x:rect.x+width,y:rect.y,w:rect.w-width,h:height}),rect.h>height&&this.free.push({x:rect.x,y:rect.y+height,w:rect.w,h:rect.h-height})):(rect.w>width&&this.free.push({x:rect.x+width,y:rect.y,w:rect.w-width,h:rect.h}),rect.h>height&&this.free.push({x:rect.x,y:rect.y+height,w:width,h:rect.h-height})),{x:rect.x,y:rect.y,w:width,h:height})}},{}],58:[function(require,module){"use strict";function Collision(zoom,tileExtent,tileSize,placementDepth){this.hTree=rbush(),this.cTree=rbush(),this.tilePixelRatio=tileExtent/tileSize,this.zoom=zoom,placementDepth=Math.min(3,placementDepth||1,25.5-this.zoom),this.maxPlacementScale=Math.exp(Math.LN2*placementDepth);var m=4096,edge=m*this.tilePixelRatio*2;this.insert([{box:{x1:-edge,y1:-edge,x2:0,y2:edge},padding:2,minScale:0},{box:{x1:-edge,y1:-edge,x2:edge,y2:0},padding:2,minScale:0}],new Point(0,0),1,[2*Math.PI,0],!1,2),this.insert([{box:{x1:-edge,y1:0,x2:edge,y2:edge},padding:2,minScale:0},{box:{x1:0,y1:-edge,x2:edge,y2:edge},padding:2,minScale:0}],new Point(m,m),1,[2*Math.PI,0],!1,2)}var rbush=require("rbush"),rotationRange=require("./rotationrange.js"),Point=require("point-geometry");module.exports=Collision,Collision.prototype.getPlacementScale=function(glyphs,minPlacementScale){for(var k=0;k<glyphs.length;k++){var glyph=glyphs[k],box=glyph.box,bbox=glyph.hBox||box,anchor=glyph.anchor,pad=glyph.padding;if(anchor.x<0||anchor.x>4096||anchor.y<0||anchor.y>4096)return null;var minScale=Math.max(minPlacementScale,glyph.minScale),maxScale=glyph.maxScale||1/0;if(!(minScale>=maxScale)){var searchBox=this.getBox(anchor,bbox,minScale,maxScale),blocking=this.hTree.search(searchBox).concat(this.cTree.search(searchBox));if(blocking.length)for(var na=anchor,nb=box,l=0;l<blocking.length;l++){var oa=blocking[l].anchor,ob=blocking[l].box;if(na.equals(oa))return null;var padding=8*Math.max(pad,blocking[l].padding),s1=(ob.x1-nb.x2-padding)/(na.x-oa.x),s2=(ob.x2-nb.x1+padding)/(na.x-oa.x),s3=(ob.y1-nb.y2-padding)/(na.y-oa.y),s4=(ob.y2-nb.y1+padding)/(na.y-oa.y);(isNaN(s1)||isNaN(s2))&&(s1=s2=1),(isNaN(s3)||isNaN(s4))&&(s3=s4=1);var collisionFreeScale=Math.min(Math.max(s1,s2),Math.max(s3,s4));if(collisionFreeScale>minPlacementScale&&collisionFreeScale>minScale&&maxScale>collisionFreeScale&&collisionFreeScale<blocking[l].maxScale&&(minPlacementScale=collisionFreeScale),minPlacementScale>this.maxPlacementScale)return null}}}return minPlacementScale},Collision.prototype.getPlacementRange=function(glyphs,placementScale,horizontal){for(var placementRange=[2*Math.PI,0],k=0;k<glyphs.length;k++){var glyph=glyphs[k],bbox=glyph.hBox||glyph.box,anchor=glyph.anchor,minPlacedX=anchor.x+bbox.x1/placementScale,minPlacedY=anchor.y+bbox.y1/placementScale,maxPlacedX=anchor.x+bbox.x2/placementScale,maxPlacedY=anchor.y+bbox.y2/placementScale,searchBox=[minPlacedX,minPlacedY,maxPlacedX,maxPlacedY],blocking=this.hTree.search(searchBox);horizontal&&(blocking=blocking.concat(this.cTree.search(searchBox)));for(var l=0;l<blocking.length;l++){var x1,x2,y1,y2,intersectX,intersectY,b=blocking[l],bbox2=b.hBox||b.box;if(placementScale>b.placementScale?(x1=b.anchor.x+bbox2.x1/placementScale,y1=b.anchor.y+bbox2.y1/placementScale,x2=b.anchor.x+bbox2.x2/placementScale,y2=b.anchor.y+bbox2.y2/placementScale,intersectX=maxPlacedX>x1&&x2>minPlacedX,intersectY=maxPlacedY>y1&&y2>minPlacedY):(x1=anchor.x+bbox.x1/b.placementScale,y1=anchor.y+bbox.y1/b.placementScale,x2=anchor.x+bbox.x2/b.placementScale,y2=anchor.y+bbox.y2/b.placementScale,intersectX=x1<b[2]&&x2>b[0],intersectY=y1<b[3]&&y2>b[1]),intersectX&&intersectY){var scale=Math.max(placementScale,b.placementScale),range=rotationRange.rotationRange(glyph,b,scale);placementRange[0]=Math.min(placementRange[0],range[0]),placementRange[1]=Math.max(placementRange[1],range[1])}}}return placementRange},Collision.prototype.insert=function(glyphs,anchor,placementScale,placementRange,horizontal){for(var allBounds=[],k=0;k<glyphs.length;k++){var glyph=glyphs[k],bbox=glyph.hBox||glyph.box,minScale=Math.max(placementScale,glyph.minScale),maxScale=glyph.maxScale||1/0,bounds=this.getBox(anchor,bbox,minScale,maxScale);bounds.anchor=anchor,bounds.box=glyph.box,glyph.hBox&&(bounds.hBox=bbox),bounds.placementRange=placementRange,bounds.placementScale=minScale,bounds.maxScale=maxScale,bounds.padding=glyph.padding,allBounds.push(bounds)}(horizontal?this.hTree:this.cTree).load(allBounds)},Collision.prototype.getBox=function(anchor,bbox,minScale,maxScale){return[anchor.x+Math.min(bbox.x1/minScale,bbox.x1/maxScale),anchor.y+Math.min(bbox.y1/minScale,bbox.y1/maxScale),anchor.x+Math.max(bbox.x2/minScale,bbox.x2/maxScale),anchor.y+Math.max(bbox.y2/minScale,bbox.y2/maxScale)]}},{"./rotationrange.js":64,"point-geometry":97,rbush:99}],59:[function(require,module){"use strict";function GlyphAtlas(width,height){this.width=width,this.height=height,this.bin=new BinPack(width,height),this.index={},this.ids={},this.data=new Uint8Array(width*height)}var BinPack=require("./binpack.js");module.exports=GlyphAtlas,GlyphAtlas.prototype={get debug(){return"canvas"in this},set debug(value){value&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!value&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}},GlyphAtlas.prototype.getGlyphs=function(){var split,name,id,glyphs={};for(var key in this.ids)split=key.split("#"),name=split[0],id=split[1],glyphs[name]||(glyphs[name]=[]),glyphs[name].push(id);return glyphs},GlyphAtlas.prototype.getRects=function(){var split,name,id,rects={};for(var key in this.ids)split=key.split("#"),name=split[0],id=split[1],rects[name]||(rects[name]={}),rects[name][id]=this.index[key];return rects},GlyphAtlas.prototype.removeGlyphs=function(id){for(var key in this.ids){var ids=this.ids[key],pos=ids.indexOf(id);if(pos>=0&&ids.splice(pos,1),this.ids[key]=ids,!ids.length){for(var rect=this.index[key],target=this.data,y=0;y<rect.h;y++)for(var y1=this.width*(rect.y+y)+rect.x,x=0;x<rect.w;x++)target[y1+x]=0;this.dirty=!0,this.bin.release(rect),delete this.index[key],delete this.ids[key]}}this.updateTexture(this.gl)},GlyphAtlas.prototype.addGlyph=function(id,name,glyph,buffer){if(!glyph)return null;var key=name+"#"+glyph.id;if(this.index[key])return this.ids[key].indexOf(id)<0&&this.ids[key].push(id),this.index[key];if(!glyph.bitmap)return null;var buffered_width=glyph.width+2*buffer,buffered_height=glyph.height+2*buffer,pack_width=buffered_width,pack_height=buffered_height;pack_width+=4-pack_width%4,pack_height+=4-pack_height%4;var rect=this.bin.allocate(pack_width,pack_height);if(rect.x<0)return{glyph:glyph,rect:null};rect.l=glyph.left,rect.t=glyph.top,this.index[key]=rect,this.ids[key]=[id];for(var target=this.data,source=glyph.bitmap,y=0;buffered_height>y;y++)for(var y1=this.width*(rect.y+y)+rect.x,y2=buffered_width*y,x=0;buffered_width>x;x++)target[y1+x]=source[y2+x];return this.dirty=!0,rect},GlyphAtlas.prototype.bind=function(gl){this.gl=gl,this.texture?gl.bindTexture(gl.TEXTURE_2D,this.texture):(this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.ALPHA,this.width,this.height,0,gl.ALPHA,gl.UNSIGNED_BYTE,null))},GlyphAtlas.prototype.updateTexture=function(gl){if(this.bind(gl),this.dirty){if(gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this.width,this.height,gl.ALPHA,gl.UNSIGNED_BYTE,this.data),this.ctx){for(var data=this.ctx.getImageData(0,0,this.width,this.height),i=0,j=0;i<this.data.length;i++,j+=4)data.data[j]=this.data[i],data.data[j+1]=this.data[i],data.data[j+2]=this.data[i],data.data[j+3]=255;this.ctx.putImageData(data,0,0),this.ctx.strokeStyle="red";for(var k=0;k<this.bin.free.length;k++){var free=this.bin.free[k];this.ctx.strokeRect(free.x,free.y,free.w,free.h)}}this.dirty=!1}}},{"./binpack.js":57}],60:[function(require,module){"use strict";function GlyphSource(url,glyphAtlas){this.url=url,this.glyphAtlas=glyphAtlas,this.stacks={},this.loading={}}function simpleGlyph(glyph){return{advance:glyph.advance,left:glyph.left,top:glyph.top}}function glyphUrl(fontstack,range,url,subdomains){return subdomains=subdomains||"abc",url.replace("{s}",subdomains[fontstack.length%subdomains.length]).replace("{fontstack}",fontstack).replace("{range}",range)}var getArrayBuffer=require("../util/ajax.js").getArrayBuffer,Glyphs=require("../util/glyphs.js"),Protobuf=require("pbf");module.exports=GlyphSource,GlyphSource.prototype.getRects=function(fontstack,glyphIDs,tileID,callback){function onRangeLoaded(err,range,data){if(!err)for(var stack=glyphSource.stacks[fontstack][range]=data.stacks[fontstack],i=0;i<missing[range].length;i++){var glyphID=missing[range][i],glyph=stack.glyphs[glyphID],buffer=3;rects[glyphID]=glyphAtlas.addGlyph(tileID,fontstack,glyph,buffer),glyph&&(glyphs[glyphID]=simpleGlyph(glyph))}remaining--,remaining||callback(void 0,result)}void 0===this.stacks[fontstack]&&(this.stacks[fontstack]={});for(var rects={},glyphs={},result={rects:rects,glyphs:glyphs},stack=this.stacks[fontstack],glyphAtlas=this.glyphAtlas,missing={},remaining=0,i=0;i<glyphIDs.length;i++){var glyphID=glyphIDs[i],range=Math.floor(glyphID/256);if(stack[range]){var glyph=stack[range].glyphs[glyphID],buffer=3;rects[glyphID]=glyphAtlas.addGlyph(tileID,fontstack,glyph,buffer),glyph&&(glyphs[glyphID]=simpleGlyph(glyph))}else void 0===missing[range]&&(missing[range]=[],remaining++),missing[range].push(glyphID)}remaining||callback(void 0,result);var glyphSource=this;for(var r in missing)this.loadRange(fontstack,r,onRangeLoaded)},GlyphSource.prototype.loadRange=function(fontstack,range,callback){if(256*range>=65280)return callback("gyphs > 65280 not supported");void 0===this.loading[fontstack]&&(this.loading[fontstack]={});var loading=this.loading[fontstack];if(loading[range])loading[range].push(callback);else{loading[range]=[callback];var rangeName=256*range+"-"+(256*range+255),url=glyphUrl(fontstack,rangeName,this.url);getArrayBuffer(url,function(err,data){if(err)return callback(err);for(var glyphs=new Glyphs(new Protobuf(new Uint8Array(data))),i=0;i<loading[range].length;i++)loading[range][i](void 0,range,glyphs);delete loading[range][i]})}}},{"../util/ajax.js":75,"../util/glyphs.js":82,pbf:95}],61:[function(require,module){"use strict";function interpolate(vertices,spacing,minScale,maxScale,tilePixelRatio,start){void 0===minScale&&(minScale=0),maxScale=Math.round(Math.max(Math.min(8,maxScale/2),1)),spacing*=tilePixelRatio/maxScale;for(var minScales=minScaleArrays[maxScale],len=minScales.length,distance=0,markedDistance=0,added=start||0,points=[],i=0;i<vertices.length-1;i++){for(var a=vertices[i],b=vertices[i+1],segmentDist=a.dist(b),angle=b.angleTo(a);distance+segmentDist>markedDistance+spacing;){markedDistance+=spacing;var t=(markedDistance-distance)/segmentDist,x=util.interp(a.x,b.x,t),y=util.interp(a.y,b.y,t),s=minScales[added%len];x>=0&&4096>x&&y>=0&&4096>y&&points.push(new Anchor(x,y,angle,s,i)),added++}distance+=segmentDist}return points}var util=require("../util/util.js"),Anchor=require("../symbol/anchor.js");module.exports=interpolate;var minScale=.5,minScaleArrays={1:[minScale],2:[minScale,2],4:[minScale,4,2,4],8:[minScale,8,4,8,2,8,4,8]}},{"../symbol/anchor.js":56,"../util/util.js":86}],62:[function(require,module){"use strict";function getIcon(anchor,image,boxScale,line,props){var x=image.width/2/image.pixelRatio,y=image.height/2/image.pixelRatio,dx=props["icon-offset"][0],dy=props["icon-offset"][1],x1=dx-x,x2=dx+x,y1=dy-y,y2=dy+y,tl=new Point(x1,y1),tr=new Point(x2,y1),br=new Point(x2,y2),bl=new Point(x1,y2),angle=props["icon-rotate"]*Math.PI/180;if(void 0!==anchor.segment&&"viewport"!==props["icon-rotation-alignment"]){var next=line[anchor.segment];angle+=-Math.atan2(next.x-anchor.x,next.y-anchor.y)+Math.PI/2
}if(angle){var sin=Math.sin(angle),cos=Math.cos(angle),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix),tr=tr.matMult(matrix),bl=bl.matMult(matrix),br=br.matMult(matrix),x1=Math.min(tl.x,tr.x,bl.x,br.x),x2=Math.max(tl.x,tr.x,bl.x,br.x),y1=Math.min(tl.y,tr.y,bl.y,br.y),y2=Math.max(tl.y,tr.y,bl.y,br.y)}var box={x1:x1*boxScale,x2:x2*boxScale,y1:y1*boxScale,y2:y2*boxScale},iconBox={box:box,anchor:anchor,minScale:minScale,maxScale:1/0,padding:props["icon-padding"]},icon={tl:tl,tr:tr,br:br,bl:bl,tex:image,angle:0,anchor:anchor,minScale:minScale,maxScale:1/0};return{shapes:[icon],boxes:[iconBox],minScale:anchor.scale}}function getGlyphs(anchor,origin,shaping,faces,boxScale,horizontal,line,props){for(var maxAngleDelta=props["text-max-angle"]*Math.PI/180,rotate=props["text-rotate"]*Math.PI/180,padding=props["text-padding"],alongLine="viewport"!==props["text-rotation-alignment"],keepUpright=props["text-keep-upright"],glyphs=[],boxes=[],buffer=3,k=0;k<shaping.length;k++){var shape=shaping[k],fontstack=faces[shape.fontstack],glyph=fontstack.glyphs[shape.glyph],rect=fontstack.rects[shape.glyph];if(glyph&&rect&&rect.w>0&&rect.h>0){var glyphInstances,x=(origin.x+shape.x+glyph.left-buffer+rect.w/2)*boxScale;void 0!==anchor.segment&&alongLine?(glyphInstances=[],getSegmentGlyphs(glyphInstances,anchor,x,line,anchor.segment,1,maxAngleDelta),keepUpright&&getSegmentGlyphs(glyphInstances,anchor,x,line,anchor.segment,-1,maxAngleDelta)):glyphInstances=[{anchor:anchor,offset:0,angle:0,maxScale:1/0,minScale:minScale}];for(var x1=origin.x+shape.x+glyph.left-buffer,y1=origin.y+shape.y-glyph.top-buffer,x2=x1+rect.w,y2=y1+rect.h,otl=new Point(x1,y1),otr=new Point(x2,y1),obl=new Point(x1,y2),obr=new Point(x2,y2),obox={x1:boxScale*x1,y1:boxScale*y1,x2:boxScale*x2,y2:boxScale*y2},i=0;i<glyphInstances.length;i++){var instance=glyphInstances[i],tl=otl,tr=otr,bl=obl,br=obr,box=obox,angle=instance.angle+rotate;if(angle){var sin=Math.sin(angle),cos=Math.cos(angle),matrix=[cos,-sin,sin,cos];tl=tl.matMult(matrix),tr=tr.matMult(matrix),bl=bl.matMult(matrix),br=br.matMult(matrix)}var glyphMinScale=Math.max(instance.minScale,anchor.scale);glyphs.push({tl:tl,tr:tr,bl:bl,br:br,tex:rect,angle:(anchor.angle+rotate+instance.offset+2*Math.PI)%(2*Math.PI),anchor:instance.anchor,minScale:glyphMinScale,maxScale:instance.maxScale}),instance.offset||(angle&&(box={x1:boxScale*Math.min(tl.x,tr.x,bl.x,br.x),y1:boxScale*Math.min(tl.y,tr.y,bl.y,br.y),x2:boxScale*Math.max(tl.x,tr.x,bl.x,br.x),y2:boxScale*Math.max(tl.y,tr.y,bl.y,br.y)}),boxes.push({box:box,anchor:instance.anchor,minScale:glyphMinScale,maxScale:instance.maxScale,padding:padding}))}}}horizontal&&(boxes=[getMergedBoxes(boxes,anchor)]);for(var minPlacementScale=anchor.scale,minGlyphScale=1/0,m=0;m<boxes.length;m++)minGlyphScale=Math.min(minGlyphScale,boxes[m].minScale);return minGlyphScale=Math.max(minPlacementScale,minScale),{boxes:boxes,shapes:glyphs,minScale:minGlyphScale}}function getSegmentGlyphs(glyphs,anchor,offset,line,segment,direction,maxAngleDelta){var upsideDown=0>direction;0>offset&&(direction*=-1),direction>0&&segment++;var prevAngle,newAnchor=anchor,end=line[segment],prevscale=1/0;offset=Math.abs(offset);var placementScale=anchor.scale;segment_loop:for(;;){var dist=newAnchor.dist(end),scale=offset/dist,angle=-Math.atan2(end.x-newAnchor.x,end.y-newAnchor.y)+direction*Math.PI/2;upsideDown&&(angle+=Math.PI);var angleDiff=(angle-prevAngle)%(2*Math.PI);if(prevAngle&&Math.abs(angleDiff)>maxAngleDelta){anchor.scale=prevscale;break}if(glyphs.push({anchor:newAnchor,offset:upsideDown?Math.PI:0,minScale:scale,maxScale:prevscale,angle:(angle+2*Math.PI)%(2*Math.PI)}),placementScale>=scale)break;for(newAnchor=end;newAnchor.equals(end);)if(segment+=direction,end=line[segment],!end){anchor.scale=scale;break segment_loop}var unit=end.sub(newAnchor)._unit();newAnchor=newAnchor.sub(unit._mult(dist)),prevscale=scale,prevAngle=angle}}function getMergedBoxes(glyphs,anchor){for(var mergedglyphs={box:{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0},anchor:anchor,minScale:0,padding:-1/0},box=mergedglyphs.box,m=0;m<glyphs.length;m++){var gbox=glyphs[m].box;box.x1=Math.min(box.x1,gbox.x1),box.y1=Math.min(box.y1,gbox.y1),box.x2=Math.max(box.x2,gbox.x2),box.y2=Math.max(box.y2,gbox.y2),mergedglyphs.minScale=Math.max(mergedglyphs.minScale,glyphs[m].minScale),mergedglyphs.padding=Math.max(mergedglyphs.padding,glyphs[m].padding)}var x12=box.x1*box.x1,y12=box.y1*box.y1,x22=box.x2*box.x2,y22=box.y2*box.y2,diag=Math.sqrt(Math.max(x12+y12,x12+y22,x22+y12,x22+y22));return mergedglyphs.hBox={x1:-diag,y1:-diag,x2:diag,y2:diag},mergedglyphs}var Point=require("point-geometry");module.exports={getIcon:getIcon,getGlyphs:getGlyphs};var minScale=.5},{"point-geometry":97}],63:[function(require,module){"use strict";function resolveText(features,info,glyphs){for(var textFeatures=[],codepoints=[],i=0,fl=features.length;fl>i;i++){var text=resolveTokens(features[i].properties,info["text-field"]),hastext=!1;if(text){text=text.toString();var transform=info["text-transform"];"uppercase"===transform?text=text.toLocaleUpperCase():"lowercase"===transform&&(text=text.toLocaleLowerCase());for(var j=0,jl=text.length;jl>j;j++)text.charCodeAt(j)<=65533&&(codepoints.push(text.charCodeAt(j)),hastext=!0);hastext&&(textFeatures[i]=text)}}return codepoints=uniq(codepoints,glyphs),{textFeatures:textFeatures,codepoints:codepoints}}function uniq(ids,alreadyHave){var last,u=[];ids.sort(sortNumbers);for(var i=0;i<ids.length;i++)ids[i]!==last&&(last=ids[i],alreadyHave[last]||u.push(ids[i]));return u}function sortNumbers(a,b){return a-b}var resolveTokens=require("../util/token.js");module.exports=resolveText},{"../util/token.js":84}],64:[function(require,module){"use strict";function rotationRange(inserting,blocker,scale){var collisions,box,a=inserting,b=blocker,relativeAnchor=new Point((b.anchor.x-a.anchor.x)*scale,(b.anchor.y-a.anchor.y)*scale);return a.hBox&&b.hBox?collisions=rotatingRotatingCollisions(a.box,b.box,relativeAnchor):a.hBox?(box={x1:b.box.x1+relativeAnchor.x,y1:b.box.y1+relativeAnchor.y,x2:b.box.x2+relativeAnchor.x,y2:b.box.y2+relativeAnchor.y},collisions=rotatingFixedCollisions(a.box,box)):b.hBox?(box={x1:a.box.x1-relativeAnchor.x,y1:a.box.y1-relativeAnchor.y,x2:a.box.x2-relativeAnchor.x,y2:a.box.y2-relativeAnchor.y},collisions=rotatingFixedCollisions(b.box,box)):collisions=[],mergeCollisions(collisions,blocker.placementRange)}function mergeCollisions(collisions,ignoreRange){for(var min=2*Math.PI,max=0,i=0;i<collisions.length;i++){var collision=collisions[i],entryOutside=ignoreRange[0]<=collision[0]&&collision[0]<=ignoreRange[1],exitOutside=ignoreRange[0]<=collision[1]&&collision[1]<=ignoreRange[1];entryOutside&&exitOutside||(entryOutside?(min=Math.min(min,ignoreRange[1]),max=Math.max(max,collision[1])):exitOutside?(min=Math.min(min,collision[0]),max=Math.max(max,ignoreRange[0])):(min=Math.min(min,collision[0]),max=Math.max(max,collision[1])))}return[min,max]}function rotatingRotatingCollisions(a,b,anchorToAnchor){var k,d=anchorToAnchor.mag(),angleBetweenAnchors=anchorToAnchor.angleWith(horizontal),c=[],collisions=[];c[0]=Math.asin((a.y2-b.y1)/d),c[1]=Math.asin((a.y2-b.y1)/d)+Math.PI,c[2]=2*Math.PI-Math.asin((-a.y1+b.y2)/d),c[3]=Math.PI-Math.asin((-a.y1+b.y2)/d),c[4]=2*Math.PI-Math.acos((a.x2-b.x1)/d),c[5]=Math.acos((a.x2-b.x1)/d),c[6]=Math.PI-Math.acos((-a.x1+b.x2)/d),c[7]=Math.PI+Math.acos((-a.x1+b.x2)/d);var rl=a.x2-b.x1,lr=-a.x1+b.x2,tb=a.y2-b.y1,bt=-a.y1+b.y2,e=[];for(e[0]=rl*rl+tb*tb,e[1]=lr*lr+tb*tb,e[2]=rl*rl+bt*bt,e[3]=lr*lr+bt*bt,e[4]=rl*rl+tb*tb,e[5]=rl*rl+bt*bt,e[6]=lr*lr+bt*bt,e[7]=lr*lr+tb*tb,c=c.filter(function(x,i){return!isNaN(x)&&d*d<=e[i]}).map(function(x){return(x+angleBetweenAnchors+2*Math.PI)%(2*Math.PI)}),c.sort(),k=0;k<c.length;k+=2)collisions.push([c[k],c[k+1]]);return collisions}function rotatingFixedCollisions(rotating,fixed){for(var cornersR=getCorners(rotating),cornersF=getCorners(fixed),collisions=[],i=0;4>i;i++)cornerBoxCollisions(collisions,cornersR[i],cornersF),cornerBoxCollisions(collisions,cornersF[i],cornersR,!0);return collisions}function cornerBoxCollisions(collisions,corner,boxCorners,flip){for(var radius=corner.mag(),angles=[],i=0,j=3;4>i;j=i++)circleEdgeCollisions(angles,corner,radius,boxCorners[j],boxCorners[i]);if(angles.length%2!==0)throw"expecting an even number of intersections";angles.sort();for(var k=0;k<angles.length;k+=2)collisions[k/2]=flip?[2*Math.PI-angles[k+1],2*Math.PI-angles[k]]:[angles[k],angles[k+1]];return collisions}function circleEdgeCollisions(angles,corner,radius,p1,p2){var edgeX=p2.x-p1.x,edgeY=p2.y-p1.y,a=edgeX*edgeX+edgeY*edgeY,b=2*(edgeX*p1.x+edgeY*p1.y),c=p1.x*p1.x+p1.y*p1.y-radius*radius,discriminant=b*b-4*a*c;if(discriminant>0){var x1=(-b-Math.sqrt(discriminant))/(2*a),x2=(-b+Math.sqrt(discriminant))/(2*a);x1>0&&1>x1&&angles.push(getAngle(p1,p2,x1,corner)),x2>0&&1>x2&&angles.push(getAngle(p1,p2,x2,corner))}return angles}function getAngle(p1,p2,d,corner){return(-corner.angleWithSep(util.interp(p1.x,p2.x,d),util.interp(p1.y,p2.y,d))+2*Math.PI)%(2*Math.PI)}function getCorners(a){return[new Point(a.x1,a.y1),new Point(a.x1,a.y2),new Point(a.x2,a.y2),new Point(a.x2,a.y1)]}var util=require("../util/util.js"),Point=require("point-geometry");module.exports={rotationRange:rotationRange,mergeCollisions:mergeCollisions,rotatingFixedCollisions:rotatingFixedCollisions,rotatingRotatingCollisions:rotatingRotatingCollisions,cornerBoxCollisions:cornerBoxCollisions,circleEdgeCollisions:circleEdgeCollisions,getCorners:getCorners};var horizontal=new Point(1,0)},{"../util/util.js":86,"point-geometry":97}],65:[function(require,module){"use strict";function shape(text,name,stacks,maxWidth,lineHeight,horizontalAlign,verticalAlign,justify,spacing,translate){for(var glyph,id,glyphs=stacks[name].glyphs,shaping=[],x=translate[0],y=translate[1],i=0;i<text.length;i++)id=text.charCodeAt(i),glyph=glyphs[id],0!==id&&glyph&&(shaping.push({fontstack:name,glyph:id,x:x,y:y}),x+=glyph.advance+spacing);return shaping.length?shaping=linewrap(shaping,glyphs,lineHeight,maxWidth,horizontalAlign,verticalAlign,justify):!1}function linewrap(shaping,glyphs,lineHeight,maxWidth,horizontalAlign,verticalAlign,justify){var lastSafeBreak=null,lengthBeforeCurrentLine=0,lineStartIndex=0,line=0,maxLineLength=0;if(maxWidth)for(var i=0;i<shaping.length;i++){var shape=shaping[i];if(shape.x-=lengthBeforeCurrentLine,shape.y+=lineHeight*line,shape.x>maxWidth&&null!==lastSafeBreak){var lineLength=shaping[lastSafeBreak+1].x;maxLineLength=Math.max(lineLength,maxLineLength);for(var k=lastSafeBreak+1;i>=k;k++)shaping[k].y+=lineHeight,shaping[k].x-=lineLength;justify&&justifyLine(shaping,glyphs,lineStartIndex,lastSafeBreak-1,justify),lineStartIndex=lastSafeBreak+1,lastSafeBreak=null,lengthBeforeCurrentLine+=lineLength,line++}breakable[shape.glyph]&&(lastSafeBreak=i)}return maxLineLength=maxLineLength||shaping[shaping.length-1].x,justifyLine(shaping,glyphs,lineStartIndex,shaping.length-1,justify),align(shaping,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,line),shaping}function justifyLine(shaping,glyphs,start,end,justify){for(var lastAdvance=glyphs[shaping[end].glyph].advance,lineIndent=(shaping[end].x+lastAdvance)*justify,j=start;end>=j;j++)shaping[j].x-=lineIndent}function align(shaping,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,line){for(var shiftX=(justify-horizontalAlign)*maxLineLength,shiftY=(-verticalAlign*(line+1)+.5)*lineHeight,j=0;j<shaping.length;j++)shaping[j].x+=shiftX,shaping[j].y+=shiftY}module.exports={shape:shape};var breakable={32:!0}},{}],66:[function(require,module){"use strict";function Attribution(){}var Control=require("./control.js"),DOM=require("../../util/dom.js"),util=require("../../util/util.js");module.exports=Attribution,Attribution.prototype=util.inherit(Control,{onAdd:function(map){var className="mapboxgl-ctrl-attrib",container=this._container=DOM.create("div",className,map.container);return this._update(),map.on("source.add",this._update.bind(this)),map.on("moveend",this._updateEditLink.bind(this)),container},_update:function(){var attributions=[];for(var id in this._map.sources){var source=this._map.sources[id];source.tileJSON&&source.tileJSON.attribution&&attributions.push(source.tileJSON.attribution)}this._container.innerHTML=attributions.join(" | "),this._editLink=this._container.getElementsByClassName("mapbox-improve-map")[0],this._updateEditLink()},_updateEditLink:function(){if(this._editLink){var center=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+center.lng+"/"+center.lat+"/"+Math.round(this._map.getZoom()+1)}}})},{"../../util/dom.js":80,"../../util/util.js":86,"./control.js":67}],67:[function(require,module){"use strict";function Control(){}module.exports=Control,Control.prototype={addTo:function(map){return this._map=map,this._container=this.onAdd(map),this},remove:function(){return this._container.parentNode.removeChild(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this}}},{}],68:[function(require,module){"use strict";function Navigation(){}var Control=require("./control.js"),DOM=require("../../util/dom.js"),util=require("../../util/util.js");module.exports=Navigation,Navigation.prototype=util.inherit(Control,{onAdd:function(map){var className="mapboxgl-ctrl-nav",container=this._container=DOM.create("div",className,map.container);this._zoomInButton=this._createButton(className+"-zoom-in",map.zoomIn.bind(map)),this._zoomOutButton=this._createButton(className+"-zoom-out",map.zoomOut.bind(map)),this._compass=this._createButton(className+"-compass",map.resetNorth.bind(map));var compassCanvas=this._compassCanvas=DOM.create("canvas",className+"-compass-canvas",this._compass);return compassCanvas.style.cssText="width:26px; height:26px;",compassCanvas.width=52,compassCanvas.height=52,this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._compassCtx=compassCanvas.getContext("2d"),map.on("rotate",this._drawNorth.bind(this)),this._drawNorth(),container},_onCompassDown:function(e){DOM.disableDrag(),document.addEventListener("mousemove",this._onCompassMove),document.addEventListener("mouseup",this._onCompassUp),this._prevX=e.screenX,e.stopPropagation()},_onCompassMove:function(e){var x=e.screenX,d=2>x?-5:x>window.screen.width-2?5:(x-this._prevX)/4;this._map.setBearing(this._map.getBearing()-d),this._prevX=e.screenX,e.preventDefault()},_onCompassUp:function(){document.removeEventListener("mousemove",this._onCompassMove),document.removeEventListener("mouseup",this._onCompassUp),DOM.enableDrag()},_createButton:function(className,fn){var a=DOM.create("a",className,this._container);return a.href="#",a.addEventListener("click",function(e){fn(),e.preventDefault(),e.stopPropagation()}),a},_drawNorth:function(){var rad=20,width=8,center=26,angle=this._map.transform.angle+Math.PI/2,ctx=this._compassCtx;this._compassCanvas.width=this._compassCanvas.width,ctx.translate(center,center),ctx.rotate(angle),ctx.beginPath(),ctx.fillStyle="#000",ctx.lineTo(0,-width),ctx.lineTo(-rad,0),ctx.lineTo(0,width),ctx.fill(),ctx.beginPath(),ctx.fillStyle="#bbb",ctx.moveTo(0,0),ctx.lineTo(0,width),ctx.lineTo(rad,0),ctx.lineTo(0,-width),ctx.fill(),ctx.beginPath(),ctx.strokeStyle="#fff",ctx.lineWidth=4,ctx.moveTo(0,-width),ctx.lineTo(0,width),ctx.stroke()}})},{"../../util/dom.js":80,"../../util/util.js":86,"./control.js":67}],69:[function(require,module,exports){"use strict";var util=require("../util/util.js"),browser=require("../util/browser.js"),LatLng=require("../geo/latlng.js"),LatLngBounds=require("../geo/latlngbounds.js"),Point=require("point-geometry");util.extend(exports,{isEasing:function(){return!!this._stopFn},stop:function(){return this._stopFn&&(this._stopFn(),delete this._stopFn),this},panBy:function(offset,options){return this.panTo(this.transform.center,util.extend({offset:Point.convert(offset).mult(-1)},options)),this},panTo:function(latlng,options){this.stop(),latlng=LatLng.convert(latlng),options=util.extend({duration:500,easing:util.ease,offset:[0,0]},options);var tr=this.transform,offset=Point.convert(options.offset).rotate(-tr.angle),from=tr.point,to=tr.project(latlng).sub(offset);return options.noMoveStart||this.fire("movestart"),this._stopFn=browser.timed(function(t){tr.center=tr.unproject(from.add(to.sub(from).mult(options.easing(t)))),this._move(),1===t&&this.fire("moveend")},options.animate===!1?0:options.duration,this),this},zoomTo:function(zoom,options){this.stop(),options=util.extend({duration:500,offset:[0,0]},options);var tr=this.transform,center=tr.centerPoint.add(Point.convert(options.offset)),easing=this._updateEasing(options.duration,zoom,options.easing),startZoom=tr.zoom;return options.animate===!1&&(options.duration=0),this.zooming||(this.zooming=!0,this.fire("movestart")),this._stopFn=browser.timed(function(t){tr.zoomAroundTo(util.interp(startZoom,zoom,easing(t)),center),this.style.animationLoop.set(300),this._move(!0),1===t&&(this.ease=null,options.duration>=200&&(this.fire("moveend"),this.zooming=!1))},options.duration,this),options.duration<200&&(clearTimeout(this._onZoomEnd),this._onZoomEnd=setTimeout(function(){this.zooming=!1,this._rerender(),this.fire("moveend")}.bind(this),200)),this},zoomIn:function(options){this.zoomTo(this.getZoom()+1,options)},zoomOut:function(options){this.zoomTo(this.getZoom()-1,options)},rotateTo:function(bearing,options){this.stop(),options=util.extend({duration:500,easing:util.ease},options);var start=this.getBearing(),offset=Point.convert(options.offset);return this.rotating=!0,this.fire("movestart"),this._stopFn=browser.timed(function(t){1===t&&(this.rotating=!1),this.transform.rotate(util.interp(start,bearing,options.easing(t)),offset),this._move(!1,!0).fire("moveend")},options.animate===!1?0:options.duration,this),this},resetNorth:function(options){return this.rotateTo(0,util.extend({duration:1e3},options))},fitBounds:function(bounds,options){options=util.extend({padding:0,offset:[0,0],maxZoom:1/0},options),bounds=LatLngBounds.convert(bounds);var offset=Point.convert(options.offset),tr=this.transform,nw=tr.project(bounds.getNorthWest()),se=tr.project(bounds.getSouthEast()),size=se.sub(nw),center=tr.unproject(nw.add(se).div(2)),scaleX=(tr.width-2*options.padding-2*Math.abs(offset.x))/size.x,scaleY=(tr.height-2*options.padding-2*Math.abs(offset.y))/size.y,zoom=Math.min(tr.scaleZoom(tr.scale*Math.min(scaleX,scaleY)),options.maxZoom);return options.linear?this.easeTo(center,zoom,0,options):this.flyTo(center,zoom,0,options)},easeTo:function(latlng,zoom,bearing,options){options=util.extend({offset:[0,0],duration:500,easing:util.ease},options),latlng=LatLng.convert(latlng);var offset=Point.convert(options.offset),tr=this.transform,startZoom=this.getZoom(),startBearing=this.getBearing();zoom=void 0===zoom?startZoom:zoom,bearing=void 0===bearing?startBearing:bearing;var scale=tr.zoomScale(zoom-startZoom),from=tr.point,to=tr.project(latlng).sub(offset.div(scale)),around=tr.centerPoint.add(to.sub(from).div(1-1/scale));return zoom!==startZoom&&(this.zooming=!0),startBearing!==bearing&&(this.rotating=!0),this.fire("movestart"),this._stopFn=browser.timed(function(t){var k=options.easing(t);zoom!==startZoom&&tr.zoomAroundTo(startZoom+k*(zoom-startZoom),around),bearing!==startBearing&&(tr.bearing=util.interp(startBearing,bearing,k)),this.style.animationLoop.set(300),this._move(zoom!==startZoom,bearing!==startBearing),1===t&&(this.zooming=!1,this.rotating=!1,this.fire("moveend"))},options.animate===!1?0:options.duration,this),this},flyTo:function(latlng,zoom,bearing,options){function r(i){var b=(w1*w1-w0*w0+(i?-1:1)*rho2*rho2*u1*u1)/(2*(i?w1:w0)*rho2*u1);return Math.log(Math.sqrt(b*b+1)-b)}function sinh(n){return(Math.exp(n)-Math.exp(-n))/2}function cosh(n){return(Math.exp(n)+Math.exp(-n))/2}function tanh(n){return sinh(n)/cosh(n)}options=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},options),latlng=LatLng.convert(latlng);var offset=Point.convert(options.offset),tr=this.transform,startZoom=this.getZoom(),startBearing=this.getBearing();zoom=void 0===zoom?startZoom:zoom,bearing=void 0===bearing?startBearing:bearing;var scale=tr.zoomScale(zoom-startZoom),from=tr.point,to=tr.project(latlng).sub(offset.div(scale));if(options.animate===!1)return this.setView(latlng,zoom,bearing);var startWorldSize=tr.worldSize,rho=options.curve,V=options.speed,w0=Math.max(tr.width,tr.height),w1=w0/scale,u1=to.sub(from).mag(),rho2=rho*rho,r0=r(0),w=function(s){return cosh(r0)/cosh(r0+rho*s)},u=function(s){return w0*((cosh(r0)*tanh(r0+rho*s)-sinh(r0))/rho2)/u1},S=(r(1)-r0)/rho;if(Math.abs(u1)<1e-6){if(Math.abs(w0-w1)<1e-6)return this;var k=w0>w1?-1:1;S=Math.abs(Math.log(w1/w0))/rho,u=function(){return 0},w=function(s){return Math.exp(k*rho*s)}}var duration=1e3*S/V;return this.zooming=!0,startBearing!=bearing&&(this.rotating=!0),this.fire("movestart"),this._stopFn=browser.timed(function(t){var k=options.easing(t),s=k*S,us=u(s);tr.zoom=startZoom+tr.scaleZoom(1/w(s)),tr.center=tr.unproject(from.add(to.sub(from).mult(us)),startWorldSize),bearing!==startBearing&&(tr.bearing=util.interp(startBearing,bearing,k)),this.style.animationLoop.set(300),this._move(!0,bearing!==startBearing),1===t&&(this.zooming=!1,this.rotating=!1,this.fire("moveend"))},duration,this),this},_updateEasing:function(duration,zoom,bezier){var easing;if(this.ease){var ease=this.ease,t=(Date.now()-ease.start)/ease.duration,speed=ease.easing(t+.01)-ease.easing(t),x=.27/Math.sqrt(speed*speed+1e-4)*.01,y=Math.sqrt(.0729-x*x);easing=util.bezier(x,y,.25,1)}else easing=bezier?util.bezier.apply(util,bezier):util.ease;return this.ease={start:(new Date).getTime(),to:Math.pow(2,zoom),duration:duration,easing:easing},easing}})},{"../geo/latlng.js":16,"../geo/latlngbounds.js":17,"../util/browser.js":76,"../util/util.js":86,"point-geometry":97}],70:[function(require,module){"use strict";function Handlers(map){var rotateEnd,inertiaLinearity=.2,inertiaEasing=util.bezier(0,0,inertiaLinearity,1);this.interaction=new Interaction(map.container).on("click",function(e){map.fire("click",e)}).on("hover",function(e){map.fire("hover",e)}).on("down",function(){map.fire("movestart")}).on("resize",function(){map.stop(),map.resize(),map.update()}).on("pan",function(e){map.stop(),map.transform.panBy(e.offset),map._move()}).on("panend",function(e){if(e.inertia){var velocity=e.inertia.mult(1e3*inertiaLinearity),speed=velocity.mag(),maxSpeed=4e3;speed>=maxSpeed&&(speed=maxSpeed,velocity._unit()._mult(maxSpeed));var deceleration=8e3,duration=speed/(deceleration*inertiaLinearity),offset=velocity.mult(-duration/2).round();map.panBy(offset,{duration:1e3*duration,easing:inertiaEasing,noMoveStart:!0})}else map.fire("moveend")}).on("zoom",function(e){var scale=2/(1+Math.exp(-Math.abs(e.delta/100)));e.delta<0&&0!==scale&&(scale=1/scale);var fromScale=map.ease&&isFinite(e.delta)?map.ease.to:map.transform.scale,duration=isFinite(e.delta)?"trackpad"==e.source?0:300:800;map.zoomTo(map.transform.scaleZoom(fromScale*scale),{duration:duration,offset:e.point.sub(map.transform.centerPoint)})}).on("rotate",function(e){var center=map.transform.centerPoint,startToCenter=e.start.sub(center),startToCenterDist=startToCenter.mag();200>startToCenterDist&&(center=e.start.add(new Point(-200,0)._rotate(startToCenter.angle())));var bearingDiff=e.prev.sub(center).angleWith(e.current.sub(center))/Math.PI*180;map.transform.bearing=map.getBearing()-bearingDiff,map._move(!1,!0),window.clearTimeout(rotateEnd),rotateEnd=window.setTimeout(function(){map.rotating=!1,map._rerender()},200)})}var Interaction=require("./interaction.js"),Point=require("point-geometry"),util=require("../util/util.js");module.exports=Handlers},{"../util/util.js":86,"./interaction.js":72,"point-geometry":97}],71:[function(require,module){"use strict";function Hash(map){this.map=map,window.addEventListener("hashchange",this.onhash.bind(this),!1),map.on("move",util.debounce(this.updateHash.bind(this),100))}module.exports=Hash;var util=require("../util/util.js");Hash.prototype={onhash:function(){var loc=location.hash.replace("#","").split("/");return 4===loc.length?(this.map.setView([+loc[1],+loc[2]],+loc[0],+loc[3]),!0):!1},updateHash:function(){var center=this.map.getCenter(),hash="#"+this.map.getZoom().toFixed(2)+"/"+center.lat.toFixed(6)+"/"+center.lng.toFixed(6)+"/"+this.map.getBearing().toFixed(1);window.history.replaceState("","",hash)}}},{"../util/util.js":86}],72:[function(require,module){"use strict";function Interaction(el){function mousePos(e){var rect=el.getBoundingClientRect();return new Point(e.clientX-rect.left-el.clientLeft,e.clientY-rect.top-el.clientTop)}function zoom(type,delta,point){interaction.fire("zoom",{source:type,delta:delta,point:point}),inertia=null,now=null}function click(point){interaction.fire("click",{point:point})}function hover(point){interaction.fire("hover",{point:point})}function pan(point){if(pos){var offset=pos.sub(point);if(interaction.fire("pan",{offset:offset}),inertia){var duration=Date.now()-now;if(duration){var time=duration+now;for(inertia.push([time,point]);inertia.length>2&&time-inertia[0][0]>100;)inertia.shift()}}else inertia=[];now=Date.now(),pos=point}}function resize(){interaction.fire("resize")}function rotate(point){pos&&(interaction.fire("rotate",{start:firstPos,prev:pos,current:point}),pos=point)}function onmousedown(ev){firstPos=pos=mousePos(ev),interaction.fire("down")}function onmouseup(){if(panned=pos&&firstPos&&(pos.x!=firstPos.x||pos.y!=firstPos.y),rotating=!1,pos=null,inertia&&inertia.length>=2&&now>Date.now()-100){var last=inertia[inertia.length-1],first=inertia[0],velocity=last[1].sub(first[1]).div(last[0]-first[0]);interaction.fire("panend",{inertia:velocity})}else interaction.fire("panend");inertia=null,now=null}function onmousemove(ev){var point=mousePos(ev);if(rotating)rotate(point);else if(pos)pan(point);else{for(var target=ev.toElement;target&&target!=el&&target.parentNode;)target=target.parentNode;target==el&&hover(point)}}function onclick(ev){panned||click(mousePos(ev))}function ondoubleclick(ev){zoom("wheel",1/0*(ev.shiftKey?-1:1),mousePos(ev)),ev.preventDefault()}function scrollwheel(callback){function scroll(value,ev){var stamp=time.now(),timeDelta=stamp-lastEvent;lastEvent=stamp;var point=mousePos(ev);0!==value&&value%4.000244140625===0?type="wheel":0!==value&&Math.abs(value)<4?type="trackpad":timeDelta>400?(type=null,initialValue=value,typeTimeout=setTimeout(function(){type="wheel",callback(type,-initialValue,point)},40)):null===type&&(type=Math.abs(timeDelta*value)<200?"trackpad":"wheel",typeTimeout&&(clearTimeout(typeTimeout),typeTimeout=null,value+=initialValue)),null!==type&&callback(type,-value,point)}function wheel(e){var deltaY=e.deltaY;firefox&&e.deltaMode==window.WheelEvent.DOM_DELTA_PIXEL&&(deltaY/=browser.devicePixelRatio),e.deltaMode==window.WheelEvent.DOM_DELTA_LINE&&(deltaY*=40),scroll(deltaY,e),e.preventDefault()}function mousewheel(e){var deltaY=-e.wheelDeltaY;safari&&(deltaY/=3),scroll(deltaY,e),e.preventDefault()}var firefox=/Firefox/i.test(navigator.userAgent),safari=/Safari/i.test(navigator.userAgent)&&!/Chrom(ium|e)/i.test(navigator.userAgent),time=window.performance||Date;el.addEventListener("wheel",wheel,!1),el.addEventListener("mousewheel",mousewheel,!1);var lastEvent=0,type=null,typeTimeout=null,initialValue=null}var interaction=this;if(el){var now,rotating=!1,panned=!1,firstPos=null,pos=null,inertia=null;el.addEventListener("contextmenu",function(ev){rotating=!0,firstPos=pos=mousePos(ev),ev.preventDefault()},!1),el.addEventListener("mousedown",onmousedown,!1),document.addEventListener("mouseup",onmouseup,!1),document.addEventListener("mousemove",onmousemove,!1),el.addEventListener("click",onclick,!1),scrollwheel(zoom),el.addEventListener("dblclick",ondoubleclick,!1),window.addEventListener("resize",resize,!1)}}var Evented=require("../util/evented.js"),browser=require("../util/browser.js"),Point=require("point-geometry");module.exports=Interaction,Interaction.prototype=Object.create(Evented)},{"../util/browser.js":76,"../util/evented.js":81,"point-geometry":97}],73:[function(require,module){"use strict";var Dispatcher=require("../util/dispatcher.js"),Canvas=require("../util/canvas.js"),util=require("../util/util.js"),browser=require("../util/browser.js"),ajax=require("../util/ajax.js"),Evented=require("../util/evented.js"),Style=require("../style/style.js"),AnimationLoop=require("../style/animationloop.js"),GLPainter=require("../render/painter.js"),Transform=require("../geo/transform.js"),Hash=require("./hash.js"),Handlers=require("./handlers.js"),Source=require("../source/source.js"),Easings=require("./easings.js"),LatLng=require("../geo/latlng.js"),LatLngBounds=require("../geo/latlngbounds.js"),Point=require("point-geometry"),GlyphSource=require("../symbol/glyphsource.js"),Attribution=require("./control/attribution.js"),Map=module.exports=function(options){if(options=this.options=util.inherit(this.options,options),this.animationLoop=new AnimationLoop,this.transform=new Transform(options.minZoom,options.maxZoom),this.hash=options.hash&&new Hash(this),options.maxBounds){var b=LatLngBounds.convert(options.maxBounds);this.transform.latRange=[b.getSouth(),b.getNorth()],this.transform.lngRange=[b.getWest(),b.getEast()]}this._onStyleChange=this._onStyleChange.bind(this),this._updateBuckets=this._updateBuckets.bind(this),this.render=this.render.bind(this),this._setupContainer(),this._setupPainter(),this.handlers=options.interactive&&new Handlers(this),this.dispatcher=new Dispatcher(options.numWorkers,this),this.hash&&this.hash.onhash()||this.setView(options.center,options.zoom,options.bearing),this.sources={},this.stacks={},this.resize(),"object"==typeof options.style?this.setStyle(options.style):"string"==typeof options.style&&ajax.getJSON(options.style,function(err,data){if(err)throw err;this.setStyle(data)}.bind(this)),options.attributionControl&&this.addControl(new Attribution)};util.extend(Map.prototype,Evented),util.extend(Map.prototype,Easings),util.extend(Map.prototype,{options:{center:[0,0],zoom:0,bearing:0,minZoom:0,maxZoom:20,numWorkers:browser.hardwareConcurrency-1,interactive:!0,hash:!1,attributionControl:!0},addSource:function(id,source){return this.sources[id]=source,source.id=id,source.onAdd&&source.onAdd(this),source.enabled&&source.fire("source.add",{source:source}),this},removeSource:function(id){var source=this.sources[id];return source.onRemove&&source.onRemove(this),delete this.sources[id],this.fire("source.remove",{source:source})},addControl:function(control){return control.addTo(this),this},setView:function(center,zoom,bearing){this.stop();var tr=this.transform,zoomChanged=tr.zoom!==+zoom,bearingChanged=tr.bearing!==+bearing;return tr.center=LatLng.convert(center),tr.zoom=+zoom,tr.bearing=+bearing,this.fire("movestart")._move(zoomChanged,bearingChanged).fire("moveend")},setCenter:function(center){return this.stop(),this.transform.center=LatLng.convert(center),this.fire("movestart")._move(!1,!1).fire("moveend")},setZoom:function(zoom){return this.stop(),this.transform.zoom=+zoom,this.fire("movestart")._move(!0,!1).fire("moveend")},setBearing:function(bearing,offset){return this.stop(),this.transform.rotate(+bearing,Point.convert(offset)),this.fire("movestart")._move(!1,!0).fire("moveend")},getCenter:function(){return this.transform.center},getZoom:function(){return this.transform.zoom},getBearing:function(){return this.transform.bearing},resize:function(){var width=0,height=0;return this.container&&(width=this.container.offsetWidth||400,height=this.container.offsetHeight||300),this.canvas.resize(width,height),this.transform.width=width,this.transform.height=height,this.transform._constrain(),this.style&&this.style.sprite&&this.style.sprite.resize(this.painter.gl),this.painter.resize(width,height),this.fire("movestart")._move().fire("resize").fire("moveend")},getBounds:function(){return new LatLngBounds(this.transform.pointLocation(new Point(0,0)),this.transform.pointLocation(this.transform.size))
},project:function(latlng){return this.transform.locationPoint(latlng)},unproject:function(point){return this.transform.pointLocation(point)},featuresAt:function(point,params,callback){var features=[],error=null,map=this;return point=Point.convert(point),util.asyncEach(Object.keys(this.sources),function(id,callback){var source=map.sources[id];source.featuresAt(point,params,function(err,result){result&&(features=features.concat(result)),err&&(error=err),callback()})},function(){callback(error,features)}),this},setStyle:function(style){this.style&&this.style.off("change",this._onStyleChange),this.style=style instanceof Style?style:new Style(style,this.animationLoop);var sources=this.style.stylesheet.sources;for(var id in sources)this.addSource(id,Source.create(sources[id]));return this.glyphSource=new GlyphSource(this.style.stylesheet.glyphs,this.painter.glyphAtlas),this.style.on("change",this._onStyleChange),this._styleDirty=!0,this._tilesDirty=!0,this._updateBuckets(),this._updateGlyphs(),this.fire("style.change"),this},_move:function(zoom,rotate){return this.update(zoom).fire("move"),zoom&&this.fire("zoom"),rotate&&this.fire("rotate"),this},_setupContainer:function(){var id=this.options.container,container=this.container="string"==typeof id?document.getElementById(id):id;container&&container.classList.add("mapboxgl-map"),this.canvas=new Canvas(this,container)},_setupPainter:function(){var gl=this.canvas.getWebGLContext();return gl?void(this.painter=new GLPainter(gl,this.transform)):void alert("Failed to initialize WebGL")},_contextLost:function(event){event.preventDefault(),this._frameId&&browser.cancelFrame(this._frameId)},_contextRestored:function(){this._setupPainter(),this.resize(),this.update()},"debug message":function(data){console.log.apply(console,data)},"alert message":function(data){alert.apply(window,data)},"get sprite json":function(params,callback){var sprite=this.style.sprite;callback(null,sprite&&{sprite:sprite.data,retina:sprite.retina})},"get glyphs":function(params,callback){this.glyphSource.getRects(params.fontstack,params.codepoints,params.id,callback)},update:function(updateStyle){return this.style?(this._styleDirty=this._styleDirty||updateStyle,this._tilesDirty=!0,this._rerender(),this):this},render:function(){if(this._styleDirty&&(this._styleDirty=!1,this._updateStyle()),this._tilesDirty){for(var id in this.sources)this.sources[id].update();this._tilesDirty=!1}return this._renderGroups(this.style.layerGroups),this.fire("render"),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._repaint||!this.animationLoop.stopped())&&this._rerender(),this},_renderGroups:function(groups,name){var i,len,group,source,k;for(i=0,len=groups.length;len>i;i++){group=groups[i];for(k in group.dependencies)this._renderGroups(group.dependencies[k],k)}for(this.painter.bindRenderTexture(name),i=0,len=groups.length;len>i;i++)group=groups[i],source=this.sources[group.source],source?(this.painter.clearStencil(),source.render(group)):group.composited?this.painter.draw(void 0,this.style,group,{}):void 0===group.source&&this.painter.draw(void 0,this.style,group,{background:!0})},_rerender:function(){this._frameId||(this._frameId=browser.frame(this.render))},_onStyleChange:function(){this.update(!0)},_updateStyle:function(){this.style&&this.style.recalculate(this.transform.zoom)},_updateGlyphs:function(){this.dispatcher.broadcast("set glyphs",this.style.stylesheet.glyphs)},_updateBuckets:function(){this.dispatcher.broadcast("set buckets",this.style.orderedBuckets);for(var s in this.sources)this.sources[s].load();this.update()}}),util.extendAll(Map.prototype,{_debug:!1,get debug(){return this._debug},set debug(value){this._debug=value,this._rerender()},_repaint:!1,get repaint(){return this._repaint},set repaint(value){this._repaint=value,this._rerender()},_antialiasing:!0,get antialiasing(){return this._antialiasing},set antialiasing(value){this._antialiasing=value,this._rerender()},_vertices:!1,get vertices(){return this._vertices},set vertices(value){this._vertices=value,this._rerender()},_loadNewTiles:!0,get loadNewTiles(){return this._loadNewTiles},set loadNewTiles(value){this._loadNewTiles=value,this.update()}})},{"../geo/latlng.js":16,"../geo/latlngbounds.js":17,"../geo/transform.js":18,"../render/painter.js":32,"../source/source.js":39,"../style/animationloop.js":47,"../style/style.js":52,"../symbol/glyphsource.js":60,"../util/ajax.js":75,"../util/browser.js":76,"../util/canvas.js":77,"../util/dispatcher.js":78,"../util/evented.js":81,"../util/util.js":86,"./control/attribution.js":66,"./easings.js":69,"./handlers.js":70,"./hash.js":71,"point-geometry":97}],74:[function(require,module){"use strict";function Actor(target,parent){this.target=target,this.parent=parent,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)}module.exports=Actor,Actor.prototype.receive=function(message){var callback,data=message.data;if("<response>"==data.type)callback=this.callbacks[data.id],delete this.callbacks[data.id],callback(data.error||null,data.data);else if("undefined"!=typeof data.id){var id=data.id;this.parent[data.type](data.data,function(err,data,buffers){message.target.postMessage({type:"<response>",id:String(id),error:err?String(err):null,data:data},buffers)})}else this.parent[data.type](data.data)},Actor.prototype.send=function(type,data,callback,buffers){var id=null;callback&&(this.callbacks[id=this.callbackID++]=callback),this.target.postMessage({type:type,id:String(id),data:data},buffers)}},{}],75:[function(require,module,exports){"use strict";function getImageData(img){var canvas=document.createElement("canvas"),context=canvas.getContext("2d");return canvas.width=img.width,canvas.height=img.height,context.drawImage(img,0,0),context.getImageData(0,0,img.width,img.height).data}exports.getJSON=function(url,callback){var xhr=new XMLHttpRequest;return xhr.open("GET",url,!0),xhr.onload=function(){if(xhr.status>=200&&xhr.status<300&&xhr.response){var data;try{data=JSON.parse(xhr.response)}catch(err){return callback(err)}callback(null,data)}else callback(new Error(xhr.statusText))},xhr.send(),xhr},exports.getArrayBuffer=function(url,callback){var xhr=new XMLHttpRequest;return xhr.open("GET",url,!0),xhr.responseType="arraybuffer",xhr.onload=function(){xhr.status>=200&&xhr.status<300&&xhr.response?callback(null,xhr.response):callback(new Error(xhr.statusText))},xhr.send(),xhr},exports.getImage=function(url,callback){var img=new Image;return img.crossOrigin="Anonymous",img.onload=function(){callback(null,img)},img.src=url,img.getData=function(){return getImageData(this)},img}},{}],76:[function(require,module,exports){"use strict";var frameName=function(){return window.requestAnimationFrame?"requestAnimationFrame":window.mozRequestAnimationFrame?"mozRequestAnimationFrame":window.webkitRequestAnimationFrame?"webkitRequestAnimationFrame":window.msRequestAnimationFrame?"msRequestAnimationFrame":void 0}();exports.frame=function(fn){return window[frameName](fn)},exports.cancelFrame=function(id){(window.cancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame)(id)},exports.timed=function(fn,dur,ctx){function tick(now){abort||(window.performance||(now=Date.now()),now>start+dur?fn.call(ctx,1):(fn.call(ctx,(now-start)/dur),exports.frame(tick)))}if(!dur)return fn.call(ctx,1);var abort=!1,start=window.performance?window.performance.now():Date.now();return exports.frame(tick),function(){abort=!0}},exports.supported=function(){for(var supports=([function(){return"undefined"!=typeof window},function(){return"undefined"!=typeof document},function(){return!!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)},function(){return!(!Function.prototype||!Function.prototype.bind),!!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)},function(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON},function(){var canvas=document.createElement("canvas");return"supportsContext"in canvas?canvas.supportsContext("webgl")||canvas.supportsContext("experimental-webgl"):!!window.WebGLRenderingContext},function(){return"Worker"in window}]),i=0;i<supports.length;i++)if(!supports[i]())return!1;return!0},exports.hardwareConcurrency=navigator.hardwareConcurrency||8,Object.defineProperty(exports,"devicePixelRatio",{get:function(){return window.devicePixelRatio}})},{}],77:[function(require,module){"use strict";function Canvas(parent,container){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.classList.add("mapboxgl-canvas"),this.canvas.addEventListener("webglcontextlost",parent._contextLost.bind(parent),!1),this.canvas.addEventListener("webglcontextrestored",parent._contextRestored.bind(parent),!1),container.appendChild(this.canvas)}module.exports=Canvas,Canvas.prototype.resize=function(width,height){var pixelRatio=window.devicePixelRatio||1;this.canvas.width=pixelRatio*width,this.canvas.height=pixelRatio*height,this.canvas.style.width=width+"px",this.canvas.style.height=height+"px"},Canvas.prototype.getWebGLContext=function(){return this.canvas.getContext("experimental-webgl",{antialias:!1,alpha:!0,stencil:!0,depth:!1})}},{}],78:[function(require,module){"use strict";function Dispatcher(length,parent){this.actors=[],this.currentActor=0;var url,blob,i;for(i=0;length>i;i++){absolute?(blob=new Blob(['importScripts("'+workerFile+'");'],{type:"application/javascript"}),url=window.URL.createObjectURL(blob)):url=workerFile;var worker=new Worker(url),actor=new Actor(worker,parent);actor.name="Worker "+i,this.actors.push(actor)}}var Actor=require("../actor.js"),scripts=document.getElementsByTagName("script"),workerFile=scripts[scripts.length-1].getAttribute("src"),absolute=-1!==workerFile.indexOf("http");module.exports=Dispatcher,Dispatcher.prototype.broadcast=function(type,data){for(var i=0;i<this.actors.length;i++)this.actors[i].send(type,data)},Dispatcher.prototype.send=function(type,data,callback,targetID,buffers){return("number"!=typeof targetID||isNaN(targetID))&&(targetID=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[targetID].send(type,data,callback,buffers),targetID}},{"../actor.js":74}],79:[function(require,module){"use strict";module.exports={HTTP_URL:"http://a.tiles.mapbox.com/v4",HTTPS_URL:"https://a.tiles.mapbox.com/v4",FORCE_HTTPS:!1,REQUIRE_ACCESS_TOKEN:!0}},{}],80:[function(require,module,exports){"use strict";function preventDefault(e){e.preventDefault()}exports.create=function(tagName,className,container){var el=document.createElement(tagName);return className&&(el.className=className),container&&container.appendChild(el),el};var userSelect,docEl="undefined"!=typeof document?document.documentElement:{},selectProp="userSelect"in docEl?"userSelect":"MozUserSelect"in docEl?"MozUserSelect":"WebkitUserSelect"in docEl?"WebkitUserSelect":null;exports.disableDrag=function(){window.addEventListener("dragstart",preventDefault),"onselectstart"in document?window.addEventListener("selectstart",preventDefault):selectProp&&(userSelect=docEl.style[selectProp],docEl.style[selectProp]="none")},exports.enableDrag=function(){window.removeEventListener("dragstart",preventDefault),"onselectstart"in document?window.removeEventListener("selectstart",preventDefault):selectProp&&(docEl.style[selectProp]=userSelect)}},{}],81:[function(require,module){"use strict";var util=require("./util.js");module.exports={on:function(type,fn){return this._events=this._events||{},this._events[type]=this._events[type]||[],this._events[type].push(fn),this},off:function(type,fn){if(!type)return delete this._events,this;if(!this.listens(type))return this;if(fn){var idx=this._events[type].indexOf(fn);idx>=0&&this._events[type].splice(idx,1),this._events[type].length||delete this._events[type]}else delete this._events[type];return this},fire:function(type,data){if(!this.listens(type))return this;data=util.extend({},data),util.extend(data,{type:type,target:this});for(var listeners=this._events[type].slice(),i=0;i<listeners.length;i++)listeners[i].call(this,data);return this},listens:function(type){return!(!this._events||!this._events[type])}}},{"./util.js":86}],82:[function(require,module){"use strict";function Glyphs(buffer,end){this.stacks={},this._buffer=buffer;var val,tag;for("undefined"==typeof end&&(end=buffer.length);buffer.pos<end;)if(val=buffer.readVarint(),tag=val>>3,1==tag){var fontstack=this.readFontstack();this.stacks[fontstack.name]=fontstack}else buffer.skip(val)}module.exports=Glyphs,Glyphs.prototype.readFontstack=function(){for(var val,tag,buffer=this._buffer,fontstack={glyphs:{}},bytes=buffer.readVarint(),end=buffer.pos+bytes;buffer.pos<end;)if(val=buffer.readVarint(),tag=val>>3,1==tag)fontstack.name=buffer.readString();else if(2==tag){var range=buffer.readString();fontstack.range=range}else if(3==tag){var glyph=this.readGlyph();fontstack.glyphs[glyph.id]=glyph}else buffer.skip(val);return fontstack},Glyphs.prototype.readGlyph=function(){for(var val,tag,buffer=this._buffer,glyph={},bytes=buffer.readVarint(),end=buffer.pos+bytes;buffer.pos<end;)val=buffer.readVarint(),tag=val>>3,1==tag?glyph.id=buffer.readVarint():2==tag?glyph.bitmap=buffer.readBuffer():3==tag?glyph.width=buffer.readVarint():4==tag?glyph.height=buffer.readVarint():5==tag?glyph.left=buffer.readSVarint():6==tag?glyph.top=buffer.readSVarint():7==tag?glyph.advance=buffer.readVarint():buffer.skip(val);return glyph}},{}],83:[function(require,module){"use strict";function MRUCache(length,onRemove){this.max=length,this.onRemove=onRemove,this.reset()}module.exports=MRUCache,MRUCache.prototype.reset=function(){return this.list={},this.order=[],this},MRUCache.prototype.add=function(key,data){if(this.list[key]=data,this.order.push(key),this.order.length>this.max){var removedData=this.get(this.order[0]);removedData&&this.onRemove(removedData)}return this},MRUCache.prototype.has=function(key){return key in this.list},MRUCache.prototype.keys=function(){return this.order},MRUCache.prototype.get=function(key){if(!this.has(key))return null;var data=this.list[key];return delete this.list[key],this.order.splice(this.order.indexOf(key),1),data}},{}],84:[function(require,module){"use strict";function resolveTokens(properties,expression){for(var match,value,text=expression;match=text.match(tokenPattern);)value="undefined"==typeof properties[match[1]]?"":properties[match[1]],text=text.replace(match[0],value);return text}module.exports=resolveTokens;var tokenPattern=/{([\w-]+)}/},{}],85:[function(require,module){"use strict";var config=require("./config");module.exports=function(path,accessToken){if(accessToken=accessToken||config.ACCESS_TOKEN,!accessToken&&config.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox GL. See https://www.mapbox.com/developers/api/#access-tokens");var url="undefined"!=typeof document&&"https:"===document.location.protocol||config.FORCE_HTTPS?config.HTTPS_URL:config.HTTP_URL;if(url+=path,url+=-1!==url.indexOf("?")?"&access_token=":"?access_token=",config.REQUIRE_ACCESS_TOKEN){if("s"===accessToken[0])throw new Error("Use a public access token (pk.*) with Mapbox GL JS, not a secret access token (sk.*). See https://www.mapbox.com/developers/api/#access-tokens");url+=accessToken}return url},module.exports.tileJSON=function(mapID,accessToken){var url=module.exports("/"+mapID+".json",accessToken);return 0===url.indexOf("https")&&(url+="&secure"),url}},{"./config":79}],86:[function(require,module,exports){"use strict";var UnitBezier=require("unitbezier");exports.easeCubicInOut=function(t){if(0>=t)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(.5>t?t3:3*(t-t2)+t3-.75)},exports.bezier=function(p1x,p1y,p2x,p2y){var bezier=new UnitBezier(p1x,p1y,p2x,p2y);return function(t){return bezier.solve(t)}},exports.ease=exports.bezier(.25,.1,.25,1),exports.interp=function(a,b,t){return a*(1-t)+b*t},exports.premultiply=function(c){return c[0]*=c[3],c[1]*=c[3],c[2]*=c[3],c},exports.asyncEach=function(array,fn,callback){function check(){0===--remaining&&callback()}var remaining=array.length;if(0===remaining)return callback();for(var i=0;i<array.length;i++)fn(array[i],check)},exports.keysDifference=function(obj,other){var difference=[];for(var i in obj)i in other||difference.push(i);return difference},exports.extend=function(dest,src){for(var i in src)dest[i]=src[i];return dest},exports.extendAll=function(dest,src){for(var i in src)Object.defineProperty(dest,i,Object.getOwnPropertyDescriptor(src,i));return dest},exports.inherit=function(parent,props){var parentProto="function"==typeof parent?parent.prototype:parent,proto=Object.create(parentProto);return exports.extendAll(proto,props),proto};var id=1;exports.uniqueId=function(){return id++},exports.throttle=function(fn,time,context){var lock,args,wrapperFn,later;return later=function(){lock=!1,args&&(wrapperFn.apply(context,args),args=!1)},wrapperFn=function(){lock?args=arguments:(fn.apply(context,arguments),setTimeout(later,time),lock=!0)}},exports.debounce=function(fn,time){var timer,args;return function(){args=arguments,clearTimeout(timer),timer=setTimeout(function(){fn.apply(null,args)},time)}}},{unitbezier:100}],87:[function(require,module,exports){function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var length,type=typeof subject;if("number"===type)length=subject>0?subject>>>0:0;else if("string"===type)"base64"===encoding&&(subject=base64clean(subject)),length=Buffer.byteLength(subject,encoding);else{if("object"!==type||null===subject)throw new Error("First argument needs to be a number, array or string.");"Buffer"===subject.type&&isArray(subject.data)&&(subject=subject.data),length=+subject.length>0?Math.floor(+subject.length):0}var buf;TYPED_ARRAY_SUPPORT?buf=Buffer._augment(new Uint8Array(length)):(buf=this,buf.length=length,buf._isBuffer=!0);var i;if(TYPED_ARRAY_SUPPORT&&"number"==typeof subject.byteLength)buf._set(subject);else if(isArrayish(subject))if(Buffer.isBuffer(subject))for(i=0;length>i;i++)buf[i]=subject.readUInt8(i);else for(i=0;length>i;i++)buf[i]=(subject[i]%256+256)%256;else if("string"===type)buf.write(subject,0,encoding);else if("number"===type&&!TYPED_ARRAY_SUPPORT&&!noZero)for(i=0;length>i;i++)buf[i]=0;return buf}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;assert(strLen%2===0,"Invalid hex string"),length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var byte=parseInt(string.substr(2*i,2),16);assert(!isNaN(byte),"Invalid hex string"),buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length);return charsWritten}function base64Slice(buf,start,end){return base64.fromByteArray(0===start&&end===buf.length?buf:buf.slice(start,end))}function utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function binarySlice(buf,start,end){return asciiSlice(buf,start,end)}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function readUInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(val=buf[offset],len>offset+1&&(val|=buf[offset+1]<<8)):(val=buf[offset]<<8,len>offset+1&&(val|=buf[offset+1])),val}}function readUInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(len>offset+2&&(val=buf[offset+2]<<16),len>offset+1&&(val|=buf[offset+1]<<8),val|=buf[offset],len>offset+3&&(val+=buf[offset+3]<<24>>>0)):(len>offset+1&&(val=buf[offset+1]<<16),len>offset+2&&(val|=buf[offset+2]<<8),len>offset+3&&(val|=buf[offset+3]),val+=buf[offset]<<24>>>0),val}}function readInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=readUInt16(buf,offset,littleEndian,!0),neg=32768&val;return neg?-1*(65535-val+1):val}}function readInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=readUInt32(buf,offset,littleEndian,!0),neg=2147483648&val;return neg?-1*(4294967295-val+1):val}}function readFloat(buf,offset,littleEndian,noAssert){return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+3<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,23,4)}function readDouble(buf,offset,littleEndian,noAssert){return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+7<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,52,8)}function writeUInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"trying to write beyond buffer length"),verifuint(value,65535));var len=buf.length;if(!(offset>=len)){for(var i=0,j=Math.min(len-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i);return offset+2}}function writeUInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"trying to write beyond buffer length"),verifuint(value,4294967295));var len=buf.length;if(!(offset>=len)){for(var i=0,j=Math.min(len-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255;return offset+4}}function writeInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to write beyond buffer length"),verifsint(value,32767,-32768));var len=buf.length;if(!(offset>=len))return value>=0?writeUInt16(buf,value,offset,littleEndian,noAssert):writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert),offset+2}function writeInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifsint(value,2147483647,-2147483648));var len=buf.length;if(!(offset>=len))return value>=0?writeUInt32(buf,value,offset,littleEndian,noAssert):writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert),offset+4}function writeFloat(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38));var len=buf.length;if(!(offset>=len))return ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+7<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308));var len=buf.length;if(!(offset>=len))return ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){for(str=stringtrim(str).replace(INVALID_BASE64_RE,"");str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function isArray(subject){return(Array.isArray||function(subject){return"[object Array]"===Object.prototype.toString.call(subject)})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&"object"==typeof subject&&"number"==typeof subject.length}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(str){for(var byteArray=[],i=0;i<str.length;i++){var b=str.charCodeAt(i);if(127>=b)byteArray.push(b);else{var start=i;b>=55296&&57343>=b&&i++;for(var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%"),j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str){for(var c,hi,lo,byteArray=[],i=0;i<str.length;i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert("number"==typeof value,"cannot write a non-number as a number"),assert(value>=0,"specified a negative value for writing an unsigned value"),assert(max>=value,"value is larger than maximum value for type"),assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value"),assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0),arr=new Uint8Array(buf);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(e){return!1}}();Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.byteLength=function(str,encoding){var ret;switch(str=str.toString(),encoding||"utf8"){case"hex":ret=str.length/2;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"ascii":case"binary":case"raw":ret=str.length;break;case"base64":ret=base64ToBytes(str).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=2*str.length;break;default:throw new Error("Unknown encoding")}return ret},Buffer.concat=function(list,totalLength){if(assert(isArray(list),"Usage: Buffer.concat(list[, length])"),0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if(void 0===totalLength)for(totalLength=0,i=0;i<list.length;i++)totalLength+=list[i].length;var buf=new Buffer(totalLength),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.compare=function(a,b){assert(Buffer.isBuffer(a)&&Buffer.isBuffer(b),"Arguments must be Buffers");for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];i++);return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset))isFinite(length)||(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=length,length=swap}offset=Number(offset)||0;var remaining=this.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining,encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toString=function(encoding,start,end){var self=this;if(encoding=String(encoding||"utf8").toLowerCase(),start=Number(start)||0,end=void 0===end?self.length:Number(end),end===start)return"";var ret;switch(encoding){case"hex":ret=hexSlice(self,start,end);break;case"utf8":case"utf-8":ret=utf8Slice(self,start,end);break;case"ascii":ret=asciiSlice(self,start,end);break;case"binary":ret=binarySlice(self,start,end);break;case"base64":ret=base64Slice(self,start,end);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leSlice(self,start,end);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.equals=function(b){return assert(Buffer.isBuffer(b),"Argument must be a Buffer"),0===Buffer.compare(this,b)},Buffer.prototype.compare=function(b){return assert(Buffer.isBuffer(b),"Argument must be a Buffer"),Buffer.compare(this,b)
},Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(start||(start=0),end||0===end||(end=this.length),target_start||(target_start=0),end!==start&&0!==target.length&&0!==source.length){assert(end>=start,"sourceEnd < sourceStart"),assert(target_start>=0&&target_start<target.length,"targetStart out of bounds"),assert(start>=0&&start<source.length,"sourceStart out of bounds"),assert(end>=0&&end<=source.length,"sourceEnd out of bounds"),end>this.length&&(end=this.length),target.length-target_start<end-start&&(end=target.length-target_start+start);var len=end-start;if(100>len||!TYPED_ARRAY_SUPPORT)for(var i=0;len>i;i++)target[i+target_start]=this[i+start];else target._set(this.subarray(start,start+len),target_start)}},Buffer.prototype.slice=function(start,end){var len=this.length;if(start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start),TYPED_ARRAY_SUPPORT)return Buffer._augment(this.subarray(start,end));for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0,!0),i=0;sliceLen>i;i++)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.get=function(offset){return this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return this.writeUInt8(v,offset)},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),offset>=this.length?void 0:this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,!0,noAssert)},Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,!1,noAssert)},Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,!0,noAssert)},Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,!1,noAssert)},Buffer.prototype.readInt8=function(offset,noAssert){if(noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),!(offset>=this.length)){var neg=128&this[offset];return neg?-1*(255-this[offset]+1):this[offset]}},Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,!0,noAssert)},Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,!1,noAssert)},Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,!0,noAssert)},Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,!1,noAssert)},Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,!0,noAssert)},Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,!1,noAssert)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,!0,noAssert)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,!1,noAssert)},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"trying to write beyond buffer length"),verifuint(value,255)),offset>=this.length?void 0:(this[offset]=value,offset+1)},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return writeUInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return writeUInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return writeUInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return writeUInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt8=function(value,offset,noAssert){return noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to write beyond buffer length"),verifsint(value,127,-128)),offset>=this.length?void 0:(value>=0?this.writeUInt8(value,offset,noAssert):this.writeUInt8(255+value+1,offset,noAssert),offset+1)},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return writeInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return writeInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return writeInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return writeInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),assert(end>=start,"end < start"),end!==start&&0!==this.length){assert(start>=0&&start<this.length,"start out of bounds"),assert(end>=0&&end<=this.length,"end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.inspect=function(){for(var out=[],len=this.length,i=0;len>i;i++)if(out[i]=toHex(this[i]),i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}return"<Buffer "+out.join(" ")+">"},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr._isBuffer=!0,arr._get=arr.get,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g},{"base64-js":88,ieee754:89}],88:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS?62:code===SLASH?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],89:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?0/0:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||1/0===value?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],90:[function(require,module,exports){function clamp_css_byte(i){return i=Math.round(i),0>i?0:i>255?255:i}function clamp_css_float(f){return 0>f?0:f>1?1:f}function parse_css_int(str){return clamp_css_byte("%"===str[str.length-1]?parseFloat(str)/100*255:parseInt(str))}function parse_css_float(str){return clamp_css_float("%"===str[str.length-1]?parseFloat(str)/100:parseFloat(str))}function css_hue_to_rgb(m1,m2,h){return 0>h?h+=1:h>1&&(h-=1),1>6*h?m1+(m2-m1)*h*6:1>2*h?m2:2>3*h?m1+(m2-m1)*(2/3-h)*6:m1}function parseCSSColor(css_str){var str=css_str.replace(/ /g,"").toLowerCase();if(str in kCSSColorTable)return kCSSColorTable[str].slice();if("#"===str[0]){if(4===str.length){var iv=parseInt(str.substr(1),16);return iv>=0&&4095>=iv?[(3840&iv)>>4|(3840&iv)>>8,240&iv|(240&iv)>>4,15&iv|(15&iv)<<4,1]:null}if(7===str.length){var iv=parseInt(str.substr(1),16);return iv>=0&&16777215>=iv?[(16711680&iv)>>16,(65280&iv)>>8,255&iv,1]:null}return null}var op=str.indexOf("("),ep=str.indexOf(")");if(-1!==op&&ep+1===str.length){var fname=str.substr(0,op),params=str.substr(op+1,ep-(op+1)).split(","),alpha=1;switch(fname){case"rgba":if(4!==params.length)return null;alpha=parse_css_float(params.pop());case"rgb":return 3!==params.length?null:[parse_css_int(params[0]),parse_css_int(params[1]),parse_css_int(params[2]),alpha];case"hsla":if(4!==params.length)return null;alpha=parse_css_float(params.pop());case"hsl":if(3!==params.length)return null;var h=(parseFloat(params[0])%360+360)%360/360,s=parse_css_float(params[1]),l=parse_css_float(params[2]),m2=.5>=l?l*(s+1):l+s-l*s,m1=2*l-m2;return[clamp_css_byte(255*css_hue_to_rgb(m1,m2,h+1/3)),clamp_css_byte(255*css_hue_to_rgb(m1,m2,h)),clamp_css_byte(255*css_hue_to_rgb(m1,m2,h-1/3)),alpha];default:return null}}return null}var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{exports.parseCSSColor=parseCSSColor}catch(e){}},{}],91:[function(require,module){function rewind(gj,outer){switch(gj&&gj.type||null){case"FeatureCollection":return gj.features=gj.features.map(curryOuter(rewind,outer)),gj;case"Feature":return gj.geometry=rewind(gj.geometry,outer),gj;case"Polygon":case"MultiPolygon":return correct(gj,outer);default:return gj}}function curryOuter(a,b){return function(_){return a(_,b)}}function correct(_,outer){return"Polygon"===_.type?_.coordinates=correctRings(_.coordinates,outer):"MultiPolygon"===_.type&&(_.coordinates=_.coordinates.map(curryOuter(correctRings,outer))),_}function correctRings(_,outer){outer=!!outer,_[0]=wind(_[0],!outer);for(var i=1;i<_.length;i++)_[i]=wind(_[i],outer);return _}function wind(_,dir){return cw(_)===dir?_:_.reverse()}function cw(_){return geojsonArea.ring(_)>=0}var geojsonArea=require("geojson-area");module.exports=rewind},{"geojson-area":92}],92:[function(require,module){function geometry(_){if("Polygon"===_.type)return polygonArea(_.coordinates);if("MultiPolygon"===_.type){for(var area=0,i=0;i<_.coordinates.length;i++)area+=polygonArea(_.coordinates[i]);return area}return null}function polygonArea(coords){var area=0;if(coords&&coords.length>0){area+=Math.abs(ringArea(coords[0]));for(var i=1;i<coords.length;i++)area-=Math.abs(ringArea(coords[i]))}return area}function ringArea(coords){var area=0;if(coords.length>2){for(var p1,p2,i=0;i<coords.length-1;i++)p1=coords[i],p2=coords[i+1],area+=rad(p2[0]-p1[0])*(2+Math.sin(rad(p1[1]))+Math.sin(rad(p2[1])));area=area*wgs84.RADIUS*wgs84.RADIUS/2}return area}function rad(_){return _*Math.PI/180}var wgs84=require("wgs84");module.exports.geometry=geometry,module.exports.ring=ringArea},{wgs84:93}],93:[function(require,module){module.exports.RADIUS=6378137,module.exports.FLATTENING=1/298.257223563,module.exports.POLAR_RADIUS=6356752.3142},{}],94:[function(require,module){module.exports={$version:4,$root:{version:{required:!0,type:"enum",values:[4],doc:"Stylesheet version number. Must be 4."},constants:{type:"constants",doc:"An object of constants to be referenced in layers."},sources:{required:!0,type:"sources",doc:"Data source specifications for layers to pull from."},layers:{required:!0,type:"array",value:"layer",doc:"An array of layers. The order of layers coincides with the order they will be drawn."},sprite:{type:"sprite",doc:"Sprite definition."},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. Valid tokens are {fontstack} and {range}."},transition:{type:"transition",doc:"A global transition definition to use as a default across properties."}},sprite:[{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended."}],constants:{"*":{type:"*",doc:"A constant that will be replaced verbatim in the referencing place. This can be anything, including objects and arrays. All variable names must be prefixed with an `@` symbol."}},sources:{"*":{type:"source"}},source:{type:{required:!0,type:"enum",values:["vector","raster","geojson","video"],doc:"The data type of the source."},url:{required:!0,type:"string",doc:"A URL, or URL template to retrive the source data."},tileSize:{type:"number","default":512,doc:"The minimum visual size (in px) to display tiles for this layer. Only configurable for raster layers."},minZoom:{type:"number","default":0,doc:"Minimum zoom level for which tiles are available."},maxZoom:{type:"number","default":22,doc:"Maximum zoom level for which tiles are available. Data from tiles at the maxZoom are used when displaying the map at higher zoom levels."},"*":{type:"*",doc:"Other keys to configure the data source."}},layer:{id:{type:"string",doc:"Unique layer name."},type:{type:"enum",values:["fill","line","symbol","composite","raster","background"],doc:"Rendering type of this layer."},ref:{type:"string",doc:"References another layer to copy `source`, `source_layer`, `filter`, and `render` properties from. This allows the layers to share processing and be more efficient."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required if this is not a composite layer."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required if this is not a composite layer, and if the source supports multiple layers."},"min-zoom":{type:"number",doc:"The minimum zoom level on which the layer gets parsed and appears on."},"max-zoom":{type:"number",doc:"The maximum zoom level on which the layer gets parsed and appears on."},interactive:{type:"boolean",doc:"Enable querying of feature data from this layer for interactivity.","default":!1},render:{type:"render",doc:"Symbolizer type that should be used to visualize this layer. If unspecified or null, this layer is not treated as a symbolizer and only exists to have properties inherited to other layers using ref."},filter:{type:"filter",doc:"Array or object of filters or expressions."},layers:{type:"array",value:"layer",doc:"If `type` is `composite` or `raster`, the child layers are composited together onto the previous level layer level."},style:{type:"class",doc:"Default style properties for this layer."},"style.*":{type:"class",doc:"Override style properties for this layer. The class name is the part after the first dot."}},render:["render_fill","render_line","render_symbol","render_composite","render_raster","render_background"],render_background:{},render_fill:{},render_line:{"line-cap":{type:"enum",values:["butt","round","square"],"default":"butt",doc:"The display of line endings."},"line-join":{type:"enum",values:["bevel","round","miter"],"default":"miter",doc:"The display of lines when joining."},"line-miter-limit":{type:"number","default":2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles."},"line-round-limit":{type:"number","default":1,doc:"Used to automatically convert round joins to miter joins for shallow angles."}},render_symbol:{"symbol-placement":{type:"enum",values:["point","line"],"default":"point",doc:"Placement of a label relative to its geometry. `Line` can only be used on LineStrings and Polygons."},"symbol-min-distance":{type:"number","default":250,doc:"Minimum distance between two symbol anchors (px)"},"icon-allow-overlap":{type:"boolean","default":!1,doc:"If true, the icon will be visible even if it collides with other icons and text."},"icon-ignore-placement":{type:"boolean","default":!1,doc:"If true, the icon won't affect placement of other icons and text."},"icon-optional":{type:"boolean","default":!1,doc:"If true, text can be shown without its corresponding icon."},"icon-rotation-alignment":{type:"enum",values:["map","viewport"],"default":"viewport",doc:"Orientation of icon when map is rotated"},"icon-max-size":{type:"number","default":1,doc:"The maximum amount to scale the icon by."},"icon-image":{type:"string",doc:"A string with {tokens} replaced, referencing the data property to pull from."},"icon-rotate":{type:"number","default":0,doc:"Rotates the icon clockwise by the specified number of degrees."},"icon-padding":{type:"number","default":2,doc:"Padding value around icon bounding box to avoid icon collisions (px)."},"icon-keep-upright":{type:"boolean","default":!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down"},"icon-offset":{type:"array",value:"number",length:2,"default":[0,0],doc:"Icon's offset, in pixels. Values are [x, y] where negatives indicate left and up, respectively."},"text-rotation-alignment":{type:"enum",values:["map","viewport"],"default":"viewport",doc:"Orientation of icon or text when map is rotated"},"text-field":{type:"string","default":"",doc:"Value to use for a text label. Feature properties are specified using tokens like {field_name}."},"text-font":{type:"string",doc:"Font stack to use for displaying text."},"text-max-size":{type:"number","default":16,doc:"The maximum size text will be displayed."},"text-max-width":{type:"number","default":15,doc:"The maximum line width for text wrapping (em)."},"text-line-height":{type:"number","default":1.2,doc:"Text leading value for multi-line text."},"text-letter-spacing":{type:"number","default":0,doc:"Text kerning value (em)."},"text-justify":{type:"enum",values:["center","left","right"],"default":"center",doc:"Text justification options."},"text-horizontal-align":{type:"enum",values:["left","center","right"],"default":"center",doc:"Horizontal alignment of the text relative to the anchor."},"text-vertical-align":{type:"enum",values:["top","center","bottom"],"default":"center",doc:"Vertical alignment of the text relative to the anchor."},"text-max-angle":{type:"number","default":45,doc:"The maximum angle change, in degrees, allowed between adjacent characters."},"text-rotate":{type:"number","default":0,doc:"Rotates the text clockwise by the specified number of degrees."},"text-padding":{type:"number","default":2,doc:"Padding value around text bounding box to avoid label collisions (px)."},"text-keep-upright":{type:"boolean","default":!0,doc:"If true, the direction of the text may be flipped to prevent it from being rendered upside-down"},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],"default":"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property."},"text-offset":{type:"array",value:"number",length:2,"default":[0,0]},"text-allow-overlap":{type:"boolean","default":!1,doc:"If true, the text will be visible even if it collides with other icons and labels."},"text-ignore-placement":{type:"boolean","default":!1,doc:"If true, the text won't affect placement of other icons and labels."},"text-optional":{type:"boolean","default":!1,doc:"If true, icons can be shown without their corresponding text."}},render_composite:{},render_raster:{"raster-size":{type:"number","function":!0,"default":256,doc:"The texture image size (in pixels) vector layers will be rasterized at. Will automatically by scaled to match the visual tile size."},"raster-blur":{type:"number","function":!0,"default":0,doc:"Blur radius to apply to the raster texture before display."}},filter:[{type:"filter_expression",doc:"Various filter expressions. Unless overridden by parent, these are interpreted as `AND`."},{type:"array",value:"filter_expression",doc:"Various filter expressions. Unless overridden by parent, these are interpreted as `OR`."}],filter_expression:{"&":{type:"filter",doc:"AND operator."},"|":{type:"filter",doc:"OR operator."},"^":{type:"filter",doc:"XOR operator."},"!":{type:"filter",doc:"NOR operator."},$type:{type:"enum",values:["Point","LineString","Polygon"],doc:"Geometry type that features must match."},"*":[{type:"filter_comparison",doc:"Arbitarily named feature member. A comparison object defining a filter expression."},{type:"filter_value",doc:"Arbitarily named feature member. A filter_value implies the equality (string/number/boolean) or set membership operator (array)."}]},filter_comparison:{"==":{type:"filter_value",doc:"Equality operator."},"!=":{type:"filter_value",doc:"Inequality operator."},">":{type:"filter_value",doc:"Greater than operator."},">=":{type:"filter_value",doc:"Greater or equal than operator."},"<":{type:"filter_value",doc:"Less than operator."},"<=":{type:"filter_value",doc:"Less than or equal operator."},"in":{type:"array",value:"filter_primitive",doc:"Set member operator."},"!in":{type:"array",value:"filter_primitive",doc:"Not in set operator."}},filter_value:[{type:"filter_primitive"},{type:"array",value:"filter_primitive"}],filter_primitive:[{type:"string"},{type:"number"},{type:"boolean"}],"function":{stops:{type:"array",required:!0,doc:"An array of stops.",value:"function_stop"},base:{type:"number","default":1,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."}},function_stop:{type:"array",value:["number","color"],length:2,doc:"Zoom level and value pair."},"class":["class_fill","class_line","class_symbol","class_composite","class_raster","class_background"],class_fill:{"fill-antialias":{type:"boolean","default":!0,"function":!0,doc:"Whether or not the fill should be antialiased."},"fill-opacity":{type:"number","function":!0,"default":1,transition:!0},"fill-color":{type:"color","default":[0,0,0,1],"function":!0,transition:!0},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.","function":!0,transition:!0},"fill-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":!0,transition:!0,doc:"The geometry's offset, in pixels. Values are [x, y] where negatives indicate left and up, respectively."},"fill-translate-anchor":{type:"enum",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map"},"fill-image":{type:"string",doc:"Name of image in sprite to use for drawing image fills."}},class_line:{"line-opacity":{type:"number","function":!0,"default":1,transition:!0},"line-color":{type:"color","default":[0,0,0,1],"function":!0,transition:!0},"line-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":!0,transition:!0,doc:"The geometry's offset, in pixels. Values are [x, y] where negatives indicate left and up, respectively."},"line-translate-anchor":{type:"enum",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map"},"line-width":{type:"number","default":1,"function":!0,transition:!0,doc:"Line width (in px)"},"line-offset":{type:"number","default":0,doc:"Line casing where `line-offset` indicates total width. @TODO rename?","function":!0,transition:!0},"line-blur":{type:"number","default":0,"function":!0,transition:!0,doc:"Line blur, in pixels."},"line-dasharray":{type:"array",value:"number",length:2,"default":[1,-1],"function":!0,transition:!0},"line-image":{type:"string",doc:"Name of image in sprite to use for drawing image lines."}},class_symbol:{"icon-opacity":{type:"number","default":1,"function":!0,transition:!0},"icon-size":{type:"number","default":1,"function":!0,transition:!0,doc:"The amount to scale the icon by. 1 is original size, 3 triples the size."},"icon-color":{type:"color","default":[0,0,0,1],"function":!0,transition:!0,doc:"The color of the icon. This can only be used with sdf icons."},"icon-halo-color":{type:"color","default":[0,0,0,0],"function":!0,transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with sdf icons."},"icon-halo-width":{type:"number","default":0,"function":!0,transition:!0,doc:"How far away the halo is from the icon outline, in pixels."},"icon-halo-blur":{type:"number","default":0,"function":!0,transition:!0,doc:"Fade out the halo towards the outside, in pixels."},"icon-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":!0,transition:!0,doc:"An icon's offset, in pixels. Values are [x, y] where negatives indicate left and up, respectively."},"icon-translate-anchor":{type:"enum",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map"},"text-opacity":{type:"number","default":1,"function":!0,transition:!0},"text-size":{type:"number","default":16,"function":!0,transition:!0,doc:"Font size in pixels. If unspecified, the text will be as big as allowed by the layer definition."},"text-color":{type:"color","default":[0,0,0,1],"function":!0,transition:!0},"text-halo-color":{type:"color","default":[0,0,0,0],"function":!0,transition:!0},"text-halo-width":{type:"number","default":0,"function":!0,transition:!0,doc:"How far away the halo is from the font outline, in pixels. Max text halo width is 1/4 of the font-size (px)."},"text-halo-blur":{type:"number","default":0,"function":!0,transition:!0,doc:"Fade out the halo towards the outside, in pixels."},"text-translate":{type:"array",value:"number",length:2,"default":[0,0],"function":!0,transition:!0,doc:"A label's offset, in pixels. Values are [x, y] where negatives indicate left and up, respectively."},"text-translate-anchor":{type:"enum",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)","default":"map"}},class_composite:{"composite-opacity":{type:"number","default":1,"function":!0,transition:!0}},class_raster:{"raster-opacity":{type:"number","default":1,transition:!0},"raster-hue-rotate":{type:"number","default":0,"function":!0,transition:!0,doc:"Rotates hues around the color wheel by the specified number of degrees."},"raster-brightness":{type:"array",value:"number",length:2,"default":[0,1],"function":!0,transition:!0},"raster-saturation":{type:"number","default":0,"function":!0,transition:!0},"raster-contrast":{type:"number","default":0,"function":!0,transition:!0},"raster-fade":{type:"number","default":0,"function":!0,transition:!0,doc:"Duration of the fade when a new tile is added. @TODO rename?"}},class_background:{"background-color":{type:"color","default":[0,0,0,1],"function":!0,transition:!0},"background-image":{type:"string"}},transition:{duration:{type:"number","default":300,doc:"Time in milliseconds that it takes for transitions to complete."},delay:{type:"number","default":0,doc:"Time in milliseconds before a transition begins."}}}
},{}],95:[function(require,module){(function(Buffer){"use strict";function Protobuf(buf){this.buf=buf,this.pos=0}var ieee754=require("ieee754");module.exports=Protobuf,Protobuf.prototype={get length(){return this.buf.length}},Protobuf.Varint=0,Protobuf.Int64=1,Protobuf.Message=2,Protobuf.String=2,Protobuf.Packed=2,Protobuf.Int32=5,Protobuf.prototype.destroy=function(){this.buf=null},Protobuf.prototype.readUInt32=function(){var val=this.buf.readUInt32LE(this.pos);return this.pos+=4,val},Protobuf.prototype.readUInt64=function(){var val=this.buf.readUInt64LE(this.pos);return this.pos+=8,val},Protobuf.prototype.readDouble=function(){var val=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,val},Protobuf.prototype.readVarint=function(){var pos=this.pos;return this.buf[pos]<=127?(this.pos++,this.buf[pos]):this.buf[pos+1]<=127?(this.pos+=2,127&this.buf[pos]|this.buf[pos+1]<<7):this.buf[pos+2]<=127?(this.pos+=3,127&this.buf[pos]|(127&this.buf[pos+1])<<7|this.buf[pos+2]<<14):this.buf[pos+3]<=127?(this.pos+=4,127&this.buf[pos]|(127&this.buf[pos+1])<<7|(127&this.buf[pos+2])<<14|this.buf[pos+3]<<21):this.buf[pos+4]<=127?(this.pos+=5,(127&this.buf[pos]|(127&this.buf[pos+1])<<7|(127&this.buf[pos+2])<<14|this.buf[pos+3]<<21)+268435456*this.buf[pos+4]):(this.skip(Protobuf.Varint),0)},Protobuf.prototype.readSVarint=function(){var num=this.readVarint();if(num>2147483647)throw new Error("TODO: Handle numbers >= 2^30");return num>>1^-(1&num)},Protobuf.prototype.readString=function(){for(var bytes=this.readVarint(),chr=String.fromCharCode,b=this.buf,p=this.pos,end=this.pos+bytes,str="";end>p;)if(b[p]<=127)str+=chr(b[p++]);else{if(b[p]<=191)throw new Error("Invalid UTF-8 codepoint: "+b[p]);if(b[p]<=223)str+=chr((31&b[p++])<<6|63&b[p++]);else if(b[p]<=239)str+=chr((31&b[p++])<<12|(63&b[p++])<<6|63&b[p++]);else if(b[p]<=247)p+=4;else if(b[p]<=251)p+=5;else{if(!(b[p]<=253))throw new Error("Invalid UTF-8 codepoint: "+b[p]);p+=6}}return this.pos+=bytes,str},Protobuf.prototype.readBuffer=function(){var bytes=this.readVarint(),buffer=this.buf.subarray(this.pos,this.pos+bytes);return this.pos+=bytes,buffer},Protobuf.prototype.readPacked=function(type){for(var bytes=this.readVarint(),end=this.pos+bytes,array=[];this.pos<end;)array.push(this["read"+type]());return array},Protobuf.prototype.skip=function(val){var type=7&val;switch(type){case Protobuf.Varint:for(;this.buf[this.pos++]>127;);break;case Protobuf.Int64:this.pos+=8;break;case Protobuf.Message:var bytes=this.readVarint();this.pos+=bytes;break;case Protobuf.Int32:this.pos+=4;break;default:throw new Error("Unimplemented type: "+type)}},Protobuf.prototype.writeTag=function(tag,type){this.writeVarint(tag<<3|type)},Protobuf.prototype.realloc=function(min){for(var length=this.buf.length;length<this.pos+min;)length*=2;if(length!=this.buf.length){var buf=new Buffer(length);this.buf.copy(buf),this.buf=buf}},Protobuf.prototype.finish=function(){return this.buf.slice(0,this.pos)},Protobuf.prototype.writePacked=function(type,tag,items){if(items.length){for(var message=new Protobuf,i=0;i<items.length;i++)message["write"+type](items[i]);var data=message.finish();this.writeTag(tag,Protobuf.Packed),this.writeBuffer(data)}},Protobuf.prototype.writeUInt32=function(val){this.realloc(4),this.buf.writeUInt32LE(val,this.pos),this.pos+=4},Protobuf.prototype.writeTaggedUInt32=function(tag,val){this.writeTag(tag,Protobuf.Int32),this.writeUInt32(val)},Protobuf.prototype.writeVarint=function(val){if(val=Number(val),isNaN(val)&&(val=0),127>=val)this.realloc(1),this.buf[this.pos++]=val;else if(16383>=val)this.realloc(2),this.buf[this.pos++]=128|val>>>0&127,this.buf[this.pos++]=0|val>>>7&127;else if(33554431>=val)this.realloc(3),this.buf[this.pos++]=128|val>>>0&127,this.buf[this.pos++]=128|val>>>7&127,this.buf[this.pos++]=0|val>>>14&127;else if(268435455>=val)this.realloc(4),this.buf[this.pos++]=128|val>>>0&127,this.buf[this.pos++]=128|val>>>7&127,this.buf[this.pos++]=128|val>>>14&127,this.buf[this.pos++]=0|val>>>21&127;else for(;val>0;){var b=127&val;val=Math.floor(val/128),val>0&&(b|=128),this.realloc(1),this.buf[this.pos++]=b}},Protobuf.prototype.writeTaggedVarint=function(tag,val){this.writeTag(tag,Protobuf.Varint),this.writeVarint(val)},Protobuf.prototype.writeSVarint=function(val){this.writeVarint(val>=0?2*val:-2*val-1)},Protobuf.prototype.writeTaggedSVarint=function(tag,val){this.writeTag(tag,Protobuf.Varint),this.writeSVarint(val)},Protobuf.prototype.writeBoolean=function(val){this.writeVarint(Boolean(val))},Protobuf.prototype.writeTaggedBoolean=function(tag,val){this.writeTaggedVarint(tag,Boolean(val))},Protobuf.prototype.writeString=function(str){str=String(str);var bytes=Buffer.byteLength(str);this.writeVarint(bytes),this.realloc(bytes),this.buf.write(str,this.pos),this.pos+=bytes},Protobuf.prototype.writeTaggedString=function(tag,str){this.writeTag(tag,Protobuf.String),this.writeString(str)},Protobuf.prototype.writeFloat=function(val){this.realloc(4),this.buf.writeFloatLE(val,this.pos),this.pos+=4},Protobuf.prototype.writeTaggedFloat=function(tag,val){this.writeTag(tag,Protobuf.Int32),this.writeFloat(val)},Protobuf.prototype.writeDouble=function(val){this.realloc(8),this.buf.writeDoubleLE(val,this.pos),this.pos+=8},Protobuf.prototype.writeTaggedDouble=function(tag,val){this.writeTag(tag,Protobuf.Int64),this.writeDouble(val)},Protobuf.prototype.writeBuffer=function(buffer){var bytes=buffer.length;this.writeVarint(bytes),this.realloc(bytes),buffer.copy(this.buf,this.pos),this.pos+=bytes},Protobuf.prototype.writeTaggedBuffer=function(tag,buffer){this.writeTag(tag,Protobuf.String),this.writeBuffer(buffer)},Protobuf.prototype.writeMessage=function(tag,protobuf){var buffer=protobuf.finish();this.writeTag(tag,Protobuf.Message),this.writeBuffer(buffer)}}).call(this,require("buffer").Buffer)},{buffer:87,ieee754:96}],96:[function(require,module){module.exports=require(89)},{}],97:[function(require,module){"use strict";function Point(x,y){this.x=x,this.y=y}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var x=m[0]*this.x+m[1]*this.y,y=m[2]*this.x+m[3]*this.y;return this.x=x,this.y=y,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var y=this.y;return this.y=this.x,this.x=-y,this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),x=cos*this.x-sin*this.y,y=sin*this.x+cos*this.y;return this.x=x,this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(a){return a instanceof Point?a:Array.isArray(a)?new Point(a[0],a[1]):a}},{}],98:[function(require,module){!function(){function queue(parallelism){function pop(){for(;popping=started<tasks.length&&parallelism>active;){var i=started++,t=tasks[i],a=slice.call(t,1);a.push(callback(i)),++active,t[0].apply(null,a)}}function callback(i){return function(e,r){--active,null==error&&(null!=e?(error=e,started=remaining=0/0,notify()):(tasks[i]=r,--remaining?popping||pop():notify()))}}function notify(){null!=error?await(error):all?await(error,tasks):await.apply(null,[error].concat(tasks))}var q,popping,all,tasks=[],started=0,active=0,remaining=0,error=null,await=noop;return parallelism||(parallelism=1/0),q={defer:function(){return error||(tasks.push(arguments),++remaining,pop()),q},await:function(f){return await=f,all=!1,remaining||notify(),q},awaitAll:function(f){return await=f,all=!0,remaining||notify(),q}}}function noop(){}var slice=[].slice;queue.version="1.0.7","function"==typeof define&&define.amd?define(function(){return queue}):"object"==typeof module&&module.exports?module.exports=queue:this.queue=queue}()},{}],99:[function(require,module){!function(){"use strict";function rbush(maxEntries,format){return this instanceof rbush?(this._maxEntries=Math.max(4,maxEntries||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),format&&this._initFormat(format),void this.clear()):new rbush(maxEntries,format)}rbush.prototype={all:function(){return this._all(this.data,[])},search:function(bbox){var node=this.data,result=[];if(!this._intersects(bbox,node.bbox))return result;for(var i,len,child,childBBox,nodesToSearch=[];node;){for(i=0,len=node.children.length;len>i;i++)child=node.children[i],childBBox=node.leaf?this.toBBox(child):child.bbox,this._intersects(bbox,childBBox)&&(node.leaf?result.push(child):this._contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child));node=nodesToSearch.pop()}return result},load:function(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(var i=0,len=data.length;len>i;i++)this.insert(data[i]);return this}var node=this._build(data.slice(),0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this},insert:function(item){return item&&this._insert(item,this.data.height-1),this},clear:function(){return this.data={children:[],leaf:!0,bbox:this._empty(),height:1},this},remove:function(item){if(!item)return this;for(var i,parent,index,goingUp,node=this.data,bbox=this.toBBox(item),path=[],indexes=[];node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf&&(index=node.children.indexOf(item),-1!==index))return node.children.splice(index,1),path.push(node),this._condense(path),this;goingUp||node.leaf||!this._contains(node.bbox,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0])}return this},toBBox:function(item){return item},compareMinX:function(a,b){return a[0]-b[0]},compareMinY:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},fromJSON:function(data){return this.data=data,this},_all:function(node,result){for(var nodesToSearch=[];node;)node.leaf?result.push.apply(result,node.children):nodesToSearch.push.apply(nodesToSearch,node.children),node=nodesToSearch.pop();return result},_build:function(items,level,height){var node,N=items.length,M=this._maxEntries;if(M>=N)return node={children:items,leaf:!0,height:1},this._calcBBox(node),node;level||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1)),items.sort(this.compareMinX)),node={children:[],height:height};var i,j,slice,sliceLen,childNode,N1=Math.ceil(N/M)*Math.ceil(Math.sqrt(M)),N2=Math.ceil(N/M),compare=level%2===1?this.compareMinX:this.compareMinY;for(i=0;N>i;i+=N1)for(slice=items.slice(i,i+N1).sort(compare),j=0,sliceLen=slice.length;sliceLen>j;j+=N2)childNode=this._build(slice.slice(j,j+N2),level+1,height-1),node.children.push(childNode);return this._calcBBox(node),node},_chooseSubtree:function(bbox,node,level,path){for(var i,len,child,targetNode,area,enlargement,minArea,minEnlargement;;){if(path.push(node),node.leaf||path.length-1===level)break;for(minArea=minEnlargement=1/0,i=0,len=node.children.length;len>i;i++)child=node.children[i],area=this._area(child.bbox),enlargement=this._enlargedArea(bbox,child.bbox)-area,minEnlargement>enlargement?(minEnlargement=enlargement,minArea=minArea>area?area:minArea,targetNode=child):enlargement===minEnlargement&&minArea>area&&(minArea=area,targetNode=child);node=targetNode}return node},_insert:function(item,level,isNode){var bbox=isNode?item.bbox:this.toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),this._extend(node.bbox,bbox);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)},_split:function(insertPath,level){var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var newNode={children:node.children.splice(this._chooseSplitIndex(node,m,M)),height:node.height};node.leaf&&(newNode.leaf=!0),this._calcBBox(node),this._calcBBox(newNode),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)},_splitRoot:function(node,newNode){this.data={},this.data.children=[node,newNode],this.data.height=node.height+1,this._calcBBox(this.data)},_chooseSplitIndex:function(node,m,M){var i,bbox1,bbox2,overlap,area,minOverlap,minArea,index;for(minOverlap=minArea=1/0,i=m;M-m>=i;i++)bbox1=this._distBBox(node,0,i),bbox2=this._distBBox(node,i,M),overlap=this._intersectionArea(bbox1,bbox2),area=this._area(bbox1)+this._area(bbox2),minOverlap>overlap?(minOverlap=overlap,index=i,minArea=minArea>area?area:minArea):overlap===minOverlap&&minArea>area&&(minArea=area,index=i);return index},_chooseSplitAxis:function(node,m,M){var compareMinX=node.leaf?this.compareMinX:this._compareNodeMinX,compareMinY=node.leaf?this.compareMinY:this._compareNodeMinY,xMargin=this._allDistMargin(node,m,M,compareMinX),yMargin=this._allDistMargin(node,m,M,compareMinY);yMargin>xMargin&&node.children.sort(compareMinX)},_allDistMargin:function(node,m,M,compare){node.children.sort(compare);var i,child,leftBBox=this._distBBox(node,0,m),rightBBox=this._distBBox(node,M-m,M),margin=this._margin(leftBBox)+this._margin(rightBBox);for(i=m;M-m>i;i++)child=node.children[i],this._extend(leftBBox,node.leaf?this.toBBox(child):child.bbox),margin+=this._margin(leftBBox);for(i=M-m-1;i>=m;i--)child=node.children[i],this._extend(rightBBox,node.leaf?this.toBBox(child):child.bbox),margin+=this._margin(rightBBox);return margin},_distBBox:function(node,k,p){for(var child,bbox=this._empty(),i=k;p>i;i++)child=node.children[i],this._extend(bbox,node.leaf?this.toBBox(child):child.bbox);return bbox},_calcBBox:function(node){node.bbox=this._distBBox(node,0,node.children.length)},_adjustParentBBoxes:function(bbox,path,level){for(var i=level;i>=0;i--)this._extend(path[i].bbox,bbox)},_condense:function(path){for(var parent,i=path.length-1;i>=0;i--)0===path[i].children.length?i>0?(parent=path[i-1].children,parent.splice(parent.indexOf(path[i]),1)):this.clear():this._calcBBox(path[i])},_contains:function(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]},_intersects:function(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]},_extend:function(a,b){return a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.max(a[2],b[2]),a[3]=Math.max(a[3],b[3]),a},_area:function(a){return(a[2]-a[0])*(a[3]-a[1])},_margin:function(a){return a[2]-a[0]+(a[3]-a[1])},_enlargedArea:function(a,b){return(Math.max(b[2],a[2])-Math.min(b[0],a[0]))*(Math.max(b[3],a[3])-Math.min(b[1],a[1]))},_intersectionArea:function(a,b){var minX=Math.max(a[0],b[0]),minY=Math.max(a[1],b[1]),maxX=Math.min(a[2],b[2]),maxY=Math.min(a[3],b[3]);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)},_empty:function(){return[1/0,1/0,-1/0,-1/0]},_compareNodeMinX:function(a,b){return a.bbox[0]-b.bbox[0]},_compareNodeMinY:function(a,b){return a.bbox[1]-b.bbox[1]},_initFormat:function(format){var compareArr=["return a"," - b",";"];this.compareMinX=new Function("a","b",compareArr.join(format[0])),this.compareMinY=new Function("a","b",compareArr.join(format[1])),this.toBBox=new Function("a","return [a"+format.join(", a")+"];")}},"function"==typeof define&&define.amd?define(function(){return rbush}):"undefined"!=typeof module?module.exports=rbush:"undefined"!=typeof self?self.rbush=rbush:window.rbush=rbush}()},{}],100:[function(require,module){function UnitBezier(p1x,p1y,p2x,p2y){this.cx=3*p1x,this.bx=3*(p2x-p1x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*p1y,this.by=3*(p2y-p1y)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p1x,this.p1y=p2y,this.p2x=p2x,this.p2y=p2y}module.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(x,epsilon){"undefined"==typeof epsilon&&(epsilon=1e-6);var t0,t1,t2,x2,i;for(t2=x,i=0;8>i;i++){if(x2=this.sampleCurveX(t2)-x,Math.abs(x2)<epsilon)return t2;var d2=this.sampleCurveDerivativeX(t2);if(Math.abs(d2)<1e-6)break;t2-=x2/d2}if(t0=0,t1=1,t2=x,t0>t2)return t0;if(t2>t1)return t1;for(;t1>t0;){if(x2=this.sampleCurveX(t2),Math.abs(x2-x)<epsilon)return t2;x>x2?t0=t2:t1=t2,t2=.5*(t1-t0)+t0}return t2},UnitBezier.prototype.solve=function(x,epsilon){return this.sampleCurveY(this.solveCurveX(x,epsilon))}},{}],101:[function(require,module){module.exports.VectorTile=require("./lib/vectortile.js"),module.exports.VectorTileFeature=require("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=require("./lib/vectortilelayer.js")},{"./lib/vectortile.js":102,"./lib/vectortilefeature.js":103,"./lib/vectortilelayer.js":104}],102:[function(require,module){"use strict";function VectorTile(buffer,end){for(this.layers={},this._buffer=buffer,end=end||buffer.length;buffer.pos<end;){var val=buffer.readVarint(),tag=val>>3;if(3==tag){var layer=this.readLayer();layer.length&&(this.layers[layer.name]=layer)}else buffer.skip(val)}}var VectorTileLayer=require("./vectortilelayer");module.exports=VectorTile,VectorTile.prototype.readLayer=function(){var buffer=this._buffer,bytes=buffer.readVarint(),end=buffer.pos+bytes,layer=new VectorTileLayer(buffer,end);return buffer.pos=end,layer}},{"./vectortilelayer":104}],103:[function(require,module){"use strict";function VectorTileFeature(buffer,end,extent,keys,values){for(this.properties={},this.extent=extent,this.type=0,this._buffer=buffer,this._geometry=-1,end=end||buffer.length;buffer.pos<end;){var val=buffer.readVarint(),tag=val>>3;if(1==tag)this._id=buffer.readVarint();else if(2==tag)for(var tagEnd=buffer.pos+buffer.readVarint();buffer.pos<tagEnd;){var key=keys[buffer.readVarint()],value=values[buffer.readVarint()];this.properties[key]=value}else 3==tag?this.type=buffer.readVarint():4==tag?(this._geometry=buffer.pos,buffer.skip(val)):buffer.skip(val)}}var Point=require("point-geometry");module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var buffer=this._buffer;buffer.pos=this._geometry;for(var line,bytes=buffer.readVarint(),end=buffer.pos+bytes,cmd=1,length=0,x=0,y=0,lines=[];buffer.pos<end;){if(!length){var cmd_length=buffer.readVarint();cmd=7&cmd_length,length=cmd_length>>3}if(length--,1===cmd||2===cmd)x+=buffer.readSVarint(),y+=buffer.readSVarint(),1===cmd&&(line&&lines.push(line),line=[]),line.push(new Point(x,y));else{if(7!==cmd)throw new Error("unknown command "+cmd);line.push(line[0].clone())}}return line&&lines.push(line),lines},VectorTileFeature.prototype.bbox=function(){var buffer=this._buffer;buffer.pos=this._geometry;for(var bytes=buffer.readVarint(),end=buffer.pos+bytes,cmd=1,length=0,x=0,y=0,x1=1/0,x2=-1/0,y1=1/0,y2=-1/0;buffer.pos<end;){if(!length){var cmd_length=buffer.readVarint();cmd=7&cmd_length,length=cmd_length>>3}if(length--,1===cmd||2===cmd)x+=buffer.readSVarint(),y+=buffer.readSVarint(),x1>x&&(x1=x),x>x2&&(x2=x),y1>y&&(y1=y),y>y2&&(y2=y);else if(7!==cmd)throw new Error("unknown command "+cmd)}return[x1,y1,x2,y2]}},{"point-geometry":97}],104:[function(require,module){"use strict";function VectorTileLayer(buffer,end){this.version=1,this.name=null,this.extent=4096,this.length=0,this._buffer=buffer,this._keys=[],this._values=[],this._features=[];var val,tag;for(end=end||buffer.length;buffer.pos<end;)val=buffer.readVarint(),tag=val>>3,15===tag?this.version=buffer.readVarint():1===tag?this.name=buffer.readString():5===tag?this.extent=buffer.readVarint():2===tag?(this.length++,this._features.push(buffer.pos),buffer.skip(val)):3===tag?this._keys.push(buffer.readString()):4===tag?this._values.push(this.readFeatureValue()):buffer.skip(val)}var VectorTileFeature=require("./vectortilefeature.js");module.exports=VectorTileLayer,VectorTileLayer.prototype.readFeatureValue=function(){for(var val,tag,buffer=this._buffer,value=null,bytes=buffer.readVarint(),end=buffer.pos+bytes;buffer.pos<end;)if(val=buffer.readVarint(),tag=val>>3,1==tag)value=buffer.readString();else{if(2==tag)throw new Error("read float");if(3==tag)value=buffer.readDouble();else if(4==tag)value=buffer.readVarint();else{if(5==tag)throw new Error("read uint");6==tag?value=buffer.readSVarint():7==tag?value=Boolean(buffer.readVarint()):buffer.skip(val)}}return value},VectorTileLayer.prototype.feature=function(i){if(0>i||i>=this._features.length)throw new Error("feature index out of bounds");this._buffer.pos=this._features[i];var end=this._buffer.readVarint()+this._buffer.pos;return new VectorTileFeature(this._buffer,end,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":103}]},{},[21]);